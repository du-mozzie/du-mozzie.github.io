<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.38" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://du-mozzie.github.io/code/java/io.html"><meta property="og:title" content="IOæµ"><meta property="og:description" content="IO Java IOï¼ˆè¾“å…¥/è¾“å‡ºï¼‰æ˜¯æŒ‡ç”¨äºè¯»å–å’Œå†™å…¥æ•°æ®çš„APIï¼ŒåŒ…æ‹¬å¤„ç†æ–‡ä»¶ã€ç½‘ç»œè¿æ¥ã€å†…éƒ¨å­˜å‚¨ç­‰ã€‚Java IO API æä¾›äº†å¹¿æ³›çš„ç±»å’Œæ¥å£æ¥å¤„ç†ä¸åŒç±»å‹çš„è¾“å…¥è¾“å‡ºæ“ä½œã€‚ 1ã€æ–‡ä»¶ File ç±» java.io.Fileï¼Œä½¿ç”¨è¯¥ç±»çš„æ„é€ å‡½æ•°å°±å¯ä»¥åˆ›å»ºæ–‡ä»¶å¯¹è±¡ï¼Œå°†ç¡¬ç›˜ä¸­çš„ä¸€ä¸ªå…·ä½“çš„æ–‡ä»¶ä»¥ Java å¯¹è±¡çš„å½¢å¼æ¥è¡¨ç¤ºã€‚ IO Input è¾“å…¥æµï¼ˆå°†å¤–..."><meta property="og:type" content="article"><meta property="og:image" content="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/image-20220114202710730.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-08-01T07:58:21.000Z"><meta property="article:author" content="mozzie"><meta property="article:tag" content="Java"><meta property="article:published_time" content="2021-06-06T00:00:00.000Z"><meta property="article:modified_time" content="2024-08-01T07:58:21.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"IOæµ","image":["https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/image-20220114202710730.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/image-20220114202728127.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/image-20220114202738105.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/image-20220114202755005.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/image-20220114202852617.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/image-20220114202905901.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/image-20220114202923524.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/image-20220114203006564.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/image-20220114203035230.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877312490-f4d5aa1d-ca44-412a-87ee-0e4a7c5f690c.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877312467-49203424-a7df-4913-9bd6-657680128e6f.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877312497-9ff2fb9a-6309-4948-86dd-59535f168a5b.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877312578-7c8ed9c9-f015-4e90-83f7-b7cbc643d643.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877312488-57fbe5e0-1bec-47fa-ad07-9a82e9f53f9b.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877313167-c9d58861-9b89-4e45-8968-7e0b121c5cbf.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877313205-32e3033c-19b7-4b3f-b587-8e38b5e18b8e.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877313311-9dc1ae3e-05a3-4031-9f9e-fc9cbf343d0a.jpeg","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877313262-36ec3c50-ac46-46aa-88b6-a9c11011ff6e.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877313288-4ea522b3-28ca-4f31-9178-688ff53e31cd.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877313668-a0f3b00f-5e64-46bc-8d07-e621dcf5cdf7.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877313704-13affa58-a5d3-410c-acd1-8821d3c5c2f0.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877313805-13973f70-dee0-4c43-9139-a7c14555d1d9.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877313808-354ba9b2-838c-4ab4-87c5-d048f040bc1b.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314269-dee875b1-3d70-45c9-b7dc-0ba4de68ea2e.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314251-4e909cbf-fc06-4edb-9435-88f6c0b18c13.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314275-73944230-9433-448e-915c-b103360ebe15.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314341-67054877-44e7-420b-9c34-40f265fbcd1a.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314506-60b2c961-2bf7-40c0-893e-a1cde5eacca0.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314685-bc8824d8-cffb-4d3b-a126-3fe4f9c874a1.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314724-0a1b8fea-b7da-4b8b-a551-80868146edb0.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314888-17f1a26b-51eb-4d16-ab3d-0003d5196136.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314904-1e0bcc1e-13a3-4ce7-ad3a-48f76e5e43cc.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314980-2f4d204b-2aa3-4af1-b16c-be555b80eff7.png","https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877315508-abd3b7f0-dfdb-413f-b3d6-c6fff66a74ab.png"],"datePublished":"2021-06-06T00:00:00.000Z","dateModified":"2024-08-01T07:58:21.000Z","author":[{"@type":"Person","name":"mozzie","url":"https://du-mozzie.github.io"}]}</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2410206_mfj6e1vbwo.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_3294373_aaebeoej8c7.css"><script src="//hm.baidu.com/hm.js?062f74a68f105c60f10f2a0fc9cc9803"></script><script src="/assets/js/clarity.js"></script><title>IOæµ</title><meta name="description" content="IO Java IOï¼ˆè¾“å…¥/è¾“å‡ºï¼‰æ˜¯æŒ‡ç”¨äºè¯»å–å’Œå†™å…¥æ•°æ®çš„APIï¼ŒåŒ…æ‹¬å¤„ç†æ–‡ä»¶ã€ç½‘ç»œè¿æ¥ã€å†…éƒ¨å­˜å‚¨ç­‰ã€‚Java IO API æä¾›äº†å¹¿æ³›çš„ç±»å’Œæ¥å£æ¥å¤„ç†ä¸åŒç±»å‹çš„è¾“å…¥è¾“å‡ºæ“ä½œã€‚ 1ã€æ–‡ä»¶ File ç±» java.io.Fileï¼Œä½¿ç”¨è¯¥ç±»çš„æ„é€ å‡½æ•°å°±å¯ä»¥åˆ›å»ºæ–‡ä»¶å¯¹è±¡ï¼Œå°†ç¡¬ç›˜ä¸­çš„ä¸€ä¸ªå…·ä½“çš„æ–‡ä»¶ä»¥ Java å¯¹è±¡çš„å½¢å¼æ¥è¡¨ç¤ºã€‚ IO Input è¾“å…¥æµï¼ˆå°†å¤–...">
    <link rel="preload" href="/assets/style-HqpqC_EL.css" as="style"><link rel="stylesheet" href="/assets/style-HqpqC_EL.css">
    <link rel="modulepreload" href="/assets/app-C3mFCu-w.js"><link rel="modulepreload" href="/assets/io.html-BoDFC7-O.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/assets/images/mozzie.png" alt><!----><!----></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="ä¸»é¡µ"><span class="font-icon icon fa-fw fa-sm iconfont icon-home" style=""></span>ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="ä»£ç ç¬”è®°"><span class="title"><span class="font-icon icon fa-fw fa-sm iconfont icon-code" style=""></span>ä»£ç ç¬”è®°</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/code/data-structure-and-algorithms/" aria-label="æ•°æ®ç»“æ„ä¸ç®—æ³•"><img class="icon" src="/assets/images/navbar/data-structure.svg" alt aria-hidden no-view style="">æ•°æ®ç»“æ„ä¸ç®—æ³•<!----></a></li><li class="dropdown-item"><a class="route-link nav-link active" href="/code/java/" aria-label="Java"><img class="icon" src="/assets/images/navbar/java.svg" alt aria-hidden no-view style="">Java<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/code/mysql/" aria-label="MySQL"><img class="icon" src="/assets/images/navbar/mysql.svg" alt aria-hidden no-view style="">MySQL<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/code/spring/" aria-label="Spring"><img class="icon" src="/assets/images/navbar/spring.svg" alt aria-hidden no-view style="">Spring<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/code/redis/" aria-label="Redis"><img class="icon" src="/assets/images/navbar/redis.svg" alt aria-hidden no-view style="">Redis<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/code/distributed/" aria-label="åˆ†å¸ƒå¼"><img class="icon" src="/assets/images/navbar/distributed.svg" alt aria-hidden no-view style="">åˆ†å¸ƒå¼<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/code/notes/" aria-label="æ‚è®°"><img class="icon" src="/assets/images/navbar/notes.svg" alt aria-hidden no-view style="">æ‚è®°<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="åˆ†ç±»"><span class="title"><span class="font-icon icon fa-fw fa-sm iconfont icon-type" style=""></span>åˆ†ç±»</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/category/" aria-label="åˆ†ç±»"><img class="icon" src="/assets/images/navbar/category.svg" alt aria-hidden no-view style="">åˆ†ç±»<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/tag/" aria-label="æ ‡ç­¾"><img class="icon" src="/assets/images/navbar/tag.svg" alt aria-hidden no-view style="">æ ‡ç­¾<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/timeline/" aria-label="æ—¶é—´çº¿"><img class="icon" src="/assets/images/navbar/timeline.svg" alt aria-hidden no-view style="">æ—¶é—´çº¿<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/jottings/" aria-label="éšç¬”"><span class="font-icon icon fa-fw fa-sm fa-solid fa-compass-drafting" style=""></span>éšç¬”<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/links.html" aria-label="é“¾æ¥"><span class="font-icon icon fa-fw fa-sm iconfont icon-link" style=""></span>é“¾æ¥<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/about.html" aria-label="å…³äºæˆ‘"><span class="font-icon icon fa-fw fa-sm iconfont icon-people" style=""></span>å…³äºæˆ‘<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="vp-nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><form class="search-box" role="search"><input type="search" placeholder="æœç´¢" autocomplete="off" spellcheck="false" value><!----></form><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">æ•°æ®ç»“æ„ä¸ç®—æ³•</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Java</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/code/java/system.html" aria-label="Javaä½“ç³»"><!---->Javaä½“ç³»<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/code/java/basic-conception.html" aria-label="åŸºæœ¬æ¦‚å¿µ"><!---->åŸºæœ¬æ¦‚å¿µ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/code/java/process-control.html" aria-label="æµç¨‹æ§åˆ¶"><!---->æµç¨‹æ§åˆ¶<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/code/java/array.html" aria-label="æ•°ç»„"><!---->æ•°ç»„<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/code/java/object.html" aria-label="é¢å‘å¯¹è±¡"><!---->é¢å‘å¯¹è±¡<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/code/java/common-class.html" aria-label="å¸¸ç”¨ç±»"><!---->å¸¸ç”¨ç±»<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/code/java/exception.html" aria-label="å¼‚å¸¸"><!---->å¼‚å¸¸<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/code/java/collection.html" aria-label="é›†åˆ"><!---->é›†åˆ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/code/java/juc.html" aria-label="å¹¶å‘ç¼–ç¨‹"><!---->å¹¶å‘ç¼–ç¨‹<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/code/java/genericity.html" aria-label="æ³›å‹"><!---->æ³›å‹<!----></a></li><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/code/java/io.html" aria-label="IOæµ"><!---->IOæµ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/code/java/reflect.html" aria-label="åå°„"><!---->åå°„<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/code/java/annotation.html" aria-label="æ³¨è§£"><!---->æ³¨è§£<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/code/java/jvm.html" aria-label="JVM"><!---->JVM<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">MySQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Spring</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">åˆ†å¸ƒå¼</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">æ‚è®°</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->IOæµ</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://du-mozzie.github.io" target="_blank" rel="noopener noreferrer">mozzie</a></span><span property="author" content="mozzie"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2021-06-06T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 71 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT71M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category8 clickable" role="navigation">Java</span><!--]--><meta property="articleSection" content="Java"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag8 clickable" role="navigation">Java</span><!--]--><meta property="keywords" content="Java"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1ã€æ–‡ä»¶">1ã€æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2ã€ioæµ">2ã€IOæµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3ã€å­—èŠ‚æµ">3ã€å­—èŠ‚æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4ã€å­—ç¬¦æµ">4ã€å­—ç¬¦æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_5ã€reader">5ã€Reader</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_6ã€writer">6ã€Writer</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_7ã€å¤„ç†">7ã€å¤„ç†</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1ã€è¯»æ–‡ä»¶">1ã€è¯»æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2ã€å†™æ–‡ä»¶">2ã€å†™æ–‡ä»¶</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_8ã€ç¼“å†²æµ">8ã€ç¼“å†²æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_9ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–">9ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_10ã€io-æµçš„åº”ç”¨">10ã€IO æµçš„åº”ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_11ã€ç½‘ç»œç¼–ç¨‹">11ã€ç½‘ç»œç¼–ç¨‹</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#des">DES</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#ç½‘ç»œç¼–ç¨‹">ç½‘ç»œç¼–ç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#é€šä¿¡åè®®">é€šä¿¡åè®®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#javaæ¨¡å‹">Javaæ¨¡å‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#i-o">I/O</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#ioæ¨¡å‹">IOæ¨¡å‹</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#äº”ç§æ¨¡å‹">äº”ç§æ¨¡å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#é˜»å¡å¼io">é˜»å¡å¼IO</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#éé˜»å¡å¼">éé˜»å¡å¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#ä¿¡å·é©±åŠ¨">ä¿¡å·é©±åŠ¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#io-å¤ç”¨">IO å¤ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#å¼‚æ­¥-io">å¼‚æ­¥ IO</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#å¤šè·¯å¤ç”¨">å¤šè·¯å¤ç”¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#select">select</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level6" href="#å‡½æ•°">å‡½æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level6" href="#æµç¨‹">æµç¨‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#poll">poll</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#epoll">epoll</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level6" href="#å‡½æ•°-1">å‡½æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level6" href="#ç‰¹ç‚¹">ç‰¹ç‚¹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#åº”ç”¨">åº”ç”¨</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#ç³»ç»Ÿè°ƒç”¨">ç³»ç»Ÿè°ƒç”¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#å†…æ ¸æ€">å†…æ ¸æ€</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#_80ä¸­æ–­">80ä¸­æ–­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#é›¶æ‹·è´">é›¶æ‹·è´</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#dma">DMA</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#bio">BIO</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#mmap">mmap</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#sendfile">sendfile</a></li><!----><!--]--></ul></li><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#bio-1">BIO</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#inet">Inet</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#udp">UDP</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#åŸºæœ¬ä»‹ç»">åŸºæœ¬ä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#å®ç°udp">å®ç°UDP</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#é€šè®¯æ–¹å¼">é€šè®¯æ–¹å¼</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#tcp">TCP</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#åŸºæœ¬ä»‹ç»-1">åŸºæœ¬ä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#socket">Socket</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#å®ç°tcp">å®ç°TCP</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level6" href="#å¼€å‘æµç¨‹">å¼€å‘æµç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level6" href="#å®ç°é€šä¿¡">å®ç°é€šä¿¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level6" href="#ä¼ªå¼‚æ­¥">ä¼ªå¼‚æ­¥</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#æ–‡ä»¶ä¼ è¾“">æ–‡ä»¶ä¼ è¾“</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level6" href="#å­—èŠ‚æµ">å­—èŠ‚æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level6" href="#æ•°æ®æµ">æ•°æ®æµ</a></li><!----><!--]--></ul></li><!--]--></ul></li><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nio">NIO</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#åŸºæœ¬ä»‹ç»-2">åŸºæœ¬ä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#å®ç°åŸç†">å®ç°åŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#ç¼“å†²åŒº">ç¼“å†²åŒº</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#åŸºæœ¬ä»‹ç»-3">åŸºæœ¬ä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#åŸºæœ¬å±æ€§">åŸºæœ¬å±æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#å¸¸ç”¨api">å¸¸ç”¨API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#è¯»å†™æ•°æ®">è¯»å†™æ•°æ®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#ç²˜åŒ…æ‹†åŒ…">ç²˜åŒ…æ‹†åŒ…</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#ç›´æ¥å†…å­˜">ç›´æ¥å†…å­˜</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#åŸºæœ¬ä»‹ç»-4">åŸºæœ¬ä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#é€šä¿¡åŸç†">é€šä¿¡åŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#åˆ†é…å›æ”¶">åˆ†é…å›æ”¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#å…±äº«å†…å­˜">å…±äº«å†…å­˜</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#é€šé“">é€šé“</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#åŸºæœ¬ä»‹ç»-5">åŸºæœ¬ä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#å¸¸ç”¨api-1">å¸¸ç”¨API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#æ–‡ä»¶è¯»å†™">æ–‡ä»¶è¯»å†™</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#æ–‡ä»¶å¤åˆ¶">æ–‡ä»¶å¤åˆ¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#åˆ†æ•£èšé›†">åˆ†æ•£èšé›†</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#é€‰æ‹©å™¨">é€‰æ‹©å™¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#åŸºæœ¬ä»‹ç»-6">åŸºæœ¬ä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#å¸¸ç”¨api-2">å¸¸ç”¨API</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#nioå®ç°">NIOå®ç°</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#å¸¸ç”¨api-3">å¸¸ç”¨API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#ä»£ç å®ç°">ä»£ç å®ç°</a></li><!----><!--]--></ul></li><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#aio">AIO</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h1 id="io" tabindex="-1"><a class="header-anchor" href="#io"><span>IO</span></a></h1><p>Java IOï¼ˆè¾“å…¥/è¾“å‡ºï¼‰æ˜¯æŒ‡ç”¨äºè¯»å–å’Œå†™å…¥æ•°æ®çš„APIï¼ŒåŒ…æ‹¬å¤„ç†æ–‡ä»¶ã€ç½‘ç»œè¿æ¥ã€å†…éƒ¨å­˜å‚¨ç­‰ã€‚Java IO API æä¾›äº†å¹¿æ³›çš„ç±»å’Œæ¥å£æ¥å¤„ç†ä¸åŒç±»å‹çš„è¾“å…¥è¾“å‡ºæ“ä½œã€‚</p><h2 id="_1ã€æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_1ã€æ–‡ä»¶"><span>1ã€æ–‡ä»¶</span></a></h2><p>File ç±»</p><p>java.io.Fileï¼Œä½¿ç”¨è¯¥ç±»çš„æ„é€ å‡½æ•°å°±å¯ä»¥åˆ›å»ºæ–‡ä»¶å¯¹è±¡ï¼Œå°†<code>ç¡¬ç›˜</code>ä¸­çš„ä¸€ä¸ªå…·ä½“çš„<code>æ–‡ä»¶</code>ä»¥ Java å¯¹è±¡çš„å½¢å¼æ¥è¡¨ç¤ºã€‚</p><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td>public File(String pathname)</td><td>æ ¹æ®è·¯å¾„åˆ›å»ºå¯¹è±¡</td></tr><tr><td>public String getName()</td><td>è·å–æ–‡ä»¶å</td></tr><tr><td>public String getParent()</td><td>è·å–æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•</td></tr><tr><td>public File getParentFile()</td><td>è·å–æ–‡ä»¶æ‰€åœ¨ç›®å½•å¯¹åº”çš„Fileå¯¹è±¡</td></tr><tr><td>public String getPath()</td><td>è·å–æ–‡ä»¶è·¯å¾„</td></tr><tr><td>public boolean exists()</td><td>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</td></tr><tr><td>public boolean isDirectory()</td><td>åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºç›®å½•</td></tr><tr><td>public boolean isFile()</td><td>åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºæ–‡ä»¶</td></tr><tr><td>public long length()</td><td>è·å–æ–‡ä»¶çš„å¤§å°</td></tr><tr><td>public boolean createNewFile()</td><td>æ ¹æ®å½“å‰å¯¹è±¡åˆ›å»ºæ–°æ–‡ä»¶</td></tr><tr><td>public boolean delete()</td><td>åˆ é™¤å¯¹è±¡</td></tr><tr><td>public boolean mkdir()</td><td>æ ¹æ®å½“å‰å¯¹è±¡åˆ›å»ºç›®å½•</td></tr><tr><td>public boolean renameTo(File file)</td><td>ä¸ºå·²å­˜åœ¨çš„å¯¹è±¡é‡å‘½å</td></tr></tbody></table><p>IO</p><p>Input è¾“å…¥æµï¼ˆå°†å¤–éƒ¨æ–‡ä»¶è¯»å…¥åˆ° Java ç¨‹åºä¸­ï¼‰</p><p>Output è¾“å‡ºæµï¼ˆå°† Java ç¨‹åºä¸­çš„æ•°æ®è¾“å‡ºåˆ°å¤–éƒ¨ï¼‰</p><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/image-20220114202710730.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Java ä¸­çš„æµæœ‰å¾ˆå¤šç§ä¸åŒçš„åˆ†ç±»ã€‚</p><ul><li>æŒ‰ç…§æ–¹å‘åˆ†ï¼Œ<code>è¾“å…¥æµ</code>å’Œ<code>è¾“å‡ºæµ</code></li><li>æŒ‰ç…§å•ä½åˆ†ï¼Œå¯ä»¥åˆ†ä¸º<code>å­—èŠ‚æµ</code>å’Œ<code>å­—ç¬¦æµ</code>ï¼ˆå­—èŠ‚æµæ˜¯æŒ‡æ¯æ¬¡å¤„ç†æ•°æ®ä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œå­—ç¬¦æµæ˜¯æŒ‡æ¯æ¬¡å¤„ç†æ•°æ®ä»¥å­—ç¬¦ä¸ºå•ä½ï¼‰</li><li>æŒ‰ç…§åŠŸèƒ½åˆ†ï¼Œå¯ä»¥åˆ†ä¸º<code>èŠ‚ç‚¹æµ</code>å’Œ<code>å¤„ç†æµ</code>ã€‚</li></ul><p>æ–¹æ³•å®šä¹‰æ—¶çš„å¼‚å¸¸å¦‚æœç›´æ¥ç»§æ‰¿è‡ª Exceptionï¼Œå®é™…è°ƒç”¨çš„æ—¶å€™éœ€è¦æ‰‹åŠ¨å¤„ç†ï¼ˆæ•è·å¼‚å¸¸/ä¸¢ç»™è™šæ‹Ÿæœºå»å¤„ç†ï¼‰</p><p>æ–¹æ³•å®šä¹‰æ—¶çš„å¼‚å¸¸å¦‚æœç»§æ‰¿è‡ª RuntimeExceptionï¼Œè°ƒç”¨çš„æ—¶å€™ä¸éœ€è¦å¤„ç†ã€‚</p><h2 id="_2ã€ioæµ" tabindex="-1"><a class="header-anchor" href="#_2ã€ioæµ"><span>2ã€IOæµ</span></a></h2><ul><li>æŒ‰ç…§æ–¹å‘åˆ†ï¼Œå¯ä»¥åˆ†ä¸ºè¾“å…¥æµå’Œè¾“å‡ºæµã€‚</li><li>æŒ‰ç…§å•ä½åˆ†ï¼Œå¯ä»¥åˆ†ä¸ºå­—èŠ‚æµå’Œå­—ç¬¦æµã€‚</li><li>æŒ‰ç…§åŠŸèƒ½åˆ†ï¼Œå¯ä»¥åˆ†ä¸ºèŠ‚ç‚¹æµå’Œå¤„ç†æµã€‚</li></ul><h2 id="_3ã€å­—èŠ‚æµ" tabindex="-1"><a class="header-anchor" href="#_3ã€å­—èŠ‚æµ"><span>3ã€å­—èŠ‚æµ</span></a></h2><p>æŒ‰ç…§æ–¹å‘å¯ä»¥åˆ†ä¸ºè¾“å…¥å­—èŠ‚æµå’Œè¾“å‡ºå­—èŠ‚æµã€‚</p><p>InputStreamã€OutputStream</p><p>1 byte = 8 ä½äºŒè¿›åˆ¶æ•° 01010101</p><p>InputStreamå¸¸ç”¨æ–¹æ³•</p><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td>int read()</td><td>ä»¥å­—èŠ‚ä¸ºå•ä½è¯»å–æ•°æ®</td></tr><tr><td>int read(byte b[])</td><td>å°†æ•°æ®å­˜å…¥ byte ç±»å‹çš„æ•°ç»„ä¸­ï¼Œè¿”å›æ•°ç»„ä¸­æœ‰æ•ˆæ•°æ®çš„é•¿åº¦</td></tr><tr><td>int read(byte b[],int off,int len)</td><td>å°†æ•°æ®å­˜å…¥ byte æ•°ç»„çš„æŒ‡å®šåŒºé—´å†…ï¼Œè¿”å›æ•°ç»„é•¿åº¦</td></tr><tr><td>byte[] readAllBytes()</td><td>å°†æ‰€æœ‰æ•°æ®å­˜å…¥ byte æ•°ç»„å¹¶è¿”å›</td></tr><tr><td>int available()</td><td>è¿”å›å½“å‰æ•°æ®æµæœªè¯»å–çš„æ•°æ®ä¸ªæ•°</td></tr><tr><td>void close()</td><td>å…³é—­æ•°æ®æµ</td></tr></tbody></table><p>OutputStream</p><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td>void write(int b)</td><td>ä»¥å­—èŠ‚ä¸ºå•ä½è¾“å‡ºæ•°æ®</td></tr><tr><td>void write(byte b[])</td><td>å°†byteæ•°ç»„ä¸­çš„æ•°æ®è¾“å‡º</td></tr><tr><td>void write(byte b[],int off,int len)</td><td>å°†byteæ•°ç»„ä¸­æŒ‡å®šåŒºé—´çš„æ•°æ®è¾“å‡º</td></tr><tr><td>void close()</td><td>å…³é—­æ•°æ®æµ</td></tr><tr><td>void flush()</td><td>å°†ç¼“å†²æµä¸­çš„æ•°æ®åŒæ­¥åˆ°è¾“å‡ºæµä¸­</td></tr></tbody></table><h2 id="_4ã€å­—ç¬¦æµ" tabindex="-1"><a class="header-anchor" href="#_4ã€å­—ç¬¦æµ"><span>4ã€å­—ç¬¦æµ</span></a></h2><p>å­—èŠ‚æµæ˜¯å•ä½æ—¶é—´å†…å¤„ç†ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ï¼ˆè¾“å…¥+è¾“å‡ºï¼‰</p><p>å­—ç¬¦æµæ˜¯å•ä½æ—¶é—´å†…å¤„ç†ä¸€ä¸ªå­—ç¬¦çš„æ•°æ®ï¼ˆè¾“å…¥+è¾“å‡ºï¼‰</p><p>å­—ç¬¦æµï¼š</p><ul><li>è¾“å…¥å­—ç¬¦æµ Reader</li><li>è¾“å‡ºå­—ç¬¦æµ Writer</li></ul><h2 id="_5ã€reader" tabindex="-1"><a class="header-anchor" href="#_5ã€reader"><span>5ã€Reader</span></a></h2><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/image-20220114202728127.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»</p><p>Readable æ¥å£çš„ä½œç”¨ï¼Ÿ</p><p>å¯ä»¥å°†æ•°æ®ä»¥å­—ç¬¦çš„å½¢å¼è¯»å…¥åˆ°<code>ç¼“å†²åŒº</code></p><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/image-20220114202738105.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>æ–¹å‘ï¼šè¾“å…¥+è¾“å‡º</li><li>å•ä½ï¼šå­—èŠ‚+å­—ç¬¦</li><li>åŠŸèƒ½ï¼šèŠ‚ç‚¹æµï¼ˆå­—èŠ‚æµï¼‰ + å¤„ç†æµï¼ˆå¯¹èŠ‚ç‚¹æµè¿›è¡Œå¤„ç†ï¼Œç”Ÿæˆå…¶ä»–ç±»å‹çš„æµï¼‰</li></ul><p>InputStream(å­—èŠ‚è¾“å…¥æµ) â€”&gt; Readerï¼ˆå­—ç¬¦è¾“å…¥æµï¼‰</p><p>InputStreamReader çš„åŠŸèƒ½æ˜¯å°†<code>å­—èŠ‚è¾“å…¥æµ</code>è½¬æ¢ä¸º<code>å­—ç¬¦è¾“å…¥æµ</code><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/image-20220114202755005.png" alt="" loading="lazy"></p><blockquote><p>è‹±æ–‡ã€æ•°å­—ã€ç¬¦å·</p></blockquote><p>1 ä¸ªå­—èŠ‚ = 1 ä¸ªå­—ç¬¦</p><p>å¦‚ï¼ša 1 ä¸ªå­—ç¬¦ã€1 ä¸ªå­—èŠ‚</p><blockquote><p>æ±‰å­—</p></blockquote><p>1 ä¸ªå­—ç¬¦ = 3 ä¸ªå­—èŠ‚</p><p>å¦‚ï¼šå¥½ 1ä¸ªå­—ç¬¦ã€3 ä¸ªå­—èŠ‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//å­—ç¬¦æµ</span>
        <span class="token class-name">Reader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/du/Desktop/test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> temp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;*******å­—ç¬¦æµè¯»å–********&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>temp <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        reader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//å­—èŠ‚æµ</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/du/Desktop/test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        temp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;*******å­—èŠ‚æµè¯»å–********&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>temp <span class="token operator">=</span> inputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        inputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>read() è¿”å›çš„æ˜¯ int ï¼Œç›´æ¥å°†å­—ç¬¦è½¬æˆå­—èŠ‚ï¼ˆ1-1ï¼Œ1-3ï¼‰</p><p>read(char[] chars) è¿”å›çš„æ˜¯charæ•°ç»„ï¼Œç›´æ¥å°±è¿”å›å­—ç¬¦ï¼Œä¸ä¼šè½¬æˆå­—èŠ‚çš„ã€‚</p><h2 id="_6ã€writer" tabindex="-1"><a class="header-anchor" href="#_6ã€writer"><span>6ã€Writer</span></a></h2><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/image-20220114202852617.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Appendable æ¥å£å¯ä»¥å°† char ç±»å‹çš„æ•°æ®è¯»å…¥åˆ°<code>æ•°æ®ç¼“å†²åŒº</code><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/image-20220114202905901.png" alt="" loading="lazy"></p><p>OutputStreamWriter å¤„ç†æµ</p><p>OutputStreamWriter çš„åŠŸèƒ½æ˜¯å°†<code>è¾“å‡ºå­—èŠ‚æµ</code>è½¬æˆ<code>è¾“å‡ºå­—ç¬¦æµ</code>ï¼Œä¸ InputStreamReader ç›¸å¯¹åº”çš„ï¼Œå°†<code>è¾“å…¥å­—èŠ‚æµ</code>è½¬æˆ<code>è¾“å…¥å­—ç¬¦æµ</code><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/image-20220114202923524.png" alt="" loading="lazy"></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Writer</span> writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWriter</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/du/Desktop/copy.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//writer.write(&quot;ä½ å¥½&quot;);</span>
<span class="token comment">//        char[] chars = {&#39;ä½ &#39;,&#39;å¥½&#39;,&#39;ä¸–&#39;,&#39;ç•Œ&#39;};</span>
<span class="token comment">//        writer.write(chars,2,2);</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;Hello World,ä½ å¥½ä¸–ç•Œ&quot;</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7ã€å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_7ã€å¤„ç†"><span>7ã€å¤„ç†</span></a></h2><h3 id="_1ã€è¯»æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_1ã€è¯»æ–‡ä»¶"><span>1ã€è¯»æ–‡ä»¶</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//åŸºç¡€ç®¡é“</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/du/Desktop/test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¤„ç†æµ</span>
        <span class="token class-name">InputStreamReader</span> inputStreamReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> chars <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> length <span class="token operator">=</span> inputStreamReader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>chars<span class="token punctuation">)</span><span class="token punctuation">;</span>
        inputStreamReader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>chars<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2ã€å†™æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_2ã€å†™æ–‡ä»¶"><span>2ã€å†™æ–‡ä»¶</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;ä½ å¥½ ä¸–ç•Œ&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">OutputStream</span> outputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/du/Desktop/copy.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">OutputStreamWriter</span> writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputStreamWriter</span><span class="token punctuation">(</span>outputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8ã€ç¼“å†²æµ" tabindex="-1"><a class="header-anchor" href="#_8ã€ç¼“å†²æµ"><span>8ã€ç¼“å†²æµ</span></a></h2><p>æ— è®ºæ˜¯<code>å­—èŠ‚æµ</code>è¿˜æ˜¯<code>å­—ç¬¦æµ</code>ï¼Œä½¿ç”¨çš„æ—¶å€™éƒ½ä¼šé¢‘ç¹è®¿é—®ç¡¬ç›˜ï¼Œå¯¹ç¡¬ç›˜æ˜¯ä¸€ç§æŸä¼¤ï¼ŒåŒæ—¶æ•ˆç‡ä¸é«˜ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</p><p>å¯ä»¥ä½¿ç”¨<strong>ç¼“å†²æµ</strong>ï¼Œç¼“å†²æµè‡ªå¸¦ç¼“å†²åŒºï¼Œå¯ä»¥ä¸€æ¬¡æ€§ä»ç¡¬ç›˜ä¸­è¯»å–éƒ¨åˆ†æ•°æ®å­˜å…¥ç¼“å†²åŒºï¼Œå†å†™å…¥å†…å­˜ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆå‡å°‘å¯¹ç¡¬ç›˜çš„ç›´æ¥è®¿é—®ã€‚</p><p>ç¼“å†²æµå±äº<code>å¤„ç†æµ</code>ï¼Œå¦‚ä½•æ¥åŒºåˆ†<strong>èŠ‚ç‚¹æµ</strong>å’Œ<strong>å¤„ç†æµ</strong>ï¼Ÿ</p><p>1ã€èŠ‚ç‚¹æµä½¿ç”¨çš„æ—¶å€™å¯ä»¥ç›´æ¥å¯¹æ¥åˆ°æ–‡ä»¶å¯¹è±¡File</p><p>2ã€å¤„ç†æµä½¿ç”¨çš„æ—¶å€™ä¸å¯ä»¥ç›´æ¥å¯¹æ¥åˆ°æ–‡ä»¶å¯¹è±¡ Fileï¼Œå¿…é¡»è¦å»ºç«‹åœ¨<code>å­—èŠ‚æµ</code>çš„åŸºç¡€ä¸Šæ‰èƒ½åˆ›å»ºã€‚</p><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/image-20220114203006564.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ç¼“å†²æµåˆå¯ä»¥åˆ†ä¸ºå­—èŠ‚ç¼“å†²æµå’Œå­—ç¬¦ç¼“å†²æµï¼ŒæŒ‰ç…§æ–¹å‘å†ç»†åˆ†ï¼Œåˆå¯ä»¥åˆ†ä¸ºå­—èŠ‚è¾“å…¥ç¼“å†²æµå’Œå­—èŠ‚è¾“å‡ºç¼“å†²æµï¼Œä»¥åŠå­—ç¬¦è¾“å…¥ç¼“å†²æµå’Œå­—ç¬¦è¾“å‡ºç¼“å†²æµã€‚</p><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/image-20220114203035230.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><blockquote><p>å­—èŠ‚è¾“å…¥ç¼“å†²æµ</p></blockquote><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//1ã€åˆ›å»ºèŠ‚ç‚¹æµ</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/du/Desktop/test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2ã€åˆ›å»ºç¼“å†²æµ</span>
        <span class="token class-name">BufferedInputStream</span> bufferedInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedInputStream</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//        int temp = 0;</span>
        <span class="token comment">//        while ((temp = bufferedInputStream.read())!=-1){</span>
        <span class="token comment">//            System.out.println(temp);</span>
        <span class="token comment">//        }</span>

        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> length <span class="token operator">=</span> bufferedInputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">byte</span> aByte <span class="token operator">:</span> bytes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>aByte<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        bufferedInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        inputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>å­—ç¬¦è¾“å…¥ç¼“å†²æµ</p></blockquote><p>readLine æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//1ã€åˆ›å»ºå­—ç¬¦æµï¼ˆèŠ‚ç‚¹æµï¼‰</span>
        <span class="token class-name">Reader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/du/Desktop/test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2ã€åˆ›å»ºç¼“å†²æµï¼ˆå¤„ç†æµï¼‰</span>
        <span class="token class-name">BufferedReader</span> bufferedReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;***start***&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>str <span class="token operator">=</span> bufferedReader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            num<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;***end***,å…±è¯»å–äº†&quot;</span><span class="token operator">+</span>num<span class="token operator">+</span><span class="token string">&quot;æ¬¡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bufferedReader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        reader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>å­—èŠ‚è¾“å‡ºç¼“å†²æµ</p></blockquote><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">OutputStream</span> outputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/du/Desktop/test2.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BufferedOutputStream</span> bufferedOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedOutputStream</span><span class="token punctuation">(</span>outputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;ç”±äºåœ¨å¼€å‘Oakè¯­è¨€æ—¶ï¼Œå°šä¸”ä¸å­˜åœ¨è¿è¡Œå­—èŠ‚ç çš„ç¡¬ä»¶å¹³å°ï¼Œæ‰€ä»¥ä¸ºäº†åœ¨å¼€å‘æ—¶å¯ä»¥å¯¹è¿™ç§è¯­è¨€è¿›è¡Œå®éªŒç ”ç©¶ï¼Œä»–ä»¬å°±åœ¨å·²æœ‰çš„ç¡¬ä»¶å’Œè½¯ä»¶å¹³å°åŸºç¡€ä¸Šï¼ŒæŒ‰ç…§è‡ªå·±æ‰€æŒ‡å®šçš„è§„èŒƒï¼Œç”¨è½¯ä»¶å»ºè®¾äº†ä¸€ä¸ªè¿è¡Œå¹³å°ï¼Œæ•´ä¸ªç³»ç»Ÿé™¤äº†æ¯”C++æ›´åŠ ç®€å•ä¹‹å¤–ï¼Œæ²¡æœ‰ä»€ä¹ˆå¤§çš„åŒºåˆ«ã€‚&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        for (byte aByte : bytes) {</span>
<span class="token comment">//            bufferedOutputStream.write(aByte);</span>
<span class="token comment">//        }</span>
        bufferedOutputStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bufferedOutputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bufferedOutputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>å­—ç¬¦è¾“å‡ºç¼“å†²æµ</p></blockquote><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Writer</span> writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWriter</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/du/Desktop/test2.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BufferedWriter</span> bufferedWriter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedWriter</span><span class="token punctuation">(</span>writer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        String str = &quot;ç”±äºåœ¨å¼€å‘è¯­è¨€æ—¶å°šä¸”ä¸å­˜åœ¨è¿è¡Œå­—èŠ‚ç çš„ç¡¬ä»¶å¹³å°ï¼Œæ‰€ä»¥ä¸ºäº†åœ¨å¼€å‘æ—¶å¯ä»¥å¯¹è¿™ç§è¯­è¨€è¿›è¡Œå®éªŒç ”ç©¶ï¼Œä»–ä»¬å°±åœ¨å·²æœ‰çš„ç¡¬ä»¶å’Œè½¯ä»¶å¹³å°åŸºç¡€ä¸Šï¼ŒæŒ‰ç…§è‡ªå·±æ‰€æŒ‡å®šçš„è§„èŒƒï¼Œç”¨è½¯ä»¶å»ºè®¾äº†ä¸€ä¸ªè¿è¡Œå¹³å°ï¼Œæ•´ä¸ªç³»ç»Ÿé™¤äº†æ¯”C++æ›´åŠ ç®€å•ä¹‹å¤–ï¼Œæ²¡æœ‰ä»€ä¹ˆå¤§çš„åŒºåˆ«ã€‚&quot;;</span>
<span class="token comment">//        bufferedWriter.write(str,5,10);</span>
        <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> chars <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token char">&#39;J&#39;</span><span class="token punctuation">,</span><span class="token char">&#39;a&#39;</span><span class="token punctuation">,</span><span class="token char">&#39;v&#39;</span><span class="token punctuation">,</span><span class="token char">&#39;a&#39;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//        bufferedWriter.write(chars,2,1);</span>
        bufferedWriter<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token number">22902</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bufferedWriter<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bufferedWriter<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å…¥æµæ²¡æœ‰ flush æ–¹æ³•ï¼Œä½†ä¸ä»£è¡¨å®ƒæ²¡æœ‰ç¼“å†²æµï¼Œè¾“å‡ºæµæ˜¯æœ‰ flush æ–¹æ³•çš„ï¼Œå®é™…å¼€å‘ä¸­åœ¨å…³é—­è¾“å‡ºç¼“å†²æµä¹‹å‰ï¼Œéœ€è¦è°ƒç”¨ flush æ–¹æ³•ã€‚</p><h2 id="_9ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–" tabindex="-1"><a class="header-anchor" href="#_9ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–"><span>9ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–</span></a></h2><p>åºåˆ—åŒ–å°±æ˜¯å°†å†…å­˜ä¸­çš„å¯¹è±¡è¾“å‡ºåˆ°ç¡¬ç›˜æ–‡ä»¶ä¸­ä¿å­˜ã€‚</p><p>ååºåˆ—åŒ–å°±æ˜¯ç›¸åçš„æ“ä½œï¼Œä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®å¹¶è¿˜åŸæˆå†…å­˜ä¸­çš„å¯¹è±¡ã€‚</p><blockquote><p>åºåˆ—åŒ–</p></blockquote><p>1ã€å®ä½“ç±»éœ€è¦å®ç°åºåˆ—åŒ–æ¥å£ï¼ŒSerializable</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;User{&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;id=&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span>
                <span class="token string">&quot;, name=&#39;&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">&#39;\&#39;&#39;</span> <span class="token operator">+</span>
                <span class="token string">&quot;, age=&quot;</span> <span class="token operator">+</span> age <span class="token operator">+</span>
                <span class="token char">&#39;}&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Integer</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€å®ä½“ç±»å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–å¤„ç†ï¼Œé€šè¿‡æ•°æ®æµå†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼ŒObjectOutputStreamã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>du<span class="token punctuation">.</span>demo3</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>du<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileOutputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ObjectOutputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">OutputStream</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;å¼ ä¸‰&quot;</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">OutputStream</span> outputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/du/Desktop/obj.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectOutputStream</span> objectOutputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>outputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectOutputStream<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectOutputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectOutputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ååºåˆ—åŒ–</p></blockquote><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/du/Desktop/obj.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectInputStream</span> objectInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> objectInputStream<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        inputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_10ã€io-æµçš„åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#_10ã€io-æµçš„åº”ç”¨"><span>10ã€IO æµçš„åº”ç”¨</span></a></h2><p>IO æµå°±æ˜¯å®Œæˆæ–‡ä»¶ä¼ è¾“ï¼ˆä¸Šä¼ æ–‡ä»¶ï¼šå‘æœ‹å‹åœˆã€æ¢å¤´åƒï¼Œæ–‡ä»¶ä¸‹è½½ï¼šCSDN ä¸‹è½½æºä»£ç ã€æ–‡æ¡£ï¼‰</p><p>å­—ç¬¦ a ä½ å¥½</p><p>æ–‡æœ¬ç±»å‹çš„æ•°æ®ï¼ˆtxtã€wordã€Excelã€MDï¼‰å¯ä»¥ä½¿ç”¨å­—ç¬¦å»è¯»å–ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ç”¨å­—èŠ‚ï¼‰</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test3</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Reader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/du/Desktop/test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BufferedReader</span> bufferedReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Writer</span> writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWriter</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/du/myjava/test.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BufferedWriter</span> bufferedWriter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedWriter</span><span class="token punctuation">(</span>writer<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>str <span class="token operator">=</span> bufferedReader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            bufferedWriter<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            num<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä¼ è¾“å®Œæ¯•ï¼Œå…±è¯»å–äº†&quot;</span><span class="token operator">+</span>num<span class="token operator">+</span><span class="token string">&quot;æ¬¡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bufferedWriter<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bufferedWriter<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bufferedReader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        reader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éæ–‡æœ¬ç±»å‹çš„æ•°æ®ï¼ˆå›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ï¼‰ä¸èƒ½ç”¨å­—ç¬¦å»è¯»å–ï¼Œåªèƒ½ç”¨å­—èŠ‚å»è¯»ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//1ã€é€šè¿‡è¾“å…¥æµå°†æ–‡ä»¶è¯»å…¥åˆ° Java</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/du/Desktop/1.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2ã€é€šè¿‡è¾“å‡ºæµå°†æ–‡ä»¶ä» Java ä¸­å†™å…¥åˆ° myjava</span>
        <span class="token class-name">OutputStream</span> outputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/du/myjava/1.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> temp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>temp <span class="token operator">=</span> inputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            num<span class="token operator">++</span><span class="token punctuation">;</span>
            outputStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä¼ è¾“å®Œæ¯•ï¼Œå…±è€—æ—¶&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        outputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        inputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_11ã€ç½‘ç»œç¼–ç¨‹" tabindex="-1"><a class="header-anchor" href="#_11ã€ç½‘ç»œç¼–ç¨‹"><span>11ã€ç½‘ç»œç¼–ç¨‹</span></a></h2><blockquote><p>æ–‡ç« </p></blockquote><p><a href="https://www.cnblogs.com/88223100/p/Deeply-learn-the-implementation-principle-of-IO-multiplexing-select_poll_epoll.html" target="_blank" rel="noopener noreferrer">æ·±å…¥å­¦ä¹ IOå¤šè·¯å¤ç”¨ select/poll/epoll å®ç°åŸç† <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="des" tabindex="-1"><a class="header-anchor" href="#des"><span>DES</span></a></h3><h4 id="ç½‘ç»œç¼–ç¨‹" tabindex="-1"><a class="header-anchor" href="#ç½‘ç»œç¼–ç¨‹"><span>ç½‘ç»œç¼–ç¨‹</span></a></h4><p>ç½‘ç»œç¼–ç¨‹ï¼Œå°±æ˜¯åœ¨ä¸€å®šçš„åè®®ä¸‹ï¼Œå®ç°ä¸¤å°è®¡ç®—æœºçš„é€šä¿¡çš„æŠ€æœ¯</p><p>é€šä¿¡ä¸€å®šæ˜¯åŸºäºè½¯ä»¶ç»“æ„å®ç°çš„:</p><ul><li>C/S ç»“æ„ ï¼šå…¨ç§°ä¸º Client/Server ç»“æ„ï¼Œæ˜¯æŒ‡å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç»“æ„ï¼Œå¸¸è§ç¨‹åºæœ‰ QQã€IDEA ç­‰è½¯ä»¶</li><li>B/S ç»“æ„ ï¼šå…¨ç§°ä¸º Browser/Server ç»“æ„ï¼Œæ˜¯æŒ‡æµè§ˆå™¨å’ŒæœåŠ¡å™¨ç»“æ„</li></ul><p>ä¸¤ç§æ¶æ„å„æœ‰ä¼˜åŠ¿ï¼Œä½†æ˜¯æ— è®ºå“ªç§æ¶æ„ï¼Œéƒ½ç¦»ä¸å¼€ç½‘ç»œçš„æ”¯æŒ</p><p>ç½‘ç»œé€šä¿¡çš„ä¸‰è¦ç´ ï¼š</p><ol><li>åè®®ï¼šè®¡ç®—æœºç½‘ç»œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šä¿¡å¿…é¡»çº¦å®šå’Œå½¼æ­¤éµå®ˆçš„é€šä¿¡è§„åˆ™ï¼ŒHTTPã€FTPã€TCPã€UDPã€SMTP</li><li>IP åœ°å€ï¼šäº’è”ç½‘åè®®åœ°å€ï¼ˆInternet Protocol Addressï¼‰ï¼Œç”¨æ¥ç»™ä¸€ä¸ªç½‘ç»œä¸­çš„è®¡ç®—æœºè®¾å¤‡åšå”¯ä¸€çš„ç¼–å·</li></ol><ul><li><p>IPv4ï¼š4 ä¸ªå­—èŠ‚ï¼Œ32 ä½ç»„æˆï¼Œ192.168.1.1</p></li><li><p>IPv6ï¼šå¯ä»¥å®ç°ä¸ºæ‰€æœ‰è®¾å¤‡åˆ†é… IPï¼Œ128 ä½</p></li><li><p>ipconfigï¼šæŸ¥çœ‹æœ¬æœºçš„ IP</p></li><li><p>ping æ£€æŸ¥æœ¬æœºä¸æŸä¸ª IP æŒ‡å®šçš„æœºå™¨æ˜¯å¦è”é€šï¼Œæˆ–è€…è¯´æ˜¯æ£€æµ‹å¯¹æ–¹æ˜¯å¦åœ¨çº¿ã€‚</p></li><li><p>ping ç©ºæ ¼ IPåœ°å€ ï¼šping 220.181.57.216ï¼Œping www.baidu.com</p></li></ul><p>ç‰¹æ®Šçš„IPåœ°å€ï¼š æœ¬æœºIPåœ°å€ï¼Œ<strong>127.0.0.1 == localhost</strong>ï¼Œå›ç¯æµ‹è¯•</p><ol><li>ç«¯å£ï¼šç«¯å£å·å°±å¯ä»¥å”¯ä¸€æ ‡è¯†è®¾å¤‡ä¸­çš„è¿›ç¨‹ï¼ˆåº”ç”¨ç¨‹åºï¼‰ã€‚ç«¯å£å·æ˜¯ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºçš„æ•´æ•°ï¼Œå–å€¼èŒƒå›´æ˜¯ 0-65535ï¼Œ0-1023 ä¹‹é—´çš„ç«¯å£å·ç”¨äºä¸€äº›çŸ¥åçš„ç½‘ç»œæœåŠ¡å’Œåº”ç”¨æ™®é€šçš„åº”ç”¨ç¨‹åºéœ€è¦ä½¿ç”¨ 1024 ä»¥ä¸Šçš„ç«¯å£å·ã€‚å¦‚æœç«¯å£å·è¢«å¦å¤–ä¸€ä¸ªæœåŠ¡æˆ–åº”ç”¨æ‰€å ç”¨ï¼Œä¼šå¯¼è‡´å½“å‰ç¨‹åºå¯åŠ¨å¤±è´¥ï¼ŒæŠ¥å‡ºç«¯å£è¢«å ç”¨å¼‚å¸¸</li></ol><p>åˆ©ç”¨<strong>åè®®+IP åœ°å€+ç«¯å£å·</strong>ä¸‰å…ƒç»„åˆï¼Œå°±å¯ä»¥æ ‡è¯†ç½‘ç»œä¸­çš„è¿›ç¨‹äº†ï¼Œé‚£ä¹ˆè¿›ç¨‹é—´çš„é€šä¿¡å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ ‡è¯†ä¸å…¶å®ƒè¿›ç¨‹è¿›è¡Œäº¤äº’</p><p>å‚è€ƒè§†é¢‘ï¼šhttps://www.bilibili.com/video/BV1kT4y1M7vt</p><h4 id="é€šä¿¡åè®®" tabindex="-1"><a class="header-anchor" href="#é€šä¿¡åè®®"><span>é€šä¿¡åè®®</span></a></h4><p>ç½‘ç»œé€šä¿¡åè®®ï¼šå¯¹è®¡ç®—æœºå¿…é¡»éµå®ˆçš„è§„åˆ™ï¼Œåªæœ‰éµå®ˆè¿™äº›è§„åˆ™ï¼Œè®¡ç®—æœºä¹‹é—´æ‰èƒ½è¿›è¡Œé€šä¿¡</p><p>é€šä¿¡<strong>æ˜¯è¿›ç¨‹ä¸è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡</strong>ï¼Œä¸æ˜¯ä¸»æœºä¸ä¸»æœºä¹‹é—´çš„é€šä¿¡</p><p>TCP/IPåè®®ï¼šä¼ è¾“æ§åˆ¶åè®® (Transmission Control Protocol)</p><p>ä¼ è¾“æ§åˆ¶åè®® TCPï¼ˆTransmission Control Protocolï¼‰æ˜¯é¢å‘è¿æ¥çš„ï¼Œæä¾›å¯é äº¤ä»˜ï¼Œæœ‰æµé‡æ§åˆ¶ï¼Œæ‹¥å¡æ§åˆ¶ï¼Œæä¾›å…¨åŒå·¥é€šä¿¡ï¼Œé¢å‘å­—èŠ‚æµï¼Œæ¯ä¸€æ¡ TCP è¿æ¥åªèƒ½æ˜¯ç‚¹å¯¹ç‚¹çš„ï¼ˆä¸€å¯¹ä¸€ï¼‰</p><ul><li>åœ¨é€šä¿¡ä¹‹å‰å¿…é¡»ç¡®å®šå¯¹æ–¹åœ¨çº¿å¹¶ä¸”è¿æ¥æˆåŠŸæ‰å¯ä»¥é€šä¿¡</li><li>ä¾‹å¦‚ä¸‹è½½æ–‡ä»¶ã€æµè§ˆç½‘é¡µç­‰ï¼ˆè¦æ±‚å¯é ä¼ è¾“ï¼‰</li></ul><p>ç”¨æˆ·æ•°æ®æŠ¥åè®® UDPï¼ˆUser Datagram Protocolï¼‰æ˜¯æ— è¿æ¥çš„ï¼Œå°½æœ€å¤§å¯èƒ½äº¤ä»˜ï¼Œä¸å¯é ï¼Œæ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œé¢å‘æŠ¥æ–‡ï¼Œæ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡</p><ul><li>ç›´æ¥å‘æ¶ˆæ¯ç»™å¯¹æ–¹ï¼Œä¸ç®¡å¯¹æ–¹æ˜¯å¦åœ¨çº¿ï¼Œå‘æ¶ˆæ¯åä¹Ÿä¸éœ€è¦ç¡®è®¤</li><li>æ— çº¿ï¼ˆè§†é¢‘ä¼šè®®ï¼Œé€šè¯ï¼‰ï¼Œæ€§èƒ½å¥½ï¼Œå¯èƒ½ä¸¢å¤±ä¸€äº›æ•°æ®</li></ul><h4 id="javaæ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#javaæ¨¡å‹"><span>Javaæ¨¡å‹</span></a></h4><p>ç›¸å…³æ¦‚å¿µï¼š</p><ul><li>åŒæ­¥ï¼šå½“å‰çº¿ç¨‹è¦è‡ªå·±è¿›è¡Œæ•°æ®çš„è¯»å†™æ“ä½œï¼ˆè‡ªå·±å»é“¶è¡Œå–é’±ï¼‰</li><li>å¼‚æ­¥ï¼šå½“å‰çº¿ç¨‹å¯ä»¥å»åšå…¶ä»–äº‹æƒ…ï¼ˆå§”æ‰˜åˆ«äººæ‹¿é“¶è¡Œå¡åˆ°é“¶è¡Œå–é’±ï¼Œç„¶åç»™ä½ ï¼‰</li><li>é˜»å¡ï¼šåœ¨æ•°æ®æ²¡æœ‰çš„æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯è¦ç»§ç»­ç­‰å¾…ç€è¯»ï¼ˆæ’é˜Ÿç­‰å¾…ï¼‰</li><li>éé˜»å¡ï¼šåœ¨æ•°æ®æ²¡æœ‰çš„æƒ…å†µä¸‹ï¼Œä¼šå»åšå…¶ä»–äº‹æƒ…ï¼Œä¸€æ—¦æœ‰äº†æ•°æ®å†æ¥è·å–ï¼ˆæŸœå°å–æ¬¾ï¼Œå–ä¸ªå·ï¼Œç„¶åååœ¨æ¤…å­ä¸Šåšå…¶å®ƒäº‹ï¼Œç­‰å·å¹¿æ’­ä¼šé€šçŸ¥ä½ åŠç†ï¼‰</li></ul><p>Java ä¸­çš„é€šä¿¡æ¨¡å‹:</p><ol><li>BIO è¡¨ç¤ºåŒæ­¥é˜»å¡å¼é€šä¿¡ï¼ŒæœåŠ¡å™¨å®ç°æ¨¡å¼ä¸ºä¸€ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹ï¼Œå³å®¢æˆ·ç«¯æœ‰è¿æ¥è¯·æ±‚æ—¶æœåŠ¡å™¨ç«¯å°±éœ€è¦å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œå¦‚æœè¿™ä¸ªè¿æ¥ä¸åšä»»ä½•äº‹æƒ…ä¼šé€ æˆä¸å¿…è¦çš„çº¿ç¨‹å¼€é”€ï¼Œå¯ä»¥é€šè¿‡çº¿ç¨‹æ± æœºåˆ¶æ”¹å–„ åŒæ­¥é˜»å¡å¼æ€§èƒ½æå·®ï¼šå¤§é‡çº¿ç¨‹ï¼Œå¤§é‡é˜»å¡</li><li>ä¼ªå¼‚æ­¥é€šä¿¡ï¼šå¼•å…¥çº¿ç¨‹æ± ï¼Œä¸éœ€è¦ä¸€ä¸ªå®¢æˆ·ç«¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ç°çº¿ç¨‹å¤ç”¨æ¥å¤„ç†å¾ˆå¤šä¸ªå®¢æˆ·ç«¯ï¼Œçº¿ç¨‹å¯æ§ é«˜å¹¶å‘ä¸‹æ€§èƒ½è¿˜æ˜¯å¾ˆå·®ï¼šçº¿ç¨‹æ•°é‡å°‘ï¼Œæ•°æ®ä¾ç„¶æ˜¯é˜»å¡çš„ï¼Œæ•°æ®æ²¡æœ‰æ¥çº¿ç¨‹è¿˜æ˜¯è¦ç­‰å¾…</li><li>NIO è¡¨ç¤º<strong>åŒæ­¥éé˜»å¡ IO</strong>ï¼ŒæœåŠ¡å™¨å®ç°æ¨¡å¼ä¸ºè¯·æ±‚å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œå®¢æˆ·ç«¯å‘é€çš„è¿æ¥ä¼šæ³¨å†Œåˆ°å¤šè·¯å¤ç”¨å™¨ä¸Šï¼Œå¤šè·¯å¤ç”¨å™¨è½®è¯¢åˆ°è¿æ¥æœ‰ I/O è¯·æ±‚æ—¶æ‰å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç† å·¥ä½œåŸç†ï¼š1 ä¸ªä¸»çº¿ç¨‹ä¸“é—¨è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯ï¼Œ1 ä¸ªçº¿ç¨‹è½®è¯¢æ‰€æœ‰çš„å®¢æˆ·ç«¯ï¼Œå‘æ¥äº†æ•°æ®æ‰ä¼šå¼€å¯çº¿ç¨‹å¤„ç† åŒæ­¥ï¼šçº¿ç¨‹è¿˜è¦ä¸æ–­çš„æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ï¼Œä»¥åŠå¤„ç†æ•°æ® éé˜»å¡ï¼šå¦‚æœä¸€ä¸ªç®¡é“æ²¡æœ‰æ•°æ®ï¼Œä¸éœ€è¦ç­‰å¾…ï¼Œå¯ä»¥è½®è¯¢ä¸‹ä¸€ä¸ªç®¡é“æ˜¯å¦æœ‰æ•°æ®</li><li>AIO è¡¨ç¤ºå¼‚æ­¥éé˜»å¡ IOï¼ŒAIO å¼•å…¥å¼‚æ­¥é€šé“çš„æ¦‚å¿µï¼Œé‡‡ç”¨äº† Proactor æ¨¡å¼ï¼Œæœ‰æ•ˆçš„è¯·æ±‚æ‰å¯åŠ¨çº¿ç¨‹ï¼Œç‰¹ç‚¹æ˜¯å…ˆç”±æ“ä½œç³»ç»Ÿå®Œæˆåæ‰é€šçŸ¥æœåŠ¡ç«¯ç¨‹åºå¯åŠ¨çº¿ç¨‹å»å¤„ç†ï¼Œä¸€èˆ¬é€‚ç”¨äºè¿æ¥æ•°è¾ƒå¤šä¸”è¿æ¥æ—¶é—´è¾ƒé•¿çš„åº”ç”¨ å¼‚æ­¥ï¼šæœåŠ¡ç«¯çº¿ç¨‹æ¥æ”¶åˆ°äº†å®¢æˆ·ç«¯ç®¡é“ä»¥åå°±äº¤ç»™åº•å±‚å¤„ç† IO é€šä¿¡ï¼Œçº¿ç¨‹å¯ä»¥åšå…¶ä»–äº‹æƒ… éé˜»å¡ï¼šåº•å±‚ä¹Ÿæ˜¯å®¢æˆ·ç«¯æœ‰æ•°æ®æ‰ä¼šå¤„ç†ï¼Œæœ‰äº†æ•°æ®ä»¥åå¤„ç†å¥½é€šçŸ¥æœåŠ¡å™¨åº”ç”¨æ¥å¯åŠ¨çº¿ç¨‹è¿›è¡Œå¤„ç†</li></ol><p>å„ç§æ¨¡å‹åº”ç”¨åœºæ™¯ï¼š</p><ul><li>BIO é€‚ç”¨äºè¿æ¥æ•°ç›®æ¯”è¾ƒå°ä¸”å›ºå®šçš„æ¶æ„ï¼Œè¯¥æ–¹å¼å¯¹æœåŠ¡å™¨èµ„æºè¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼Œç¨‹åºç®€å•</li><li>NIO é€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒçŸ­ï¼ˆè½»æ“ä½œï¼‰çš„æ¶æ„ï¼Œå¦‚èŠå¤©æœåŠ¡å™¨ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼Œç¼–ç¨‹å¤æ‚ï¼ŒJDK 1.4 å¼€å§‹æ”¯æŒ</li><li>AIO é€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒé•¿ï¼ˆé‡æ“ä½œï¼‰çš„æ¶æ„ï¼Œå¦‚ç›¸å†ŒæœåŠ¡å™¨ï¼Œå……åˆ†è°ƒç”¨æ“ä½œç³»ç»Ÿå‚ä¸å¹¶å‘æ“ä½œï¼ŒJDK 1.7 å¼€å§‹æ”¯æŒ</li></ul><h3 id="i-o" tabindex="-1"><a class="header-anchor" href="#i-o"><span>I/O</span></a></h3><h4 id="ioæ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#ioæ¨¡å‹"><span>IOæ¨¡å‹</span></a></h4><h5 id="äº”ç§æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#äº”ç§æ¨¡å‹"><span>äº”ç§æ¨¡å‹</span></a></h5><p>å¯¹äºä¸€ä¸ªå¥—æ¥å­—ä¸Šçš„è¾“å…¥æ“ä½œï¼Œç¬¬ä¸€æ­¥æ˜¯ç­‰å¾…æ•°æ®ä»ç½‘ç»œä¸­åˆ°è¾¾ï¼Œå½“æ•°æ®åˆ°è¾¾æ—¶è¢«å¤åˆ¶åˆ°å†…æ ¸ä¸­çš„æŸä¸ªç¼“å†²åŒºã€‚ç¬¬äºŒæ­¥å°±æ˜¯æŠŠæ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒº</p><p>Linux æœ‰äº”ç§ I/O æ¨¡å‹ï¼š</p><ul><li>é˜»å¡å¼ I/O</li><li>éé˜»å¡å¼ I/O</li><li>I/O å¤ç”¨ï¼ˆselect å’Œ pollï¼‰</li><li>ä¿¡å·é©±åŠ¨å¼ I/Oï¼ˆSIGIOï¼‰</li><li>å¼‚æ­¥ I/Oï¼ˆAIOï¼‰</li></ul><p>äº”ç§æ¨¡å‹å¯¹æ¯”ï¼š</p><ul><li><p>åŒæ­¥ I/O åŒ…æ‹¬é˜»å¡å¼ I/Oã€éé˜»å¡å¼ I/Oã€I/O å¤ç”¨å’Œä¿¡å·é©±åŠ¨ I/O ï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œéé˜»å¡å¼ I/O ã€ä¿¡å·é©±åŠ¨ I/O å’Œå¼‚æ­¥ I/O åœ¨ç¬¬ä¸€é˜¶æ®µä¸ä¼šé˜»å¡</p></li><li><p>åŒæ­¥ I/Oï¼šå°†æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºçš„é˜¶æ®µï¼ˆç¬¬äºŒé˜¶æ®µï¼‰ï¼Œåº”ç”¨è¿›ç¨‹ä¼šé˜»å¡</p></li><li><p>å¼‚æ­¥ I/Oï¼šç¬¬äºŒé˜¶æ®µåº”ç”¨è¿›ç¨‹ä¸ä¼šé˜»å¡</p></li></ul><h5 id="é˜»å¡å¼io" tabindex="-1"><a class="header-anchor" href="#é˜»å¡å¼io"><span>é˜»å¡å¼IO</span></a></h5><p>åº”ç”¨è¿›ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨ recvfrom æ¥æ”¶æ•°æ®ï¼Œä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºä¸­æ‰è¿”å›ã€‚é˜»å¡ä¸æ„å‘³ç€æ•´ä¸ªæ“ä½œç³»ç»Ÿéƒ½è¢«é˜»å¡ï¼Œå…¶å®ƒåº”ç”¨è¿›ç¨‹è¿˜å¯ä»¥æ‰§è¡Œï¼Œåªæ˜¯å½“å‰é˜»å¡è¿›ç¨‹ä¸æ¶ˆè€— CPU æ—¶é—´ï¼Œè¿™ç§æ¨¡å‹çš„ CPU åˆ©ç”¨ç‡ä¼šæ¯”è¾ƒé«˜</p><p>recvfrom() ç”¨äº<strong>æ¥æ”¶ Socket ä¼ æ¥çš„æ•°æ®ï¼Œå¹¶å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹çš„ç¼“å†²åŒº buf ä¸­</strong>ï¼ŒæŠŠ recvfrom() å½“æˆç³»ç»Ÿè°ƒç”¨</p><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877312490-f4d5aa1d-ca44-412a-87ee-0e4a7c5f690c.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h5 id="éé˜»å¡å¼" tabindex="-1"><a class="header-anchor" href="#éé˜»å¡å¼"><span>éé˜»å¡å¼</span></a></h5><p>åº”ç”¨è¿›ç¨‹é€šè¿‡ recvfrom è°ƒç”¨ä¸åœçš„å»å’Œå†…æ ¸äº¤äº’ï¼Œç›´åˆ°å†…æ ¸å‡†å¤‡å¥½æ•°æ®ã€‚å¦‚æœæ²¡æœ‰å‡†å¤‡å¥½æ•°æ®ï¼Œå†…æ ¸è¿”å›ä¸€ä¸ªé”™è¯¯ç ï¼Œè¿‡ä¸€æ®µæ—¶é—´åº”ç”¨è¿›ç¨‹å†æ‰§è¡Œ recvfrom ç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨ä¸¤æ¬¡å‘é€è¯·æ±‚çš„æ—¶é—´æ®µï¼Œè¿›ç¨‹å¯ä»¥è¿›è¡Œå…¶ä»–ä»»åŠ¡ï¼Œè¿™ç§æ–¹å¼ç§°ä¸ºè½®è¯¢ï¼ˆpollingï¼‰</p><p>ç”±äº CPU è¦å¤„ç†æ›´å¤šçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå› æ­¤è¿™ç§æ¨¡å‹çš„ CPU åˆ©ç”¨ç‡æ¯”è¾ƒä½</p><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877312467-49203424-a7df-4913-9bd6-657680128e6f.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h5 id="ä¿¡å·é©±åŠ¨" tabindex="-1"><a class="header-anchor" href="#ä¿¡å·é©±åŠ¨"><span>ä¿¡å·é©±åŠ¨</span></a></h5><p>åº”ç”¨è¿›ç¨‹ä½¿ç”¨ sigaction ç³»ç»Ÿè°ƒç”¨ï¼Œå†…æ ¸ç«‹å³è¿”å›ï¼Œåº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œç­‰å¾…æ•°æ®é˜¶æ®µåº”ç”¨è¿›ç¨‹æ˜¯éé˜»å¡çš„ã€‚å½“å†…æ ¸æ•°æ®å‡†å¤‡å°±ç»ªæ—¶å‘åº”ç”¨è¿›ç¨‹å‘é€ SIGIO ä¿¡å·ï¼Œåº”ç”¨è¿›ç¨‹æ”¶åˆ°ä¹‹ååœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­è°ƒç”¨ recvfrom å°†æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ä¸­</p><p>ç›¸æ¯”äºéé˜»å¡å¼ I/O çš„è½®è¯¢æ–¹å¼ï¼Œä¿¡å·é©±åŠ¨ I/O çš„ CPU åˆ©ç”¨ç‡æ›´é«˜</p><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877312497-9ff2fb9a-6309-4948-86dd-59535f168a5b.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h5 id="io-å¤ç”¨" tabindex="-1"><a class="header-anchor" href="#io-å¤ç”¨"><span>IO å¤ç”¨</span></a></h5><p>IO å¤ç”¨æ¨¡å‹ä½¿ç”¨ select æˆ–è€… poll å‡½æ•°ç­‰å¾…æ•°æ®ï¼Œselect ä¼šç›‘å¬æ‰€æœ‰æ³¨å†Œå¥½çš„ IOï¼Œ<strong>ç­‰å¾…å¤šä¸ªå¥—æ¥å­—ä¸­çš„ä»»ä½•ä¸€ä¸ªå˜ä¸ºå¯è¯»</strong>ï¼Œç­‰å¾…è¿‡ç¨‹ä¼šè¢«é˜»å¡ï¼Œå½“æŸä¸ªå¥—æ¥å­—å‡†å¤‡å¥½æ•°æ®å˜ä¸ºå¯è¯»æ—¶ select è°ƒç”¨å°±è¿”å›ï¼Œç„¶åè°ƒç”¨ recvfrom æŠŠæ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°è¿›ç¨‹ä¸­</p><p>IO å¤ç”¨è®©å•ä¸ªè¿›ç¨‹å…·æœ‰å¤„ç†å¤šä¸ª I/O äº‹ä»¶çš„èƒ½åŠ›ï¼Œåˆè¢«ç§°ä¸º Event Driven I/Oï¼Œå³<strong>äº‹ä»¶é©±åŠ¨ I/O</strong></p><p>å¦‚æœä¸€ä¸ª Web æœåŠ¡å™¨æ²¡æœ‰ I/O å¤ç”¨ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ª Socket è¿æ¥éƒ½è¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»å¤„ç†ï¼Œå¦‚æœåŒæ—¶æœ‰å‡ ä¸‡ä¸ªè¿æ¥ï¼Œå°±éœ€è¦åˆ›å»ºç›¸åŒæ•°é‡çš„çº¿ç¨‹ã€‚ç›¸æ¯”äºå¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹æŠ€æœ¯ï¼ŒI/O å¤ç”¨ä¸éœ€è¦è¿›ç¨‹çº¿ç¨‹åˆ›å»ºå’Œåˆ‡æ¢çš„å¼€é”€ï¼Œç³»ç»Ÿå¼€é”€æ›´å°</p><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877312578-7c8ed9c9-f015-4e90-83f7-b7cbc643d643.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h5 id="å¼‚æ­¥-io" tabindex="-1"><a class="header-anchor" href="#å¼‚æ­¥-io"><span>å¼‚æ­¥ IO</span></a></h5><p>åº”ç”¨è¿›ç¨‹æ‰§è¡Œ aio_read ç³»ç»Ÿè°ƒç”¨ä¼šç«‹å³è¿”å›ï¼Œç»™å†…æ ¸ä¼ é€’æè¿°ç¬¦ã€ç¼“å†²åŒºæŒ‡é’ˆã€ç¼“å†²åŒºå¤§å°ç­‰ã€‚åº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œä¸ä¼šè¢«é˜»å¡ï¼Œå†…æ ¸ä¼šåœ¨æ‰€æœ‰æ“ä½œå®Œæˆä¹‹åå‘åº”ç”¨è¿›ç¨‹å‘é€ä¿¡å·</p><p>å¼‚æ­¥ I/O ä¸ä¿¡å·é©±åŠ¨ I/O çš„åŒºåˆ«åœ¨äºï¼Œå¼‚æ­¥ I/O çš„ä¿¡å·æ˜¯é€šçŸ¥åº”ç”¨è¿›ç¨‹ I/O å®Œæˆï¼Œè€Œä¿¡å·é©±åŠ¨ I/O çš„ä¿¡å·æ˜¯é€šçŸ¥åº”ç”¨è¿›ç¨‹å¯ä»¥å¼€å§‹ I/O</p><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877312488-57fbe5e0-1bec-47fa-ad07-9a82e9f53f9b.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="å¤šè·¯å¤ç”¨" tabindex="-1"><a class="header-anchor" href="#å¤šè·¯å¤ç”¨"><span>å¤šè·¯å¤ç”¨</span></a></h4><h5 id="select" tabindex="-1"><a class="header-anchor" href="#select"><span>select</span></a></h5><h6 id="å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#å‡½æ•°"><span>å‡½æ•°</span></a></h6><p>Socket ä¸æ˜¯æ–‡ä»¶ï¼Œåªæ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œä½†æ˜¯ Unix æ“ä½œç³»ç»ŸæŠŠæ‰€æœ‰ä¸œè¥¿éƒ½<strong>çœ‹ä½œ</strong>æ˜¯æ–‡ä»¶ï¼Œæ‰€ä»¥ Socket è¯´æˆ file descriptorï¼Œä¹Ÿå°±æ˜¯ fd</p><p>select å…è®¸åº”ç”¨ç¨‹åºç›‘è§†ä¸€ç»„æ–‡ä»¶æè¿°ç¬¦ï¼Œç­‰å¾…ä¸€ä¸ªæˆ–è€…å¤šä¸ªæè¿°ç¬¦æˆä¸ºå°±ç»ªçŠ¶æ€ï¼Œä»è€Œå®Œæˆ I/O æ“ä½œã€‚</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span> fd_set <span class="token operator">*</span>readfds<span class="token punctuation">,</span> fd_set <span class="token operator">*</span>writefds<span class="token punctuation">,</span> fd_set <span class="token operator">*</span>exceptfds<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">timeval</span> <span class="token operator">*</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>fd_set ä½¿ç”¨ <strong>bitmap æ•°ç»„</strong>å®ç°ï¼Œæ•°ç»„å¤§å°ç”¨ FD_SETSIZE å®šä¹‰ï¼Œ<strong>å•è¿›ç¨‹</strong>åªèƒ½ç›‘å¬å°‘äº FD_SETSIZE æ•°é‡çš„æè¿°ç¬¦ï¼Œ32 ä½æœºé»˜è®¤æ˜¯ 1024 ä¸ªï¼Œ64 ä½æœºé»˜è®¤æ˜¯ 2048ï¼Œå¯ä»¥å¯¹è¿›è¡Œä¿®æ”¹ï¼Œç„¶åé‡æ–°ç¼–è¯‘å†…æ ¸</li><li>fd_set æœ‰ä¸‰ç§ç±»å‹çš„æè¿°ç¬¦ï¼šreadsetã€writesetã€exceptsetï¼Œå¯¹åº”è¯»ã€å†™ã€å¼‚å¸¸æ¡ä»¶çš„æè¿°ç¬¦é›†åˆ</li><li>n æ˜¯ç›‘æµ‹çš„ socket çš„æœ€å¤§æ•°é‡</li><li>timeout ä¸ºè¶…æ—¶å‚æ•°ï¼Œè°ƒç”¨ select ä¼šä¸€ç›´<strong>é˜»å¡</strong>ç›´åˆ°æœ‰æè¿°ç¬¦çš„äº‹ä»¶åˆ°è¾¾æˆ–è€…ç­‰å¾…çš„æ—¶é—´è¶…è¿‡ timeout</li></ul><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">timeval</span><span class="token punctuation">{</span>
    <span class="token keyword">long</span> tv_sec<span class="token punctuation">;</span> 	<span class="token comment">//ç§’</span>
    <span class="token keyword">long</span> tv_usec<span class="token punctuation">;</span>	<span class="token comment">//å¾®ç§’</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>timeout == nullï¼šç­‰å¾…æ— é™é•¿çš„æ—¶é—´</p></li><li><p>tv_sec == 0 &amp;&amp; tv_usec == 0ï¼šè·å–åç›´æ¥è¿”å›ï¼Œä¸é˜»å¡ç­‰å¾…</p></li><li><p>tv_sec != 0 || tv_usec != 0ï¼šç­‰å¾…æŒ‡å®šæ—¶é—´</p></li><li><p>æ–¹æ³•æˆåŠŸè°ƒç”¨è¿”å›ç»“æœä¸º<strong>å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦ä¸ªæ•°</strong>ï¼Œå‡ºé”™è¿”å›ç»“æœä¸º -1ï¼Œè¶…æ—¶è¿”å›ç»“æœä¸º 0</p></li></ul><p>Linux æä¾›äº†ä¸€ç»„å®ä¸º fd_set è¿›è¡Œèµ‹å€¼æ“ä½œï¼š</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">FD_ZERO</span><span class="token punctuation">(</span>fd_set <span class="token operator">*</span>fdset<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// å°†ä¸€ä¸ª fd_set ç±»å‹å˜é‡çš„æ‰€æœ‰å€¼éƒ½ç½®ä¸º 0</span>
<span class="token keyword">int</span> <span class="token function">FD_CLR</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">,</span> fd_set <span class="token operator">*</span>fdset<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// å°†ä¸€ä¸ª fd_set ç±»å‹å˜é‡çš„ fd ä½ç½®ä¸º 0</span>
<span class="token keyword">int</span> <span class="token function">FD_SET</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">,</span> fd_set <span class="token operator">*</span>fdset<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// å°†ä¸€ä¸ª fd_set ç±»å‹å˜é‡çš„ fd ä½ç½®ä¸º 1</span>
<span class="token keyword">int</span> <span class="token function">FD_ISSET</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">,</span> fd_set <span class="token operator">*</span>fdset<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ¤æ–­ fd ä½æ˜¯å¦è¢«ç½®ä¸º 1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¤ºä¾‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code>sockfd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> INADDR_ANY<span class="token punctuation">;</span>
<span class="token function">bind</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>addr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç»‘å®šè¿æ¥</span>
<span class="token function">listen</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç›‘å¬5ä¸ªç«¯å£</span>
<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>client<span class="token punctuation">,</span> e<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    addrlen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span>
	fds<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>client<span class="token punctuation">,</span> <span class="token operator">&amp;</span>addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å°†ç›‘å¬çš„å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦fdå­˜å…¥fdsï¼š[3,4,5,6,7]</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fds<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> max<span class="token punctuation">)</span>
		max <span class="token operator">=</span> fds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">FD_ZERO</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rset<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç½®ä¸º0</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token function">FD_SET</span><span class="token punctuation">(</span>fds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>rset<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¯¹åº”ä½ç½®1 [0001 1111 00.....]</span>
	<span class="token punctuation">}</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;round again&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">select</span><span class="token punctuation">(</span>max <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>rset<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç›‘å¬</span>
    
	<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FD_ISSET</span><span class="token punctuation">(</span>fds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>rset<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//åˆ¤æ–­ç›‘å¬å“ªä¸€ä¸ªç«¯å£</span>
            <span class="token function">memset</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> MAXBUF<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">read</span><span class="token punctuation">(</span>fds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> MAXBUF<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿›å…¥å†…æ ¸æ€è¯»æ•°æ®</span>
            <span class="token function">print</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‚è€ƒè§†é¢‘ï¼šhttps://www.bilibili.com/video/BV19D4y1o797</p><h6 id="æµç¨‹" tabindex="-1"><a class="header-anchor" href="#æµç¨‹"><span>æµç¨‹</span></a></h6><p>select è°ƒç”¨æµç¨‹å›¾ï¼š</p><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877313167-c9d58861-9b89-4e45-8968-7e0b121c5cbf.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol><li>ä½¿ç”¨ copy_from_user ä»ç”¨æˆ·ç©ºé—´æ‹·è´ fd_set åˆ°å†…æ ¸ç©ºé—´ï¼Œè¿›ç¨‹é˜»å¡</li><li>æ³¨å†Œå›è°ƒå‡½æ•° _pollwait</li><li>éå†æ‰€æœ‰ fdï¼Œè°ƒç”¨å…¶å¯¹åº”çš„ poll æ–¹æ³•åˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦å‡†å¤‡å°±ç»ªï¼Œå¯¹äº socketï¼Œè¿™ä¸ª poll æ–¹æ³•æ˜¯ sock_pollï¼Œsock_poll æ ¹æ®æƒ…å†µä¼šè°ƒç”¨åˆ° tcp_pollã€udp_poll æˆ–è€… datagram_pollï¼Œä»¥ tcp_poll ä¸ºä¾‹ï¼Œå…¶æ ¸å¿ƒå®ç°å°±æ˜¯ _pollwait</li><li>_pollwait æŠŠ **currentï¼ˆè°ƒç”¨ select çš„è¿›ç¨‹ï¼‰**æŒ‚åˆ°è®¾å¤‡çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œä¸åŒè®¾å¤‡æœ‰ä¸åŒçš„ç­‰å¾…é˜Ÿåˆ—ï¼Œå¯¹äº tcp_poll ï¼Œå…¶ç­‰å¾…é˜Ÿåˆ—æ˜¯ sk â†’ sk_sleepï¼ˆæŠŠè¿›ç¨‹æŒ‚åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­å¹¶ä¸ä»£è¡¨è¿›ç¨‹å·²ç»ç¡çœ ï¼‰ï¼Œåœ¨è®¾å¤‡æ”¶åˆ°æ¶ˆæ¯ï¼ˆç½‘ç»œè®¾å¤‡ï¼‰æˆ–å¡«å†™å®Œæ–‡ä»¶æ•°æ®ï¼ˆç£ç›˜è®¾å¤‡ï¼‰åï¼Œä¼šå”¤é†’è®¾å¤‡ç­‰å¾…é˜Ÿåˆ—ä¸Šç¡çœ çš„è¿›ç¨‹ï¼Œè¿™æ—¶ current ä¾¿è¢«å”¤é†’ï¼Œè¿›å…¥å°±ç»ªé˜Ÿåˆ—</li><li>poll æ–¹æ³•è¿”å›æ—¶ä¼šè¿”å›ä¸€ä¸ªæè¿°è¯»å†™æ“ä½œæ˜¯å¦å°±ç»ªçš„ mask æ©ç ï¼Œæ ¹æ®è¿™ä¸ª mask æ©ç ç»™ fd_set èµ‹å€¼</li><li>å¦‚æœéå†å®Œæ‰€æœ‰çš„ fdï¼Œè¿˜æ²¡æœ‰è¿”å›ä¸€ä¸ªå¯è¯»å†™çš„ mask æ©ç ï¼Œåˆ™ä¼šè°ƒç”¨ schedule_timeout è®© current è¿›ç¨‹è¿›å…¥ç¡çœ ã€‚å½“è®¾å¤‡é©±åŠ¨å‘ç”Ÿè‡ªèº«èµ„æºå¯è¯»å†™åï¼Œä¼šå”¤é†’å…¶ç­‰å¾…é˜Ÿåˆ—ä¸Šç¡çœ çš„è¿›ç¨‹ï¼Œå¦‚æœè¶…è¿‡ä¸€å®šçš„è¶…æ—¶æ—¶é—´ï¼ˆschedule_timeoutï¼‰æ²¡æœ‰å…¶ä»–çº¿ç¨‹å”¤é†’ï¼Œåˆ™è°ƒç”¨ select çš„è¿›ç¨‹ä¼šé‡æ–°è¢«å”¤é†’è·å¾— CPUï¼Œè¿›è€Œé‡æ–°éå† fdï¼Œåˆ¤æ–­æœ‰æ²¡æœ‰å°±ç»ªçš„ fd</li><li>æŠŠ fd_set ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œé˜»å¡è¿›ç¨‹ç»§ç»­æ‰§è¡Œ</li></ol><p>å‚è€ƒæ–‡ç« ï¼šhttps://www.cnblogs.com/anker/p/3265058.html</p><p>å…¶ä»–æµç¨‹å›¾ï¼šhttps://www.processon.com/view/link/5f62b9a6e401fd2ad7e5d6d1</p><h5 id="poll" tabindex="-1"><a class="header-anchor" href="#poll"><span>poll</span></a></h5><p>poll çš„åŠŸèƒ½ä¸ select ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç­‰å¾…ä¸€ç»„æè¿°ç¬¦ä¸­çš„ä¸€ä¸ªæˆä¸ºå°±ç»ªçŠ¶æ€</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">poll</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">pollfd</span> <span class="token operator">*</span>fds<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> nfds<span class="token punctuation">,</span> <span class="token keyword">int</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>poll ä¸­çš„æè¿°ç¬¦æ˜¯ pollfd ç±»å‹çš„æ•°ç»„ï¼Œpollfd çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">pollfd</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span>   fd<span class="token punctuation">;</span>         <span class="token comment">/* file descriptor */</span>
    <span class="token keyword">short</span> events<span class="token punctuation">;</span>     <span class="token comment">/* requested events */</span>
    <span class="token keyword">short</span> revents<span class="token punctuation">;</span>    <span class="token comment">/* returned events */</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>select å’Œ poll å¯¹æ¯”ï¼š</p><ul><li><p>select ä¼šä¿®æ”¹æè¿°ç¬¦ï¼Œè€Œ poll ä¸ä¼š</p></li><li><p>select çš„æè¿°ç¬¦ç±»å‹ä½¿ç”¨æ•°ç»„å®ç°ï¼Œæœ‰æè¿°ç¬¦çš„é™åˆ¶ï¼›è€Œ poll ä½¿ç”¨<strong>é“¾è¡¨</strong>å®ç°ï¼Œæ²¡æœ‰æè¿°ç¬¦æ•°é‡çš„é™åˆ¶</p></li><li><p>poll æä¾›äº†æ›´å¤šçš„äº‹ä»¶ç±»å‹ï¼Œå¹¶ä¸”å¯¹æè¿°ç¬¦çš„é‡å¤åˆ©ç”¨ä¸Šæ¯” select é«˜</p></li><li><p>select å’Œ poll é€Ÿåº¦éƒ½æ¯”è¾ƒæ…¢ï¼Œ<strong>æ¯æ¬¡è°ƒç”¨</strong>éƒ½éœ€è¦å°†å…¨éƒ¨æè¿°ç¬¦æ•°ç»„ fd ä»åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºå¤åˆ¶åˆ°å†…æ ¸ç¼“å†²åŒºï¼ŒåŒæ—¶æ¯æ¬¡éƒ½éœ€è¦åœ¨å†…æ ¸éå†ä¼ é€’è¿›æ¥çš„æ‰€æœ‰ fd ï¼Œè¿™ä¸ªå¼€é”€åœ¨ fd å¾ˆå¤šæ—¶ä¼šå¾ˆå¤§</p></li><li><p>å‡ ä¹æ‰€æœ‰çš„ç³»ç»Ÿéƒ½æ”¯æŒ selectï¼Œä½†æ˜¯åªæœ‰æ¯”è¾ƒæ–°çš„ç³»ç»Ÿæ”¯æŒ poll</p></li><li><p>select å’Œ poll çš„æ—¶é—´å¤æ‚åº¦ O(n)ï¼Œå¯¹ socket è¿›è¡Œæ‰«ææ—¶æ˜¯çº¿æ€§æ‰«æï¼Œå³é‡‡ç”¨è½®è¯¢çš„æ–¹æ³•ï¼Œæ•ˆç‡è¾ƒä½ï¼Œå› ä¸ºå¹¶ä¸çŸ¥é“å…·ä½“æ˜¯å“ªä¸ª socket å…·æœ‰äº‹ä»¶ï¼Œæ‰€ä»¥éšç€ fd æ•°é‡çš„å¢åŠ ä¼šé€ æˆéå†é€Ÿåº¦æ…¢çš„<strong>çº¿æ€§ä¸‹é™</strong>æ€§èƒ½é—®é¢˜</p></li><li><p>poll è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯æ°´å¹³è§¦å‘ï¼Œå¦‚æœæŠ¥å‘Šäº† fd åï¼Œæ²¡æœ‰è¢«å¤„ç†ï¼Œé‚£ä¹ˆä¸‹æ¬¡ poll æ—¶ä¼šå†æ¬¡æŠ¥å‘Šè¯¥ fd</p></li><li><p>å¦‚æœä¸€ä¸ªçº¿ç¨‹å¯¹æŸä¸ªæè¿°ç¬¦è°ƒç”¨äº† select æˆ–è€… pollï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å…³é—­äº†è¯¥æè¿°ç¬¦ï¼Œä¼šå¯¼è‡´è°ƒç”¨ç»“æœä¸ç¡®å®š</p></li></ul><p>å‚è€ƒæ–‡ç« ï¼šhttps://github.com/CyC2018/CS-Notes/blob/master/notes/Socket.md</p><h5 id="epoll" tabindex="-1"><a class="header-anchor" href="#epoll"><span>epoll</span></a></h5><h6 id="å‡½æ•°-1" tabindex="-1"><a class="header-anchor" href="#å‡½æ•°-1"><span>å‡½æ•°</span></a></h6><p>epoll ä½¿ç”¨äº‹ä»¶çš„å°±ç»ªé€šçŸ¥æ–¹å¼ï¼Œé€šè¿‡ epoll_ctl() å‘å†…æ ¸æ³¨å†Œæ–°çš„æè¿°ç¬¦æˆ–è€…æ˜¯æ”¹å˜æŸä¸ªæ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ã€‚å·²æ³¨å†Œçš„æè¿°ç¬¦åœ¨å†…æ ¸ä¸­ä¼šè¢«ç»´æŠ¤åœ¨ä¸€æ£µ<strong>çº¢é»‘æ ‘</strong>ä¸Šï¼Œä¸€æ—¦è¯¥ fd å°±ç»ªï¼Œ<strong>å†…æ ¸é€šè¿‡ callback å›è°ƒå‡½æ•°å°† I/O å‡†å¤‡å¥½çš„æè¿°ç¬¦åŠ å…¥åˆ°ä¸€ä¸ªé“¾è¡¨ä¸­</strong>ç®¡ç†ï¼Œè¿›ç¨‹è°ƒç”¨ epoll_wait() ä¾¿å¯ä»¥å¾—åˆ°äº‹ä»¶å°±ç»ªçš„æè¿°ç¬¦</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">epoll_create</span><span class="token punctuation">(</span><span class="token keyword">int</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">epoll_ctl</span><span class="token punctuation">(</span><span class="token keyword">int</span> epfd<span class="token punctuation">,</span> <span class="token keyword">int</span> op<span class="token punctuation">,</span> <span class="token keyword">int</span> fd<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">epoll_event</span> <span class="token operator">*</span>event<span class="token punctuation">)</span>ï¼›
<span class="token keyword">int</span> <span class="token function">epoll_wait</span><span class="token punctuation">(</span><span class="token keyword">int</span> epfd<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">epoll_event</span> <span class="token operator">*</span> events<span class="token punctuation">,</span> <span class="token keyword">int</span> maxevents<span class="token punctuation">,</span> <span class="token keyword">int</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>epall_createï¼šä¸€ä¸ªç³»ç»Ÿå‡½æ•°ï¼Œå‡½æ•°å°†åœ¨å†…æ ¸ç©ºé—´å†…åˆ›å»ºä¸€ä¸ª epoll æ•°æ®ç»“æ„ï¼Œå¯ä»¥ç†è§£ä¸º epoll ç»“æ„ç©ºé—´ï¼Œè¿”å›å€¼ä¸º epoll çš„æ–‡ä»¶æè¿°ç¬¦ç¼–å·ï¼Œä»¥åæœ‰ client è¿æ¥æ—¶ï¼Œå‘è¯¥ epoll ç»“æ„ä¸­æ·»åŠ ç›‘å¬ï¼Œæ‰€ä»¥ epoll ä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç®¡ç†å¤šä¸ªæè¿°ç¬¦</p></li><li><p>epall_ctlï¼šepoll çš„äº‹ä»¶æ³¨å†Œå‡½æ•°ï¼Œselect å‡½æ•°æ˜¯è°ƒç”¨æ—¶æŒ‡å®šéœ€è¦ç›‘å¬çš„æè¿°ç¬¦å’Œäº‹ä»¶ï¼Œepoll å…ˆå°†ç”¨æˆ·æ„Ÿå…´è¶£çš„æè¿°ç¬¦äº‹ä»¶æ³¨å†Œåˆ° epoll ç©ºé—´ã€‚æ­¤å‡½æ•°æ˜¯éé˜»å¡å‡½æ•°ï¼Œç”¨æ¥å¢åˆ æ”¹ epoll ç©ºé—´å†…çš„æè¿°ç¬¦ï¼Œå‚æ•°è§£é‡Šï¼š</p></li><li><p>epfdï¼šepoll ç»“æ„çš„è¿›ç¨‹ fd ç¼–å·ï¼Œå‡½æ•°å°†ä¾é è¯¥ç¼–å·æ‰¾åˆ°å¯¹åº”çš„ epoll ç»“æ„</p></li><li><p>opï¼šè¡¨ç¤ºå½“å‰è¯·æ±‚ç±»å‹ï¼Œæœ‰ä¸‰ä¸ªå®å®šä¹‰ï¼š</p></li><li><p>EPOLL_CTL_ADDï¼šæ³¨å†Œæ–°çš„ fd åˆ° epfd ä¸­</p></li><li><p>EPOLL_CTL_MODï¼šä¿®æ”¹å·²ç»æ³¨å†Œçš„ fd çš„ç›‘å¬äº‹ä»¶</p></li><li><p>EPOLL_CTI_DELï¼šä» epfd ä¸­åˆ é™¤ä¸€ä¸ª fd</p></li><li><p>fdï¼šéœ€è¦ç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¸€èˆ¬æŒ‡ socket_fd</p></li><li><p>eventï¼šå‘Šè¯‰å†…æ ¸å¯¹è¯¥ fd èµ„æºæ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Œepoll_event çš„ç»“æ„ï¼š</p></li></ul><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">epoll_event</span> <span class="token punctuation">{</span>
    _uint32_t events<span class="token punctuation">;</span>	<span class="token comment">/*epoll events*/</span>
    <span class="token class-name">epoll_data_t</span> data<span class="token punctuation">;</span>	<span class="token comment">/*user data variable*/</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>events å¯ä»¥æ˜¯ä»¥ä¸‹å‡ ä¸ªå®é›†åˆï¼šEPOLLINã€EPOLOUTã€EPOLLPRIã€EPOLLERRã€EPOLLHUPï¼ˆæŒ‚æ–­ï¼‰ã€EPOLETï¼ˆè¾¹ç¼˜è§¦å‘ï¼‰ã€EPOLLONESHOTï¼ˆåªç›‘å¬ä¸€æ¬¡ï¼Œäº‹ä»¶è§¦å‘åè‡ªåŠ¨æ¸…é™¤è¯¥ fdï¼Œä» epoll åˆ—è¡¨ï¼‰</p><ul><li><p>epoll_waitï¼šç­‰å¾…äº‹ä»¶çš„äº§ç”Ÿï¼Œç±»ä¼¼äº select() è°ƒç”¨ï¼Œè¿”å›å€¼ä¸ºæœ¬æ¬¡å°±ç»ªçš„ fd ä¸ªæ•°ï¼Œç›´æ¥ä»å°±ç»ªé“¾è¡¨è·å–ï¼Œæ—¶é—´å¤æ‚åº¦ O(1)</p></li><li><p>epfdï¼š<strong>æŒ‡å®šæ„Ÿå…´è¶£çš„ epoll äº‹ä»¶åˆ—è¡¨</strong></p></li><li><p>eventsï¼šæŒ‡å‘ä¸€ä¸ª epoll_event ç»“æ„æ•°ç»„ï¼Œå½“å‡½æ•°è¿”å›æ—¶ï¼Œå†…æ ¸ä¼šæŠŠå°±ç»ªçŠ¶æ€çš„æ•°æ®æ‹·è´åˆ°è¯¥æ•°ç»„</p></li><li><p>maxeventsï¼šæ ‡æ˜ epoll_event æ•°ç»„æœ€å¤šèƒ½æ¥æ”¶çš„æ•°æ®é‡ï¼Œå³æœ¬æ¬¡æ“ä½œæœ€å¤šèƒ½è·å–å¤šå°‘å°±ç»ªæ•°æ®</p></li><li><p>timeoutï¼šå•ä½ä¸ºæ¯«ç§’</p></li><li><p>0ï¼šè¡¨ç¤ºç«‹å³è¿”å›ï¼Œéé˜»å¡è°ƒç”¨</p></li><li><p>-1ï¼šé˜»å¡è°ƒç”¨ï¼Œç›´åˆ°æœ‰ç”¨æˆ·æ„Ÿå…´è¶£çš„äº‹ä»¶å°±ç»ªä¸ºæ­¢</p></li><li><p>å¤§äº 0ï¼šé˜»å¡è°ƒç”¨ï¼Œé˜»å¡æŒ‡å®šæ—¶é—´å†…å¦‚æœæœ‰äº‹ä»¶å°±ç»ªåˆ™æå‰è¿”å›ï¼Œå¦åˆ™ç­‰å¾…æŒ‡å®šæ—¶é—´åè¿”å›</p></li></ul><p>epoll çš„æè¿°ç¬¦äº‹ä»¶æœ‰ä¸¤ç§è§¦å‘æ¨¡å¼ï¼šLTï¼ˆlevel triggerï¼‰å’Œ ETï¼ˆedge triggerï¼‰ï¼š</p><ul><li>LT æ¨¡å¼ï¼šå½“ epoll_wait() æ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶åˆ°è¾¾æ—¶ï¼Œå°†æ­¤äº‹ä»¶é€šçŸ¥è¿›ç¨‹ï¼Œè¿›ç¨‹å¯ä»¥ä¸ç«‹å³å¤„ç†è¯¥äº‹ä»¶ï¼Œä¸‹æ¬¡è°ƒç”¨ epoll_wait() ä¼šå†æ¬¡é€šçŸ¥è¿›ç¨‹ï¼Œæ˜¯é»˜è®¤çš„ä¸€ç§æ¨¡å¼ï¼Œå¹¶ä¸”åŒæ—¶æ”¯æŒ Blocking å’Œ No-Blocking</li><li>ET æ¨¡å¼ï¼šé€šçŸ¥ä¹‹åè¿›ç¨‹å¿…é¡»ç«‹å³å¤„ç†äº‹ä»¶ï¼Œä¸‹æ¬¡å†è°ƒç”¨ epoll_wait() æ—¶ä¸ä¼šå†å¾—åˆ°äº‹ä»¶åˆ°è¾¾çš„é€šçŸ¥ã€‚å‡å°‘äº† epoll äº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆç‡è¦æ¯” LT æ¨¡å¼é«˜ï¼›åªæ”¯æŒ No-Blockingï¼Œä»¥é¿å…ç”±äºä¸€ä¸ª fd çš„é˜»å¡è¯»/é˜»å¡å†™æ“ä½œæŠŠå¤„ç†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ä»»åŠ¡é¥¥é¥¿</li></ul><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token comment">// åˆ›å»º epoll æè¿°ç¬¦ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºåªéœ€è¦ä¸€ä¸ªï¼Œç”¨äºç›‘æ§æ‰€æœ‰å¥—æ¥å­—</span>
<span class="token keyword">int</span> pollingfd <span class="token operator">=</span> <span class="token function">epoll_create</span><span class="token punctuation">(</span><span class="token number">0xCAFE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span> pollingfd <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token comment">// report error</span>
<span class="token comment">// åˆå§‹åŒ– epoll ç»“æ„</span>
<span class="token keyword">struct</span> <span class="token class-name">epoll_event</span> ev <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// å°†è¿æ¥ç±»å®ä¾‹ä¸äº‹ä»¶ç›¸å…³è”ï¼Œå¯ä»¥å…³è”ä»»ä½•æƒ³è¦çš„ä¸œè¥¿</span>
ev<span class="token punctuation">.</span>data<span class="token punctuation">.</span>ptr <span class="token operator">=</span> pConnection1<span class="token punctuation">;</span>

<span class="token comment">// ç›‘è§†è¾“å…¥ï¼Œå¹¶ä¸”åœ¨äº‹ä»¶å‘ç”Ÿåä¸è‡ªåŠ¨é‡æ–°å‡†å¤‡æè¿°ç¬¦</span>
ev<span class="token punctuation">.</span>events <span class="token operator">=</span> EPOLLIN <span class="token operator">|</span> EPOLLONESHOT<span class="token punctuation">;</span>
<span class="token comment">// å°†æè¿°ç¬¦æ·»åŠ åˆ°ç›‘æ§åˆ—è¡¨ä¸­ï¼Œå³ä½¿å¦ä¸€ä¸ªçº¿ç¨‹åœ¨epoll_waitä¸­ç­‰å¾…ï¼Œæè¿°ç¬¦å°†è¢«æ­£ç¡®æ·»åŠ </span>
<span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">epoll_ctl</span><span class="token punctuation">(</span> epollfd<span class="token punctuation">,</span> EPOLL_CTL_ADD<span class="token punctuation">,</span> pConnection1<span class="token operator">-&gt;</span><span class="token function">getSocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ev<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token comment">// report error</span>

<span class="token comment">// æœ€å¤šç­‰å¾… 20 ä¸ªäº‹ä»¶</span>
<span class="token keyword">struct</span> <span class="token class-name">epoll_event</span> pevents<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// ç­‰å¾…10ç§’ï¼Œæ£€ç´¢20ä¸ªå¹¶å­˜å…¥epoll_eventæ•°ç»„</span>
<span class="token keyword">int</span> ready <span class="token operator">=</span> <span class="token function">epoll_wait</span><span class="token punctuation">(</span>pollingfd<span class="token punctuation">,</span> pevents<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// æ£€æŸ¥epollæ˜¯å¦æˆåŠŸ</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span> ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">// report error and abort</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> ret <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">// timeout; no event detected</span>
<span class="token keyword">else</span>
<span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ready<span class="token punctuation">;</span> i<span class="token operator">+</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> pevents<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>events <span class="token operator">&amp;</span> EPOLLIN <span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// è·å–è¿æ¥æŒ‡é’ˆ</span>
            Connection <span class="token operator">*</span> c <span class="token operator">=</span> <span class="token punctuation">(</span>Connection<span class="token operator">*</span><span class="token punctuation">)</span> pevents<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>ptr<span class="token punctuation">;</span>
            c<span class="token operator">-&gt;</span><span class="token function">handleReadEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æµç¨‹å›¾ï¼šhttps://gitee.com/seazean/images/blob/master/Java/IO-epollåŸç†å›¾.jpg</p><p>å‚è€ƒè§†é¢‘ï¼šhttps://www.bilibili.com/video/BV19D4y1o797</p><h6 id="ç‰¹ç‚¹" tabindex="-1"><a class="header-anchor" href="#ç‰¹ç‚¹"><span>ç‰¹ç‚¹</span></a></h6><p>epoll çš„ç‰¹ç‚¹ï¼š</p><ul><li>epoll ä»…é€‚ç”¨äº Linux ç³»ç»Ÿ</li><li>epoll ä½¿ç”¨<strong>ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç®¡ç†å¤šä¸ªæè¿°ç¬¦</strong>ï¼Œå°†ç”¨æˆ·å…³å¿ƒçš„æ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å­˜æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨ï¼ˆä¸ªäººç†è§£æˆå“‘å…ƒèŠ‚ç‚¹ï¼‰</li><li>æ²¡æœ‰æœ€å¤§æè¿°ç¬¦æ•°é‡ï¼ˆå¹¶å‘è¿æ¥ï¼‰çš„é™åˆ¶ï¼Œæ‰“å¼€ fd çš„ä¸Šé™è¿œå¤§äº1024ï¼ˆ1G å†…å­˜èƒ½ç›‘å¬çº¦ 10 ä¸‡ä¸ªç«¯å£ï¼‰</li><li>epoll çš„æ—¶é—´å¤æ‚åº¦ O(1)ï¼Œepoll ç†è§£ä¸º event pollï¼Œä¸åŒäºå¿™è½®è¯¢å’Œæ— å·®åˆ«è½®è¯¢ï¼Œè°ƒç”¨ epoll_wait <strong>åªæ˜¯è½®è¯¢å°±ç»ªé“¾è¡¨</strong>ã€‚å½“ç›‘å¬åˆ—è¡¨æœ‰è®¾å¤‡å°±ç»ªæ—¶è°ƒç”¨å›è°ƒå‡½æ•°ï¼ŒæŠŠå°±ç»ª fd æ”¾å…¥å°±ç»ªé“¾è¡¨ä¸­ï¼Œå¹¶å”¤é†’åœ¨ epoll_wait ä¸­é˜»å¡çš„è¿›ç¨‹ï¼Œæ‰€ä»¥ epoll å®é™…ä¸Šæ˜¯<strong>äº‹ä»¶é©±åŠ¨</strong>ï¼ˆæ¯ä¸ªäº‹ä»¶å…³è”ä¸Šfdï¼‰çš„ï¼Œé™ä½äº† system call çš„æ—¶é—´å¤æ‚åº¦</li><li>epoll å†…æ ¸ä¸­æ ¹æ®æ¯ä¸ª fd ä¸Šçš„ callback å‡½æ•°æ¥å®ç°ï¼Œåªæœ‰æ´»è·ƒçš„ socket æ‰ä¼šä¸»åŠ¨è°ƒç”¨ callbackï¼Œæ‰€ä»¥ä½¿ç”¨ epoll æ²¡æœ‰å‰é¢ä¸¤è€…çš„çº¿æ€§ä¸‹é™çš„æ€§èƒ½é—®é¢˜ï¼Œæ•ˆç‡æé«˜</li><li>epoll æ³¨å†Œæ–°çš„äº‹ä»¶æ˜¯æ³¨å†Œåˆ°åˆ°å†…æ ¸ä¸­ epoll å¥æŸ„ä¸­ï¼Œä¸éœ€è¦æ¯æ¬¡è°ƒç”¨ epoll_wait æ—¶é‡å¤æ‹·è´ï¼Œå¯¹æ¯”å‰é¢ä¸¤ç§åªéœ€è¦å°†æè¿°ç¬¦ä»è¿›ç¨‹ç¼“å†²åŒºå‘å†…æ ¸ç¼“å†²åŒº<strong>æ‹·è´ä¸€æ¬¡</strong>ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ <strong>mmap() æ–‡ä»¶æ˜ å°„å†…å­˜</strong>åŠ é€Ÿä¸å†…æ ¸ç©ºé—´çš„æ¶ˆæ¯ä¼ é€’ï¼ˆåªæ˜¯å¯ä»¥ç”¨ï¼Œå¹¶æ²¡æœ‰ç”¨ï¼‰</li><li>å‰é¢ä¸¤è€…è¦æŠŠ current å¾€è®¾å¤‡ç­‰å¾…é˜Ÿåˆ—ä¸­æŒ‚ä¸€æ¬¡ï¼Œepoll ä¹ŸåªæŠŠ current å¾€ç­‰å¾…é˜Ÿåˆ—ä¸ŠæŒ‚ä¸€æ¬¡ï¼Œä½†æ˜¯è¿™é‡Œçš„ç­‰å¾…é˜Ÿåˆ—å¹¶ä¸æ˜¯è®¾å¤‡ç­‰å¾…é˜Ÿåˆ—ï¼Œåªæ˜¯ä¸€ä¸ª epoll å†…éƒ¨å®šä¹‰çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœå¼€é”€</li><li>epoll å¯¹å¤šçº¿ç¨‹ç¼–ç¨‹æ›´æœ‰å‹å¥½ï¼Œä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº† epoll_wait() å¦ä¸€ä¸ªçº¿ç¨‹å…³é—­äº†åŒä¸€ä¸ªæè¿°ç¬¦ï¼Œä¹Ÿä¸ä¼šäº§ç”Ÿåƒ select å’Œ poll çš„ä¸ç¡®å®šæƒ…å†µ</li></ul><p>å‚è€ƒæ–‡ç« ï¼šhttps://www.jianshu.com/p/dfd940e7fca2</p><p>å‚è€ƒæ–‡ç« ï¼šhttps://www.cnblogs.com/anker/p/3265058.html</p><h5 id="åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨"><span>åº”ç”¨</span></a></h5><p>åº”ç”¨åœºæ™¯ï¼š</p><ul><li><p>select åº”ç”¨åœºæ™¯ï¼š</p></li><li><p>select çš„ timeout å‚æ•°ç²¾åº¦ä¸ºå¾®ç§’ï¼Œpoll å’Œ epoll ä¸ºæ¯«ç§’ï¼Œå› æ­¤ select é€‚ç”¨<strong>å®æ—¶æ€§è¦æ±‚æ¯”è¾ƒé«˜</strong>çš„åœºæ™¯ï¼Œæ¯”å¦‚æ ¸ååº”å †çš„æ§åˆ¶</p></li><li><p>select å¯ç§»æ¤æ€§æ›´å¥½ï¼Œå‡ ä¹è¢«æ‰€æœ‰ä¸»æµå¹³å°æ‰€æ”¯æŒ</p></li><li><p>poll åº”ç”¨åœºæ™¯ï¼špoll æ²¡æœ‰æœ€å¤§æè¿°ç¬¦æ•°é‡çš„é™åˆ¶ï¼Œé€‚ç”¨äºå¹³å°æ”¯æŒå¹¶ä¸”å¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜çš„æƒ…å†µ</p></li><li><p>epoll åº”ç”¨åœºæ™¯ï¼š</p></li><li><p>è¿è¡Œåœ¨ Linux å¹³å°ä¸Šï¼Œæœ‰å¤§é‡çš„æè¿°ç¬¦éœ€è¦åŒæ—¶è½®è¯¢ï¼Œå¹¶ä¸”è¿™äº›è¿æ¥æœ€å¥½æ˜¯<strong>é•¿è¿æ¥</strong></p></li><li><p>éœ€è¦åŒæ—¶ç›‘æ§å°äº 1000 ä¸ªæè¿°ç¬¦ï¼Œæ²¡å¿…è¦ä½¿ç”¨ epollï¼Œå› ä¸ºè¿™ä¸ªåº”ç”¨åœºæ™¯ä¸‹å¹¶ä¸èƒ½ä½“ç° epoll çš„ä¼˜åŠ¿</p></li><li><p>éœ€è¦ç›‘æ§çš„æè¿°ç¬¦çŠ¶æ€å˜åŒ–å¤šï¼Œè€Œä¸”æ˜¯éå¸¸çŸ­æš‚çš„ï¼Œå°±æ²¡æœ‰å¿…è¦ä½¿ç”¨ epollã€‚å› ä¸º epoll ä¸­çš„æ‰€æœ‰æè¿°ç¬¦éƒ½å­˜å‚¨åœ¨å†…æ ¸ä¸­ï¼Œæ¯æ¬¡å¯¹æè¿°ç¬¦çš„çŠ¶æ€æ”¹å˜éƒ½éœ€è¦é€šè¿‡ epoll_ctl() è¿›è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œé¢‘ç¹ç³»ç»Ÿè°ƒç”¨é™ä½æ•ˆç‡ï¼Œå¹¶ä¸” epoll çš„æè¿°ç¬¦å­˜å‚¨åœ¨å†…æ ¸ï¼Œä¸å®¹æ˜“è°ƒè¯•</p></li></ul><p>å‚è€ƒæ–‡ç« ï¼šhttps://github.com/CyC2018/CS-Notes/blob/master/notes/Socket.md</p><h4 id="ç³»ç»Ÿè°ƒç”¨" tabindex="-1"><a class="header-anchor" href="#ç³»ç»Ÿè°ƒç”¨"><span>ç³»ç»Ÿè°ƒç”¨</span></a></h4><h5 id="å†…æ ¸æ€" tabindex="-1"><a class="header-anchor" href="#å†…æ ¸æ€"><span>å†…æ ¸æ€</span></a></h5><p>ç”¨æˆ·ç©ºé—´ï¼šç”¨æˆ·ä»£ç ã€ç”¨æˆ·å †æ ˆ</p><p>å†…æ ¸ç©ºé—´ï¼šå†…æ ¸ä»£ç ã€å†…æ ¸è°ƒåº¦ç¨‹åºã€è¿›ç¨‹æè¿°ç¬¦ï¼ˆå†…æ ¸å †æ ˆã€thread_info è¿›ç¨‹æè¿°ç¬¦ï¼‰</p><ul><li>è¿›ç¨‹æè¿°ç¬¦å’Œç”¨æˆ·çš„è¿›ç¨‹æ˜¯ä¸€ä¸€å¯¹åº”çš„</li><li>SYS_API ç³»ç»Ÿè°ƒç”¨ï¼šå¦‚ readã€writeï¼Œç³»ç»Ÿè°ƒç”¨å°±æ˜¯ 0X80 ä¸­æ–­</li><li>è¿›ç¨‹æè¿°ç¬¦ pdï¼šè¿›ç¨‹ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€æ—¶ï¼Œéœ€è¦<strong>ä¿å­˜ç”¨æˆ·æ€æ—¶çš„ä¸Šä¸‹æ–‡ä¿¡æ¯åœ¨ PCB ä¸­</strong></li><li>çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼šç”¨æˆ·ç¨‹åºåŸºåœ°å€ï¼Œç¨‹åºè®¡æ•°å™¨ã€cpu cacheã€å¯„å­˜å™¨ç­‰ï¼Œæ–¹ä¾¿ç¨‹åºåˆ‡å›ç”¨æˆ·æ€æ—¶æ¢å¤ç°åœº</li><li>å†…æ ¸å †æ ˆï¼š**ç³»ç»Ÿè°ƒç”¨å‡½æ•°ä¹Ÿæ˜¯è¦åˆ›å»ºå˜é‡çš„ï¼Œ**è¿™äº›å˜é‡åœ¨å†…æ ¸å †æ ˆä¸Šåˆ†é…</li></ul><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877313205-32e3033c-19b7-4b3f-b587-8e38b5e18b8e.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h5 id="_80ä¸­æ–­" tabindex="-1"><a class="header-anchor" href="#_80ä¸­æ–­"><span>80ä¸­æ–­</span></a></h5><p>åœ¨ç”¨æˆ·ç¨‹åºä¸­è°ƒç”¨æ“ä½œç³»ç»Ÿæä¾›çš„æ ¸å¿ƒæ€çº§åˆ«çš„å­åŠŸèƒ½ï¼Œä¸ºäº†ç³»ç»Ÿå®‰å…¨éœ€è¦è¿›è¡Œç”¨æˆ·æ€å’Œå†…æ ¸æ€è½¬æ¢ï¼ŒçŠ¶æ€çš„è½¬æ¢éœ€è¦è¿›è¡Œ CPU ä¸­æ–­ï¼Œä¸­æ–­åˆ†ä¸ºç¡¬ä¸­æ–­å’Œè½¯ä¸­æ–­ï¼š</p><ul><li><p>ç¡¬ä¸­æ–­ï¼šå¦‚ç½‘ç»œä¼ è¾“ä¸­ï¼Œæ•°æ®åˆ°è¾¾ç½‘å¡åï¼Œç½‘å¡ç»è¿‡ä¸€ç³»åˆ—æ“ä½œåå‘èµ·ç¡¬ä»¶ä¸­æ–­</p></li><li><p>è½¯ä¸­æ–­ï¼šå¦‚ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æœ¬èº«äº§ç”Ÿçš„ä¸€äº›ä¸­æ–­</p></li><li><p>å‘èµ· <code>0X80</code> ä¸­æ–­</p></li><li><p>ç¨‹åºæ‰§è¡Œç¢°åˆ°é™¤ 0 å¼‚å¸¸</p></li></ul><p>ç³»ç»Ÿè°ƒç”¨ system_call å‡½æ•°æ‰€å¯¹åº”çš„ä¸­æ–­æŒ‡ä»¤ç¼–å·æ˜¯ 0X80ï¼ˆåè¿›åˆ¶æ˜¯ 8Ã—16=128ï¼‰ï¼Œè€Œè¯¥æŒ‡ä»¤ç¼–å·å¯¹åº”çš„å°±æ˜¯ç³»ç»Ÿè°ƒç”¨ç¨‹åºçš„å…¥å£ï¼Œæ‰€ä»¥ç§°ç³»ç»Ÿè°ƒç”¨ä¸º 80 ä¸­æ–­</p><p>ç³»ç»Ÿè°ƒç”¨çš„æµç¨‹ï¼š</p><ul><li>åœ¨ CPU å¯„å­˜å™¨é‡Œå­˜ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å·ï¼Œè¡¨ç¤ºå“ªä¸ªç³»ç»Ÿå‡½æ•°ï¼Œæ¯”å¦‚ read</li><li>å°† CPU çš„ä¸´æ—¶æ•°æ®éƒ½ä¿å­˜åˆ° thread_info ä¸­</li><li>æ‰§è¡Œ 80 ä¸­æ–­å¤„ç†ç¨‹åºï¼Œæ‰¾åˆ°åˆšåˆšå­˜çš„ç³»ç»Ÿè°ƒç”¨å·ï¼ˆreadï¼‰ï¼Œå…ˆæ£€æŸ¥ç¼“å­˜ä¸­æœ‰æ²¡æœ‰å¯¹åº”çš„æ•°æ®ï¼Œæ²¡æœ‰å°±å»ç£ç›˜ä¸­åŠ è½½åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œç„¶åä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°ç”¨æˆ·ç©ºé—´</li><li>æœ€åæ¢å¤åˆ°ç”¨æˆ·æ€ï¼Œé€šè¿‡ thread_info æ¢å¤ç°åœºï¼Œç”¨æˆ·æ€ç»§ç»­æ‰§è¡Œ</li></ul><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877313311-9dc1ae3e-05a3-4031-9f9e-fc9cbf343d0a.jpeg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å‚è€ƒè§†é¢‘ï¼šhttps://www.bilibili.com/video/BV19D4y1o797</p><h4 id="é›¶æ‹·è´" tabindex="-1"><a class="header-anchor" href="#é›¶æ‹·è´"><span>é›¶æ‹·è´</span></a></h4><h5 id="dma" tabindex="-1"><a class="header-anchor" href="#dma"><span>DMA</span></a></h5><p>DMA (Direct Memory Access) ï¼šç›´æ¥å­˜å‚¨å™¨è®¿é—®ï¼Œè®©å¤–éƒ¨è®¾å¤‡ä¸é€šè¿‡ CPU ç›´æ¥ä¸ç³»ç»Ÿå†…å­˜äº¤æ¢æ•°æ®çš„æ¥å£æŠ€æœ¯</p><p>ä½œç”¨ï¼šå¯ä»¥è§£å†³æ‰¹é‡æ•°æ®çš„è¾“å…¥/è¾“å‡ºé—®é¢˜ï¼Œä½¿æ•°æ®çš„ä¼ é€é€Ÿåº¦å–å†³äºå­˜å‚¨å™¨å’Œå¤–è®¾çš„å·¥ä½œé€Ÿåº¦</p><p>æŠŠå†…å­˜æ•°æ®ä¼ è¾“åˆ°ç½‘å¡ç„¶åå‘é€ï¼š</p><ul><li>æ²¡æœ‰ DMAï¼šCPU è¯»å†…å­˜æ•°æ®åˆ° CPU é«˜é€Ÿç¼“å­˜ï¼Œå†å†™åˆ°ç½‘å¡ï¼Œè¿™æ ·å°±æŠŠ CPU çš„é€Ÿåº¦æ‹‰ä½åˆ°å’Œç½‘å¡ä¸€ä¸ªé€Ÿåº¦</li><li>ä½¿ç”¨ DMAï¼šæŠŠæ•°æ®è¯»åˆ° Socket å†…æ ¸ç¼“å­˜åŒºï¼ˆCPU å¤åˆ¶ï¼‰ï¼ŒCPU åˆ†é…ç»™ DMA å¼€å§‹<strong>å¼‚æ­¥</strong>æ“ä½œï¼ŒDMA è¯»å– Socket ç¼“å†²åŒºåˆ° DMA ç¼“å†²åŒºï¼Œç„¶åå†™åˆ°ç½‘å¡ã€‚DMA æ‰§è¡Œå®Œå<strong>ä¸­æ–­</strong>ï¼ˆå°±æ˜¯é€šçŸ¥ï¼‰ CPUï¼Œè¿™æ—¶ Socket å†…æ ¸ç¼“å†²åŒºä¸ºç©ºï¼ŒCPU ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œæ‰§è¡Œä¸­æ–­å¤„ç†ç¨‹åºï¼Œå°†éœ€è¦ä½¿ç”¨ Socket ç¼“å†²åŒºçš„é˜»å¡è¿›ç¨‹ç§»åˆ°å°±ç»ªé˜Ÿåˆ—</li></ul><p>ä¸€ä¸ªå®Œæ•´çš„ DMA ä¼ è¾“è¿‡ç¨‹å¿…é¡»ç»å† DMA è¯·æ±‚ã€DMA å“åº”ã€DMA ä¼ è¾“ã€DMA ç»“æŸå››ä¸ªæ­¥éª¤ï¼š</p><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877313262-36ec3c50-ac46-46aa-88b6-a9c11011ff6e.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>DMA æ–¹å¼æ˜¯ä¸€ç§å®Œå…¨ç”±ç¡¬ä»¶è¿›è¡Œä¿¡æ¯ä¼ é€çš„æ§åˆ¶æ–¹å¼ï¼Œé€šå¸¸ç³»ç»Ÿæ€»çº¿ç”± CPU ç®¡ç†ï¼Œåœ¨ DMA æ–¹å¼ä¸­ï¼ŒCPU çš„ä¸»å­˜æ§åˆ¶ä¿¡å·è¢«ç¦æ­¢ä½¿ç”¨ï¼ŒCPU æŠŠæ€»çº¿ï¼ˆåœ°å€æ€»çº¿ã€æ•°æ®æ€»çº¿ã€æ§åˆ¶æ€»çº¿ï¼‰è®©å‡ºæ¥ç”± DMA æ§åˆ¶å™¨æ¥ç®¡ï¼Œç”¨æ¥æ§åˆ¶ä¼ é€çš„å­—èŠ‚æ•°ã€åˆ¤æ–­ DMA æ˜¯å¦ç»“æŸã€ä»¥åŠå‘å‡º DMA ç»“æŸä¿¡å·ï¼Œæ‰€ä»¥ DMA æ§åˆ¶å™¨å¿…é¡»æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ul><li>æ¥å—å¤–è®¾å‘å‡ºçš„ DMA è¯·æ±‚ï¼Œå¹¶å‘ CPU å‘å‡ºæ€»çº¿æ¥ç®¡è¯·æ±‚</li><li>å½“ CPU å‘å‡ºå…è®¸æ¥ç®¡ä¿¡å·åï¼Œè¿›å…¥ DMA æ“ä½œå‘¨æœŸ</li><li>ç¡®å®šä¼ é€æ•°æ®çš„ä¸»å­˜å•å…ƒåœ°å€åŠé•¿åº¦ï¼Œå¹¶è‡ªåŠ¨ä¿®æ”¹ä¸»å­˜åœ°å€è®¡æ•°å’Œä¼ é€é•¿åº¦è®¡æ•°</li><li>è§„å®šæ•°æ®åœ¨ä¸»å­˜å’Œå¤–è®¾é—´çš„ä¼ é€æ–¹å‘ï¼Œå‘å‡ºè¯»å†™ç­‰æ§åˆ¶ä¿¡å·ï¼Œæ‰§è¡Œæ•°æ®ä¼ é€æ“ä½œ</li><li>åˆ¤æ–­ DMA ä¼ é€æ˜¯å¦ç»“æŸï¼Œå‘å‡º DMA ç»“æŸä¿¡å·ï¼Œä½¿ CPU æ¢å¤æ­£å¸¸å·¥ä½œçŠ¶æ€ï¼ˆä¸­æ–­ï¼‰</li></ul><h5 id="bio" tabindex="-1"><a class="header-anchor" href="#bio"><span>BIO</span></a></h5><p>ä¼ ç»Ÿçš„ I/O æ“ä½œè¿›è¡Œäº† 4 æ¬¡ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»¥åŠ 4 æ¬¡æ•°æ®æ‹·è´ï¼š</p><ul><li>JVM å‘å‡º read ç³»ç»Ÿè°ƒç”¨ï¼ŒOS ä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°å†…æ ¸æ¨¡å¼ï¼ˆåˆ‡æ¢ 1ï¼‰å¹¶å°†æ•°æ®ä»ç½‘å¡æˆ–ç¡¬ç›˜ç­‰è®¾å¤‡é€šè¿‡ DMA è¯»å–åˆ°å†…æ ¸ç©ºé—´ç¼“å†²åŒºï¼ˆæ‹·è´ 1ï¼‰ï¼Œå†…æ ¸ç¼“å†²åŒºå®é™…ä¸Šæ˜¯<strong>ç£ç›˜é«˜é€Ÿç¼“å­˜ï¼ˆPageCacheï¼‰</strong></li><li>OS å†…æ ¸å°†æ•°æ®å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºï¼ˆæ‹·è´ 2ï¼‰ï¼Œç„¶å read ç³»ç»Ÿè°ƒç”¨è¿”å›ï¼Œåˆä¼šå¯¼è‡´ä¸€æ¬¡å†…æ ¸ç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆåˆ‡æ¢ 2ï¼‰</li><li>JVM å¤„ç†ä»£ç é€»è¾‘å¹¶å‘é€ write() ç³»ç»Ÿè°ƒç”¨ï¼ŒOS ä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°å†…æ ¸æ¨¡å¼ï¼ˆåˆ‡æ¢3ï¼‰å¹¶ä»ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºå¤åˆ¶æ•°æ®åˆ°å†…æ ¸ç©ºé—´ç¼“å†²åŒºï¼ˆæ‹·è´3ï¼‰</li><li>å°†å†…æ ¸ç©ºé—´ç¼“å†²åŒºä¸­çš„æ•°æ®å†™åˆ° hardwareï¼ˆæ‹·è´4ï¼‰ï¼Œwrite ç³»ç»Ÿè°ƒç”¨è¿”å›ï¼Œå¯¼è‡´å†…æ ¸ç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´çš„å†æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆåˆ‡æ¢4ï¼‰</li></ul><p>æµç¨‹å›¾ä¸­çš„ç®­å¤´åè¿‡æ¥ä¹Ÿæˆç«‹ï¼Œå¯ä»¥ä»ç½‘å¡è·å–æ•°æ®</p><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877313288-4ea522b3-28ca-4f31-9178-688ff53e31cd.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>read è°ƒç”¨å›¾ç¤ºï¼šreadã€write éƒ½æ˜¯ç³»ç»Ÿè°ƒç”¨æŒ‡ä»¤</p><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877313668-a0f3b00f-5e64-46bc-8d07-e621dcf5cdf7.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h5 id="mmap" tabindex="-1"><a class="header-anchor" href="#mmap"><span>mmap</span></a></h5><p>mmapï¼ˆMemory Mapped Filesï¼‰å†…å­˜æ˜ å°„åŠ  write å®ç°é›¶æ‹·è´ï¼Œ<strong>é›¶æ‹·è´å°±æ˜¯æ²¡æœ‰æ•°æ®ä»å†…æ ¸ç©ºé—´å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´</strong></p><p>ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´éƒ½ä½¿ç”¨å†…å­˜ï¼Œæ‰€ä»¥å¯ä»¥å…±äº«åŒä¸€å—ç‰©ç†å†…å­˜åœ°å€ï¼Œçœå»ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„æ‹·è´ã€‚å†™ç½‘å¡æ—¶ï¼Œå…±äº«ç©ºé—´çš„å†…å®¹æ‹·è´åˆ° Socket ç¼“å†²åŒºï¼Œç„¶åäº¤ç»™ DMA å‘é€åˆ°ç½‘å¡ï¼Œåªéœ€è¦ 3 æ¬¡å¤åˆ¶</p><p>è¿›è¡Œäº† 4 æ¬¡ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»¥åŠ 3 æ¬¡æ•°æ®æ‹·è´ï¼ˆ2 æ¬¡ DMAï¼Œä¸€æ¬¡ CPU å¤åˆ¶ï¼‰ï¼š</p><ul><li>å‘å‡º mmap ç³»ç»Ÿè°ƒç”¨ï¼ŒDMA æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œæ˜ å°„åˆ°å…±äº«ç¼“å†²åŒºï¼›mmap ç³»ç»Ÿè°ƒç”¨è¿”å›ï¼Œæ— éœ€æ‹·è´</li><li>å‘å‡º write ç³»ç»Ÿè°ƒç”¨ï¼Œå°†æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°å†…æ ¸ Socket ç¼“å†²åŒºï¼›write ç³»ç»Ÿè°ƒç”¨è¿”å›ï¼ŒDMA å°†å†…æ ¸ç©ºé—´ Socket ç¼“å†²åŒºä¸­çš„æ•°æ®ä¼ é€’åˆ°åè®®å¼•æ“</li></ul><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877313704-13affa58-a5d3-410c-acd1-8821d3c5c2f0.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>åŸç†ï¼šåˆ©ç”¨æ“ä½œç³»ç»Ÿçš„ Page æ¥å®ç°æ–‡ä»¶åˆ°ç‰©ç†å†…å­˜çš„ç›´æ¥æ˜ å°„ï¼Œå®Œæˆæ˜ å°„åå¯¹ç‰©ç†å†…å­˜çš„æ“ä½œä¼š<strong>è¢«åŒæ­¥</strong>åˆ°ç¡¬ç›˜ä¸Š</p><p>ç¼ºç‚¹ï¼šä¸å¯é ï¼Œå†™åˆ° mmap ä¸­çš„æ•°æ®å¹¶æ²¡æœ‰è¢«çœŸæ­£çš„å†™åˆ°ç¡¬ç›˜ï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨ç¨‹åºä¸»åŠ¨è°ƒç”¨ flush çš„æ—¶å€™æ‰æŠŠæ•°æ®çœŸæ­£çš„å†™åˆ°ç¡¬ç›˜</p><p>Java NIO æä¾›äº† <strong>MappedByteBuffer</strong> ç±»å¯ä»¥ç”¨æ¥å®ç° mmap å†…å­˜æ˜ å°„ï¼ŒMappedByteBuffer ç±»å¯¹è±¡<strong>åªèƒ½é€šè¿‡è°ƒç”¨</strong> <code>**FileChannel.map()**</code> <strong>è·å–</strong></p><h5 id="sendfile" tabindex="-1"><a class="header-anchor" href="#sendfile"><span>sendfile</span></a></h5><p>sendfile å®ç°é›¶æ‹·è´ï¼Œæ‰“å¼€æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ fd å’Œ socket çš„ fd ä¼ é€’ç»™ sendfileï¼Œç„¶åç»è¿‡ 3 æ¬¡å¤åˆ¶å’Œ 2 æ¬¡ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢</p><p>åŸç†ï¼šæ•°æ®æ ¹æœ¬ä¸ç»è¿‡ç”¨æˆ·æ€ï¼Œç›´æ¥ä»å†…æ ¸ç¼“å†²åŒºè¿›å…¥åˆ° Socket Bufferï¼Œç”±äºå’Œç”¨æˆ·æ€å®Œå…¨æ— å…³ï¼Œå°±å‡å°‘äº†ä¸¤æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢</p><p>è¯´æ˜ï¼šé›¶æ‹·è´æŠ€æœ¯æ˜¯ä¸å…è®¸è¿›ç¨‹å¯¹æ–‡ä»¶å†…å®¹ä½œè¿›ä¸€æ­¥çš„åŠ å·¥çš„ï¼Œæ¯”å¦‚å‹ç¼©æ•°æ®å†å‘é€</p><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877313805-13973f70-dee0-4c43-9139-a7c14555d1d9.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>sendfile2.4 ä¹‹åï¼Œsendfile å®ç°äº†æ›´ç®€å•çš„æ–¹å¼ï¼Œæ–‡ä»¶åˆ°è¾¾å†…æ ¸ç¼“å†²åŒºåï¼Œä¸å¿…å†å°†æ•°æ®å…¨éƒ¨å¤åˆ¶åˆ° socket buffer ç¼“å†²åŒºï¼Œè€Œæ˜¯åª<strong>å°†è®°å½•æ•°æ®ä½ç½®å’Œé•¿åº¦ç›¸å…³ç­‰æè¿°ç¬¦ä¿¡æ¯</strong>ä¿å­˜åˆ° socket bufferï¼ŒDMA æ ¹æ® Socket ç¼“å†²åŒºä¸­æè¿°ç¬¦æä¾›çš„ä½ç½®å’Œåç§»é‡ä¿¡æ¯ç›´æ¥å°†å†…æ ¸ç©ºé—´ç¼“å†²åŒºä¸­çš„æ•°æ®æ‹·è´åˆ°åè®®å¼•æ“ä¸Šï¼ˆ2 æ¬¡å¤åˆ¶ 2 æ¬¡åˆ‡æ¢ï¼‰</p><p>Java NIO å¯¹ sendfile çš„æ”¯æŒæ˜¯ <code>FileChannel.transferTo()/transferFrom()</code>ï¼ŒæŠŠç£ç›˜æ–‡ä»¶è¯»å– OS å†…æ ¸ç¼“å†²åŒºåçš„ fileChannelï¼Œç›´æ¥è½¬ç»™ socketChannel å‘é€ï¼Œåº•å±‚å°±æ˜¯ sendfile</p><p>å‚è€ƒæ–‡ç« ï¼šhttps://blog.csdn.net/hancoder/article/details/112149121</p><h3 id="bio-1" tabindex="-1"><a class="header-anchor" href="#bio-1"><span>BIO</span></a></h3><h4 id="inet" tabindex="-1"><a class="header-anchor" href="#inet"><span>Inet</span></a></h4><p>ä¸€ä¸ª InetAddress ç±»çš„å¯¹è±¡å°±ä»£è¡¨ä¸€ä¸ª IP åœ°å€å¯¹è±¡</p><p>æˆå‘˜æ–¹æ³•ï¼š</p><ul><li><code>static InetAddress getLocalHost()</code>ï¼šè·å¾—æœ¬åœ°ä¸»æœº IP åœ°å€å¯¹è±¡</li><li><code>static InetAddress getByName(String host)</code>ï¼šæ ¹æ® IP åœ°å€å­—ç¬¦ä¸²æˆ–ä¸»æœºåè·å¾—å¯¹åº”çš„ IP åœ°å€å¯¹è±¡</li><li><code>String getHostName()</code>ï¼šè·å–ä¸»æœºå</li><li><code>String getHostAddress()</code>ï¼šè·å¾— IP åœ°å€å­—ç¬¦ä¸²</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InetAddressDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.è·å–æœ¬æœºåœ°å€å¯¹è±¡</span>
        <span class="token class-name">InetAddress</span> ip <span class="token operator">=</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getLocalHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ip<span class="token punctuation">.</span><span class="token function">getHostName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//DESKTOP-NNMBHQR</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ip<span class="token punctuation">.</span><span class="token function">getHostAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//192.168.11.1</span>
        <span class="token comment">// 2.è·å–åŸŸåipå¯¹è±¡</span>
        <span class="token class-name">InetAddress</span> ip2 <span class="token operator">=</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span><span class="token string">&quot;www.baidu.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ip2<span class="token punctuation">.</span><span class="token function">getHostName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//www.baidu.com</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ip2<span class="token punctuation">.</span><span class="token function">getHostAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//14.215.177.38</span>
        <span class="token comment">// 3.è·å–å…¬ç½‘IPå¯¹è±¡ã€‚</span>
        <span class="token class-name">InetAddress</span> ip3 <span class="token operator">=</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span><span class="token string">&quot;182.61.200.6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ip3<span class="token punctuation">.</span><span class="token function">getHostName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//182.61.200.6</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ip3<span class="token punctuation">.</span><span class="token function">getHostAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//182.61.200.6</span>
        
        <span class="token comment">// 4.åˆ¤æ–­æ˜¯å¦èƒ½é€šï¼š ping  5sä¹‹å‰æµ‹è¯•æ˜¯å¦å¯é€š</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ip2<span class="token punctuation">.</span><span class="token function">isReachable</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// pingç™¾åº¦</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="udp" tabindex="-1"><a class="header-anchor" href="#udp"><span>UDP</span></a></h4><h5 id="åŸºæœ¬ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»"><span>åŸºæœ¬ä»‹ç»</span></a></h5><p>UDPï¼ˆUser Datagram Protocolï¼‰åè®®çš„ç‰¹ç‚¹ï¼š</p><ul><li>é¢å‘æ— è¿æ¥çš„åè®®ï¼Œå‘é€ç«¯åªç®¡å‘é€ï¼Œä¸ç¡®è®¤å¯¹æ–¹æ˜¯å¦èƒ½æ”¶åˆ°ï¼Œé€Ÿåº¦å¿«ï¼Œä½†æ˜¯ä¸å¯é ï¼Œä¼šä¸¢å¤±æ•°æ®</li><li>å°½æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼Œæ²¡æœ‰æ‹¥å¡æ§åˆ¶</li><li>åŸºäºæ•°æ®åŒ…è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œå‘é€æ•°æ®çš„åŒ…çš„å¤§å°é™åˆ¶ <strong>64KB</strong> ä»¥å†…</li><li>æ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€ã€å¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡</li></ul><p>UDP åè®®çš„ä½¿ç”¨åœºæ™¯ï¼šåœ¨çº¿è§†é¢‘ã€ç½‘ç»œè¯­éŸ³ã€ç”µè¯</p><h5 id="å®ç°udp" tabindex="-1"><a class="header-anchor" href="#å®ç°udp"><span>å®ç°UDP</span></a></h5><p>UDP åè®®ç›¸å…³çš„ä¸¤ä¸ªç±»ï¼š</p><ul><li>DatagramPacketï¼ˆæ•°æ®åŒ…å¯¹è±¡ï¼‰ï¼šç”¨æ¥å°è£…è¦å‘é€æˆ–è¦æ¥æ”¶çš„æ•°æ®ï¼Œæ¯”å¦‚ï¼šé›†è£…ç®±</li><li>DatagramSocketï¼ˆå‘é€å¯¹è±¡ï¼‰ï¼šç”¨æ¥å‘é€æˆ–æ¥æ”¶æ•°æ®åŒ…ï¼Œæ¯”å¦‚ï¼šç å¤´</li></ul><p><strong>DatagramPacket</strong>ï¼š</p><ul><li><p>DatagramPacket ç±»ï¼š <code>public new DatagramPacket(byte[] buf, int length, InetAddress address, int port)</code>ï¼šåˆ›å»ºå‘é€ç«¯æ•°æ®åŒ…å¯¹è±¡</p></li><li><p>bufï¼šè¦å‘é€çš„å†…å®¹ï¼Œå­—èŠ‚æ•°ç»„</p></li><li><p>lengthï¼šè¦å‘é€å†…å®¹çš„é•¿åº¦ï¼Œå•ä½æ˜¯å­—èŠ‚</p></li><li><p>addressï¼šæ¥æ”¶ç«¯çš„IPåœ°å€å¯¹è±¡</p></li><li><p>portï¼šæ¥æ”¶ç«¯çš„ç«¯å£å·</p></li></ul><p><code>public new DatagramPacket(byte[] buf, int length)</code>ï¼šåˆ›å»ºæ¥æ”¶ç«¯çš„æ•°æ®åŒ…å¯¹è±¡</p><ul><li><p>bufï¼šç”¨æ¥å­˜å‚¨æ¥æ”¶åˆ°å†…å®¹</p></li><li><p>lengthï¼šèƒ½å¤Ÿæ¥æ”¶å†…å®¹çš„é•¿åº¦</p></li><li><p>DatagramPacket ç±»å¸¸ç”¨æ–¹æ³•ï¼š</p></li><li><p><code>public int getLength()</code>ï¼šè·å¾—å®é™…æ¥æ”¶åˆ°çš„å­—èŠ‚ä¸ªæ•°</p></li><li><p><code>public byte[] getData()</code>ï¼šè¿”å›æ•°æ®ç¼“å†²åŒº</p></li></ul><p><strong>DatagramSocket</strong>ï¼š</p><ul><li><p>DatagramSocket ç±»æ„é€ æ–¹æ³•ï¼š</p></li><li><p><code>protected DatagramSocket()</code>ï¼šåˆ›å»ºå‘é€ç«¯çš„ Socket å¯¹è±¡ï¼Œç³»ç»Ÿä¼šéšæœºåˆ†é…ä¸€ä¸ªç«¯å£å·</p></li><li><p><code>protected DatagramSocket(int port)</code>ï¼šåˆ›å»ºæ¥æ”¶ç«¯çš„ Socket å¯¹è±¡å¹¶æŒ‡å®šç«¯å£å·</p></li><li><p>DatagramSocket ç±»æˆå‘˜æ–¹æ³•ï¼š</p></li><li><p><code>public void send(DatagramPacket dp)</code>ï¼šå‘é€æ•°æ®åŒ…</p></li><li><p><code>public void receive(DatagramPacket p)</code>ï¼šæ¥æ”¶æ•°æ®åŒ…</p></li><li><p><code>public void close()</code>ï¼šå…³é—­æ•°æ®æŠ¥å¥—æ¥å­—</p></li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UDPClientDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;===å¯åŠ¨å®¢æˆ·ç«¯===&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1.åˆ›å»ºä¸€ä¸ªé›†è£…ç®±å¯¹è±¡ï¼Œç”¨äºå°è£…éœ€è¦å‘é€çš„æ•°æ®åŒ…!</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token string">&quot;æˆ‘å­¦Java&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DatagramPacket</span> packet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramPacket</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span>bubffer<span class="token punctuation">.</span>length<span class="token punctuation">,</span><span class="token class-name">InetAddress</span><span class="token punctuation">.</span>getLoclHost<span class="token punctuation">,</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.åˆ›å»ºä¸€ä¸ªç å¤´å¯¹è±¡</span>
        <span class="token class-name">DatagramSocket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramSocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.å¼€å§‹å‘é€æ•°æ®åŒ…å¯¹è±¡</span>
        socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>packet<span class="token punctuation">)</span><span class="token punctuation">;</span>
        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UDPServerDemo</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==å¯åŠ¨æœåŠ¡ç«¯ç¨‹åº==&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1.åˆ›å»ºä¸€ä¸ªæ¥æ”¶å®¢æˆ·éƒ½ç«¯çš„æ•°æ®åŒ…å¯¹è±¡ï¼ˆé›†è£…ç®±ï¼‰</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">DatagramPacket</span> packet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramPacket</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> bubffer<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.åˆ›å»ºä¸€ä¸ªæ¥æ”¶ç«¯çš„ç å¤´å¯¹è±¡</span>
        <span class="token class-name">DatagramSocket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramSocket</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.å¼€å§‹æ¥æ”¶</span>
        socket<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>packet<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4.ä»é›†è£…ç®±ä¸­è·å–æœ¬æ¬¡è¯»å–çš„æ•°æ®é‡</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> packet<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5.è¾“å‡ºæ•°æ®</span>
        <span class="token comment">// String rs = new String(socket.getData(), 0, len)</span>
        <span class="token class-name">String</span> rs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer <span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 6.æœåŠ¡ç«¯è¿˜å¯ä»¥è·å–å‘æ¥ä¿¡æ¯çš„å®¢æˆ·ç«¯çš„IPå’Œç«¯å£ã€‚</span>
        <span class="token class-name">String</span> ip <span class="token operator">=</span> packet<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHostAdress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> port <span class="token operator">=</span> packet<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="é€šè®¯æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#é€šè®¯æ–¹å¼"><span>é€šè®¯æ–¹å¼</span></a></h5><p>UDP é€šä¿¡æ–¹å¼ï¼š</p><ul><li>å•æ’­ï¼šç”¨äºä¸¤ä¸ªä¸»æœºä¹‹é—´çš„ç«¯å¯¹ç«¯é€šä¿¡</li><li>ç»„æ’­ï¼šç”¨äºå¯¹ä¸€ç»„ç‰¹å®šçš„ä¸»æœºè¿›è¡Œé€šä¿¡ IP : 224.0.1.0 Socket å¯¹è±¡ : MulticastSocket</li><li>å¹¿æ’­ï¼šç”¨äºä¸€ä¸ªä¸»æœºå¯¹æ•´ä¸ªå±€åŸŸç½‘ä¸Šæ‰€æœ‰ä¸»æœºä¸Šçš„æ•°æ®é€šä¿¡ IP : 255.255.255.255 Socket å¯¹è±¡ : DatagramSocket</li></ul><h4 id="tcp" tabindex="-1"><a class="header-anchor" href="#tcp"><span>TCP</span></a></h4><h5 id="åŸºæœ¬ä»‹ç»-1" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-1"><span>åŸºæœ¬ä»‹ç»</span></a></h5><p>TCP/IP (Transfer Control Protocol) åè®®ï¼Œä¼ è¾“æ§åˆ¶åè®®</p><p>TCP/IP åè®®çš„ç‰¹ç‚¹ï¼š</p><ul><li>é¢å‘è¿æ¥çš„åè®®ï¼Œæä¾›å¯é äº¤äº’ï¼Œé€Ÿåº¦æ…¢</li><li>ç‚¹å¯¹ç‚¹çš„å…¨åŒå·¥é€šä¿¡</li><li>é€šè¿‡<strong>ä¸‰æ¬¡æ¡æ‰‹</strong>å»ºç«‹è¿æ¥ï¼Œè¿æ¥æˆåŠŸå½¢æˆæ•°æ®ä¼ è¾“é€šé“ï¼›é€šè¿‡<strong>å››æ¬¡æŒ¥æ‰‹</strong>æ–­å¼€è¿æ¥</li><li>åŸºäºå­—èŠ‚æµè¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œä¼ è¾“æ•°æ®å¤§å°æ²¡æœ‰é™åˆ¶</li></ul><p>TCP åè®®çš„ä½¿ç”¨åœºæ™¯ï¼šæ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ã€é‚®ä»¶å‘é€å’Œæ¥æ”¶ã€è¿œç¨‹ç™»å½•</p><p>æ³¨æ„ï¼š<strong>TCP ä¸ä¼šä¸ºæ²¡æœ‰æ•°æ®çš„ ACK è¶…æ—¶é‡ä¼ </strong></p><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877313808-354ba9b2-838c-4ab4-87c5-d048f040bc1b.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314269-dee875b1-3d70-45c9-b7dc-0ba4de68ea2e.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>æ¨èé˜…è¯»ï¼šhttps://yuanrengu.com/2020/77eef79f.html</p><h5 id="socket" tabindex="-1"><a class="header-anchor" href="#socket"><span>Socket</span></a></h5><p>TCP é€šä¿¡ä¹Ÿå« <strong>Socket ç½‘ç»œç¼–ç¨‹</strong>ï¼Œåªè¦ä»£ç åŸºäº Socket å¼€å‘ï¼Œåº•å±‚å°±æ˜¯åŸºäºäº†å¯é ä¼ è¾“çš„ TCP é€šä¿¡</p><p>åŒå‘é€šä¿¡ï¼šJava Socket æ˜¯å…¨åŒå·¥çš„ï¼Œåœ¨ä»»æ„æ—¶åˆ»ï¼Œçº¿è·¯ä¸Šå­˜åœ¨ <code>A -&gt; B</code> å’Œ <code>B -&gt; A</code> çš„åŒå‘ä¿¡å·ä¼ è¾“ï¼Œå³ä½¿æ˜¯é˜»å¡ IOï¼Œè¯»å’Œå†™ä¹Ÿæ˜¯å¯ä»¥åŒæ—¶è¿›è¡Œçš„ï¼Œåªè¦åˆ†åˆ«é‡‡ç”¨è¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹å³å¯ï¼Œè¯»ä¸ä¼šé˜»å¡å†™ã€å†™ä¹Ÿä¸ä¼šé˜»å¡è¯»</p><p>TCP åè®®ç›¸å…³çš„ç±»ï¼š</p><ul><li>Socketï¼šä¸€ä¸ªè¯¥ç±»çš„å¯¹è±¡å°±ä»£è¡¨ä¸€ä¸ªå®¢æˆ·ç«¯ç¨‹åºã€‚</li><li>ServerSocketï¼šä¸€ä¸ªè¯¥ç±»çš„å¯¹è±¡å°±ä»£è¡¨ä¸€ä¸ªæœåŠ¡å™¨ç«¯ç¨‹åºã€‚</li></ul><p>Socket ç±»ï¼š</p><ul><li><p>æ„é€ æ–¹æ³•ï¼š</p></li><li><p><code>Socket(InetAddress address,int port)</code>ï¼šåˆ›å»ºæµå¥—æ¥å­—å¹¶å°†å…¶è¿æ¥åˆ°æŒ‡å®š IP æŒ‡å®šç«¯å£å·</p></li><li><p><code>Socket(String host, int port)</code>ï¼šæ ¹æ® IP åœ°å€å­—ç¬¦ä¸²å’Œç«¯å£å·åˆ›å»ºå®¢æˆ·ç«¯ Socket å¯¹è±¡ æ³¨æ„äº‹é¡¹ï¼š<strong>æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå°±ä¼šç«‹å³è¿æ¥æŒ‡å®šçš„æœåŠ¡å™¨ï¼Œè¿æ¥æˆåŠŸï¼Œåˆ™è¡¨ç¤ºä¸‰æ¬¡æ¡æ‰‹é€šè¿‡</strong>ï¼Œåä¹‹æŠ›å‡ºå¼‚å¸¸</p></li><li><p>å¸¸ç”¨ APIï¼š</p></li><li><p><code>OutputStream getOutputStream()</code>ï¼šè·å¾—å­—èŠ‚è¾“å‡ºæµå¯¹è±¡</p></li><li><p><code>InputStream getInputStream()</code>ï¼šè·å¾—å­—èŠ‚è¾“å…¥æµå¯¹è±¡</p></li><li><p><code>void shutdownInput()</code>ï¼šåœæ­¢æ¥å—</p></li><li><p><code>void shutdownOutput()</code>ï¼šåœæ­¢å‘é€æ•°æ®ï¼Œç»ˆæ­¢é€šä¿¡</p></li><li><p><code>SocketAddress getRemoteSocketAddress()</code>ï¼šè¿”å›å¥—æ¥å­—è¿æ¥åˆ°çš„ç«¯ç‚¹çš„åœ°å€ï¼Œæœªè¿æ¥è¿”å› null</p></li></ul><p>ServerSocket ç±»ï¼š</p><ul><li>æ„é€ æ–¹æ³•ï¼š<code>public ServerSocket(int port)</code></li><li>å¸¸ç”¨ APIï¼š<code>public Socket accept()</code>ï¼Œ<strong>é˜»å¡ç­‰å¾…</strong>æ¥æ”¶ä¸€ä¸ªå®¢æˆ·ç«¯çš„ Socket ç®¡é“è¿æ¥è¯·æ±‚ï¼Œè¿æ¥æˆåŠŸè¿”å›ä¸€ä¸ª Socket å¯¹è±¡ ä¸‰æ¬¡æ¡æ‰‹å TCP è¿æ¥å»ºç«‹æˆåŠŸï¼ŒæœåŠ¡å™¨å†…æ ¸ä¼šæŠŠè¿æ¥ä» SYN åŠè¿æ¥é˜Ÿåˆ—ï¼ˆä¸€æ¬¡æ¡æ‰‹æ—¶åœ¨æœåŠ¡ç«¯å»ºç«‹çš„é˜Ÿåˆ—ï¼‰ä¸­ç§»å‡ºï¼Œç§»å…¥ accept å…¨è¿æ¥é˜Ÿåˆ—ï¼Œç­‰å¾…è¿›ç¨‹è°ƒç”¨ accept å‡½æ•°æ—¶æŠŠè¿æ¥å–å‡ºã€‚å¦‚æœè¿›ç¨‹ä¸èƒ½åŠæ—¶è°ƒç”¨ accept å‡½æ•°ï¼Œå°±ä¼šé€ æˆ accept é˜Ÿåˆ—æº¢å‡ºï¼Œæœ€ç»ˆå¯¼è‡´å»ºç«‹å¥½çš„ TCP è¿æ¥è¢«ä¸¢å¼ƒ <img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314251-4e909cbf-fc06-4edb-9435-88f6c0b18c13.png" alt="" loading="lazy"></li></ul><p><strong>ç›¸å½“äº</strong>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªæ•°æ®ç®¡é“ï¼ˆè™šè¿æ¥ï¼Œä¸æ˜¯çœŸæ­£çš„ç‰©ç†è¿æ¥ï¼‰ï¼Œç®¡é“ä¸€èˆ¬ä¸ç”¨ close</p><h5 id="å®ç°tcp" tabindex="-1"><a class="header-anchor" href="#å®ç°tcp"><span>å®ç°TCP</span></a></h5><h6 id="å¼€å‘æµç¨‹" tabindex="-1"><a class="header-anchor" href="#å¼€å‘æµç¨‹"><span>å¼€å‘æµç¨‹</span></a></h6><p>å®¢æˆ·ç«¯çš„å¼€å‘æµç¨‹ï¼š</p><ol><li>å®¢æˆ·ç«¯è¦è¯·æ±‚äºæœåŠ¡ç«¯çš„ Socket ç®¡é“è¿æ¥</li><li>ä» Socket é€šä¿¡ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å‡ºæµ</li><li>é€šè¿‡å­—èŠ‚è¾“å‡ºæµç»™æœåŠ¡ç«¯å†™å‡ºæ•°æ®</li></ol><p>æœåŠ¡ç«¯çš„å¼€å‘æµç¨‹ï¼š</p><ol><li>ç”¨ ServerSocket æ³¨å†Œç«¯å£</li><li>æ¥æ”¶å®¢æˆ·ç«¯çš„ Socket ç®¡é“è¿æ¥</li><li>ä» Socket é€šä¿¡ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å…¥æµ</li><li>ä»å­—èŠ‚è¾“å…¥æµä¸­è¯»å–å®¢æˆ·ç«¯å‘æ¥çš„æ•°æ®</li></ol><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314275-73944230-9433-448e-915c-b103360ebe15.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314341-67054877-44e7-420b-9c34-40f265fbcd1a.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>å¦‚æœè¾“å‡ºç¼“å†²åŒºç©ºé—´ä¸å¤Ÿå­˜æ”¾ä¸»æœºå‘é€çš„æ•°æ®ï¼Œåˆ™ä¼šè¢«é˜»å¡ï¼Œè¾“å…¥ç¼“å†²åŒºåŒç†</li><li>ç¼“å†²åŒºä¸å±äºåº”ç”¨ç¨‹åºï¼Œå±äºå†…æ ¸</li><li>TCP ä»è¾“å‡ºç¼“å†²åŒºè¯»å–æ•°æ®ä¼šåŠ é”é˜»å¡çº¿ç¨‹</li></ul><h6 id="å®ç°é€šä¿¡" tabindex="-1"><a class="header-anchor" href="#å®ç°é€šä¿¡"><span>å®ç°é€šä¿¡</span></a></h6><p>éœ€æ±‚ä¸€ï¼šå®¢æˆ·ç«¯å‘é€ä¸€è¡Œæ•°æ®ï¼ŒæœåŠ¡ç«¯æ¥æ”¶ä¸€è¡Œæ•°æ®</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClientDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.å®¢æˆ·ç«¯è¦è¯·æ±‚äºæœåŠ¡ç«¯çš„socketç®¡é“è¿æ¥ã€‚</span>
        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.ä»socketé€šä¿¡ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å‡ºæµ</span>
        <span class="token class-name">OutputStream</span> os <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.æŠŠä½çº§çš„å­—èŠ‚è¾“å‡ºæµåŒ…è£…æˆé«˜çº§çš„æ‰“å°æµã€‚</span>
        <span class="token class-name">PrintStream</span> ps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintStream</span><span class="token punctuation">(</span>os<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4.å¼€å§‹å‘æ¶ˆæ¯å‡ºå»</span>
        ps<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æˆ‘æ˜¯å®¢æˆ·ç«¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ps<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ä¸€èˆ¬ä¸å…³é—­IOæµ</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å®¢æˆ·ç«¯å‘é€å®Œæ¯•~~~~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServerDemo</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----æœåŠ¡ç«¯å¯åŠ¨----&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1.æ³¨å†Œç«¯å£: public ServerSocket(int port)</span>
        <span class="token class-name">ServerSocket</span> serverSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.å¼€å§‹ç­‰å¾…æ¥æ”¶å®¢æˆ·ç«¯çš„Socketç®¡é“è¿æ¥ã€‚</span>
        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> serverSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.ä»socketé€šä¿¡ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å…¥æµã€‚</span>
        <span class="token class-name">InputStream</span> is <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4.æŠŠå­—èŠ‚è¾“å…¥æµè½¬æ¢æˆå­—ç¬¦è¾“å…¥æµ</span>
        <span class="token class-name">BufferedReader</span> br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 6.æŒ‰ç…§è¡Œè¯»å–æ¶ˆæ¯ ã€‚</span>
        <span class="token class-name">String</span> line<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éœ€æ±‚äºŒï¼šå®¢æˆ·ç«¯å¯ä»¥åå¤å‘é€æ•°æ®ï¼ŒæœåŠ¡ç«¯å¯ä»¥åå¤æ•°æ®</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClientDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.å®¢æˆ·ç«¯è¦è¯·æ±‚äºæœåŠ¡ç«¯çš„socketç®¡é“è¿æ¥ã€‚</span>
        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.ä»socketé€šä¿¡ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å‡ºæµ</span>
        <span class="token class-name">OutputStream</span> os <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.æŠŠä½çº§çš„å­—èŠ‚è¾“å‡ºæµåŒ…è£…æˆé«˜çº§çš„æ‰“å°æµã€‚</span>
        <span class="token class-name">PrintStream</span> ps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintStream</span><span class="token punctuation">(</span>os<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4.å¼€å§‹å‘æ¶ˆæ¯å‡ºå»</span>
         <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">Scanner</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·è¯´ï¼š&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ps<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sc<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ps<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServerDemo</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----æœåŠ¡ç«¯å¯åŠ¨----&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1.æ³¨å†Œç«¯å£: public ServerSocket(int port)</span>
        <span class="token class-name">ServerSocket</span> serverSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.å¼€å§‹ç­‰å¾…æ¥æ”¶å®¢æˆ·ç«¯çš„Socketç®¡é“è¿æ¥ã€‚</span>
        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> serverSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.ä»socketé€šä¿¡ç®¡é“ä¸­å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å…¥æµã€‚</span>
        <span class="token class-name">InputStream</span> is <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4.æŠŠå­—èŠ‚è¾“å…¥æµè½¬æ¢æˆå­—ç¬¦è¾“å…¥æµ</span>
        <span class="token class-name">BufferedReader</span> br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 6.æŒ‰ç…§è¡Œè¯»å–æ¶ˆæ¯ ã€‚</span>
        <span class="token class-name">String</span> line<span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éœ€æ±‚ä¸‰ï¼šå®ç°ä¸€ä¸ªæœåŠ¡ç«¯å¯ä»¥åŒæ—¶æ¥æ”¶å¤šä¸ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClientDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">OutputStream</span> os <span class="token operator">=</span> <span class="token keyword">new</span> socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PrintStream</span> ps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintStream</span><span class="token punctuation">(</span>os<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">Scanner</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·è¯´ï¼š&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ps<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sc<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ps<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServerDemo</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----æœåŠ¡ç«¯å¯åŠ¨----&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ServerSocket</span> serverSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// å¼€å§‹ç­‰å¾…æ¥æ”¶å®¢æˆ·ç«¯çš„Socketç®¡é“è¿æ¥ã€‚</span>
             <span class="token class-name">Socket</span> socket <span class="token operator">=</span> serverSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ¯æ¥æ”¶åˆ°ä¸€ä¸ªå®¢æˆ·ç«¯å¿…é¡»ä¸ºè¿™ä¸ªå®¢æˆ·ç«¯ç®¡é“åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥å¤„ç†ä¸ä¹‹é€šä¿¡ã€‚</span>
            <span class="token keyword">new</span> <span class="token class-name">ServerReaderThread</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">ServerReaderThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>
    privat <span class="token class-name">Socket</span> socket<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">ServerReaderThread</span><span class="token punctuation">(</span><span class="token class-name">Socket</span> socket<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>socket <span class="token operator">=</span> socket<span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> is <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           	<span class="token class-name">BufferedReader</span> br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">)</span>
           <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">String</span> line<span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">sout</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getRemoteSocketAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> line<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">sout</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getRemoteSocketAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ä¸‹çº¿äº†~~~~~~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="ä¼ªå¼‚æ­¥" tabindex="-1"><a class="header-anchor" href="#ä¼ªå¼‚æ­¥"><span>ä¼ªå¼‚æ­¥</span></a></h6><p>ä¸€ä¸ªå®¢æˆ·ç«¯è¦ä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶å‘è¶Šé«˜ç³»ç»Ÿç˜«ç—ªçš„è¶Šå¿«ï¼Œå¯ä»¥åœ¨æœåŠ¡ç«¯å¼•å…¥çº¿ç¨‹æ± ï¼Œä½¿ç”¨çº¿ç¨‹æ± æ¥å¤„ç†ä¸å®¢æˆ·ç«¯çš„æ¶ˆæ¯é€šä¿¡</p><ul><li>ä¼˜åŠ¿ï¼šä¸ä¼šå¼•èµ·ç³»ç»Ÿçš„æ­»æœºï¼Œå¯ä»¥æ§åˆ¶å¹¶å‘çº¿ç¨‹çš„æ•°é‡</li><li>åŠ£åŠ¿ï¼šåŒæ—¶å¯ä»¥å¹¶å‘çš„çº¿ç¨‹å°†å—åˆ°é™åˆ¶</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BIOServer</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//çº¿ç¨‹æ± æœºåˆ¶</span>
        <span class="token comment">//åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå¦‚æœæœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œå°±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¸ä¹‹é€šè®¯(å•ç‹¬å†™ä¸€ä¸ªæ–¹æ³•)</span>
        <span class="token class-name">ExecutorService</span> newCachedThreadPool <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åˆ›å»ºServerSocket</span>
        <span class="token class-name">ServerSocket</span> serverSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">6666</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æœåŠ¡å™¨å¯åŠ¨äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;çº¿ç¨‹åå­— = &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//ç›‘å¬ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç­‰å¾…è¿æ¥....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">final</span> <span class="token class-name">Socket</span> socket <span class="token operator">=</span> serverSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿æ¥åˆ°ä¸€ä¸ªå®¢æˆ·ç«¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¸ä¹‹é€šè®¯</span>
            newCachedThreadPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//å¯ä»¥å’Œå®¢æˆ·ç«¯é€šè®¯</span>
                    <span class="token function">handler</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//ç¼–å†™ä¸€ä¸ªhandleræ–¹æ³•ï¼Œå’Œå®¢æˆ·ç«¯é€šè®¯</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token class-name">Socket</span> socket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;çº¿ç¨‹åå­— = &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">//é€šè¿‡socketè·å–è¾“å…¥æµ</span>
            <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> len<span class="token punctuation">;</span>
            <span class="token comment">//å¾ªç¯çš„è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> inputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;çº¿ç¨‹åå­— = &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//è¾“å‡ºå®¢æˆ·ç«¯å‘é€çš„æ•°æ®</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> read<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å…³é—­å’Œclientçš„è¿æ¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="æ–‡ä»¶ä¼ è¾“" tabindex="-1"><a class="header-anchor" href="#æ–‡ä»¶ä¼ è¾“"><span>æ–‡ä»¶ä¼ è¾“</span></a></h5><h6 id="å­—èŠ‚æµ" tabindex="-1"><a class="header-anchor" href="#å­—èŠ‚æµ"><span>å­—èŠ‚æµ</span></a></h6><p>å®¢æˆ·ç«¯ï¼šæœ¬åœ°å›¾ç‰‡: â€ªE:\seazean\å›¾ç‰‡èµ„æº\beautiful.jpg æœåŠ¡ç«¯ï¼šæœåŠ¡å™¨è·¯å¾„ï¼šE:\seazean\å›¾ç‰‡æœåŠ¡å™¨</p><p>UUID. randomUUID() : æ–¹æ³•ç”Ÿæˆéšæœºçš„æ–‡ä»¶å</p><p><strong>socket.shutdownOutput()</strong>ï¼šè¿™ä¸ªå¿…é¡»æ‰§è¡Œï¼Œä¸ç„¶æœåŠ¡å™¨ä¼šä¸€ç›´å¾ªç¯ç­‰å¾…æ•°æ®ï¼Œæœ€åæ–‡ä»¶æŸåï¼Œç¨‹åºæŠ¥é”™</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">//å¸¸é‡åŒ…</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Constants</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SRC_IMAGE</span> <span class="token operator">=</span> <span class="token string">&quot;D:\\seazean\\å›¾ç‰‡èµ„æº\\beautiful.jpg&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SERVER_DIR</span> <span class="token operator">=</span> <span class="token string">&quot;D:\\seazean\\å›¾ç‰‡æœåŠ¡å™¨\\&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SERVER_IP</span> <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">SERVER_PORT</span> <span class="token operator">=</span> <span class="token number">8888</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClientDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">ERVER_IP</span><span class="token punctuation">,</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">SERVER_PORT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BufferedOutputStream</span> bos<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">BufferedOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æå–æœ¬æœºçš„å›¾ç‰‡ä¸Šä¼ ç»™æœåŠ¡ç«¯ã€‚Constants.SRC_IMAGE</span>
        <span class="token class-name">BufferedInputStream</span> bis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> len <span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        bos<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ·æ–°å›¾ç‰‡æ•°æ®åˆ°æœåŠ¡ç«¯ï¼ï¼</span>
        socket<span class="token punctuation">.</span><span class="token function">shutdownOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å‘Šè¯‰æœåŠ¡ç«¯æˆ‘çš„æ•°æ®å·²ç»å‘é€å®Œæ¯•ï¼Œä¸è¦åœ¨ç­‰æˆ‘äº†ï¼</span>
        bis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//ç­‰å¾…ç€æœåŠ¡ç«¯çš„å“åº”æ•°æ®ï¼ï¼</span>
        <span class="token class-name">BufferedReader</span> br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span>
           				 <span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¶åˆ°æœåŠ¡ç«¯å“åº”ï¼š&quot;</span><span class="token operator">+</span>br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServerDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----æœåŠ¡ç«¯å¯åŠ¨----&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1.æ³¨å†Œç«¯å£: </span>
        <span class="token class-name">ServerSocket</span> serverSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">SERVER_PORT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.å®šä¹‰ä¸€ä¸ªå¾ªç¯ä¸æ–­çš„æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// 3.å¼€å§‹ç­‰å¾…æ¥æ”¶å®¢æˆ·ç«¯çš„Socketç®¡é“è¿æ¥ã€‚</span>
            <span class="token class-name">Socket</span> socket <span class="token operator">=</span> serverSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 4.æ¯æ¥æ”¶åˆ°ä¸€ä¸ªå®¢æˆ·ç«¯å¿…é¡»ä¸ºè¿™ä¸ªå®¢æˆ·ç«¯ç®¡é“åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥å¤„ç†ä¸ä¹‹é€šä¿¡ã€‚</span>
            <span class="token keyword">new</span> <span class="token class-name">ServerReaderThread</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">ServerReaderThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Socket</span> socket <span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">ServerReaderThread</span><span class="token punctuation">(</span><span class="token class-name">Socket</span> socket<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>socket <span class="token operator">=</span> socket<span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token class-name">InputStream</span> is <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           	<span class="token class-name">BufferedInputStream</span> bis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedInputStream</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BufferedOutputStream</span> bos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedOutputStream</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span>
                <span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">SERVER_DIR</span><span class="token operator">+</span><span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> len<span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                bos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            bos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æœåŠ¡ç«¯æ¥æ”¶å®Œæ¯•äº†ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// 4.å“åº”æ•°æ®ç»™å®¢æˆ·ç«¯</span>
            <span class="token class-name">PrintStream</span> ps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ps<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ‚¨å¥½ï¼Œå·²æˆåŠŸæ¥æ”¶æ‚¨ä¸Šä¼ çš„å›¾ç‰‡ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ps<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">sout</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getRemoteSocketAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ä¸‹çº¿äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="æ•°æ®æµ" tabindex="-1"><a class="header-anchor" href="#æ•°æ®æµ"><span>æ•°æ®æµ</span></a></h6><p>æ„é€ æ–¹æ³•ï¼š</p><ul><li><code>DataOutputStream(OutputStream out)</code> : åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®è¾“å‡ºæµï¼Œä»¥å°†æ•°æ®å†™å…¥æŒ‡å®šçš„åº•å±‚è¾“å‡ºæµ</li><li><code>DataInputStream(InputStream in)</code> : åˆ›å»ºä½¿ç”¨æŒ‡å®šçš„åº•å±‚ InputStream çš„ DataInputStream</li></ul><p>å¸¸ç”¨APIï¼š</p><ul><li><code>final void writeUTF(String str)</code> : ä½¿ç”¨æœºå™¨æ— å…³çš„æ–¹å¼ä½¿ç”¨ UTF-8 ç¼–ç å°†å­—ç¬¦ä¸²å†™å…¥åº•å±‚è¾“å‡ºæµ</li><li><code>final String readUTF()</code> : è¯»å–ä»¥ modified UTF-8 æ ¼å¼ç¼–ç çš„ Unicode å­—ç¬¦ä¸²ï¼Œè¿”å› String ç±»å‹</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">InputStream</span> is <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//  1ã€è¯·æ±‚ä¸æœåŠ¡ç«¯çš„Socketé“¾æ¥</span>
            <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span> <span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//  2ã€æŠŠå­—èŠ‚è¾“å‡ºæµåŒ…è£…æˆä¸€ä¸ªæ•°æ®è¾“å‡ºæµ</span>
            <span class="token class-name">DataOutputStream</span> dos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//  3ã€å…ˆå‘é€ä¸Šä¼ æ–‡ä»¶çš„åç¼€ç»™æœåŠ¡ç«¯</span>
            dos<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span><span class="token string">&quot;.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//  4ã€æŠŠæ–‡ä»¶æ•°æ®å‘é€ç»™æœåŠ¡ç«¯è¿›è¡Œæ¥æ”¶</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> len<span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> is<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
                dos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer <span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            dos<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Server</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServerSocket</span> ss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 		<span class="token comment">// 1ã€å¾—åˆ°ä¸€ä¸ªæ•°æ®è¾“å…¥æµè¯»å–å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ•°æ®</span>
		<span class="token class-name">DataInputStream</span> dis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 2ã€è¯»å–å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ–‡ä»¶ç±»å‹</span>
		<span class="token class-name">String</span> suffix <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 3ã€å®šä¹‰ä¸€ä¸ªå­—èŠ‚è¾“å‡ºç®¡é“è´Ÿè´£æŠŠå®¢æˆ·ç«¯å‘æ¥çš„æ–‡ä»¶æ•°æ®å†™å‡ºå»</span>
		<span class="token class-name">OutputStream</span> os <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token operator">+</span>
                    <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>suffix<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 4ã€ä»æ•°æ®è¾“å…¥æµä¸­è¯»å–æ–‡ä»¶æ•°æ®ï¼Œå†™å‡ºåˆ°å­—èŠ‚è¾“å‡ºæµä¸­å»</span>
		<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> len<span class="token punctuation">;</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 			os<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		os<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æœåŠ¡ç«¯æ¥æ”¶æ–‡ä»¶ä¿å­˜æˆåŠŸï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="nio" tabindex="-1"><a class="header-anchor" href="#nio"><span>NIO</span></a></h3><h4 id="åŸºæœ¬ä»‹ç»-2" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-2"><span>åŸºæœ¬ä»‹ç»</span></a></h4><p><strong>NIOçš„ä»‹ç»</strong>ï¼š</p><p>Java NIOï¼ˆNew IOã€Java non-blocking IOï¼‰ï¼Œä» Java 1.4 ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„ä¸€ä¸ªæ–°çš„ IO APIï¼Œå¯ä»¥æ›¿ä»£æ ‡å‡†çš„ Java IO APIï¼ŒNIO æ”¯æŒé¢å‘ç¼“å†²åŒºçš„ã€åŸºäºé€šé“çš„ IO æ“ä½œï¼Œä»¥æ›´åŠ é«˜æ•ˆçš„æ–¹å¼è¿›è¡Œæ–‡ä»¶çš„è¯»å†™æ“ä½œ</p><ul><li>NIO æœ‰ä¸‰å¤§æ ¸å¿ƒéƒ¨åˆ†ï¼š<strong>Channelï¼ˆé€šé“ï¼‰ï¼ŒBufferï¼ˆç¼“å†²åŒºï¼‰ï¼ŒSelectorï¼ˆé€‰æ‹©å™¨ï¼‰</strong></li><li>NIO æ˜¯éé˜»å¡ IOï¼Œä¼ ç»Ÿ IO çš„ read å’Œ write åªèƒ½é˜»å¡æ‰§è¡Œï¼Œçº¿ç¨‹åœ¨è¯»å†™ IO æœŸé—´ä¸èƒ½å¹²å…¶ä»–äº‹æƒ…ï¼Œæ¯”å¦‚è°ƒç”¨ socket.accept()ï¼Œå¦‚æœæœåŠ¡å™¨æ²¡æœ‰æ•°æ®ä¼ è¾“è¿‡æ¥ï¼Œçº¿ç¨‹å°±ä¸€ç›´é˜»å¡ï¼Œè€Œ NIO ä¸­å¯ä»¥é…ç½® Socket ä¸ºéé˜»å¡æ¨¡å¼</li><li>NIO å¯ä»¥åšåˆ°ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªæ“ä½œçš„ã€‚å‡è®¾æœ‰ 1000 ä¸ªè¯·æ±‚è¿‡æ¥ï¼Œæ ¹æ®å®é™…æƒ…å†µå¯ä»¥åˆ†é… 20 æˆ–è€… 80 ä¸ªçº¿ç¨‹æ¥å¤„ç†ï¼Œä¸åƒä¹‹å‰çš„é˜»å¡ IO é‚£æ ·åˆ†é… 1000 ä¸ª</li></ul><p>NIO å’Œ BIO çš„æ¯”è¾ƒï¼š</p><ul><li>BIO ä»¥æµçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€Œ NIO ä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œå— I/O çš„æ•ˆç‡æ¯”æµ I/O é«˜å¾ˆå¤š</li><li>BIO æ˜¯é˜»å¡çš„ï¼ŒNIO åˆ™æ˜¯éé˜»å¡çš„</li><li>BIO åŸºäºå­—èŠ‚æµå’Œå­—ç¬¦æµè¿›è¡Œæ“ä½œï¼Œè€Œ NIO åŸºäº Channel å’Œ Buffer è¿›è¡Œæ“ä½œï¼Œæ•°æ®ä»é€šé“è¯»å–åˆ°ç¼“å†²åŒºä¸­ï¼Œæˆ–è€…ä»ç¼“å†²åŒºå†™å…¥åˆ°é€šé“ä¸­ã€‚Selector ç”¨äºç›‘å¬å¤šä¸ªé€šé“çš„äº‹ä»¶ï¼ˆæ¯”å¦‚ï¼šè¿æ¥è¯·æ±‚ï¼Œæ•°æ®åˆ°è¾¾ç­‰ï¼‰ï¼Œå› æ­¤ä½¿ç”¨å•ä¸ªçº¿ç¨‹å°±å¯ä»¥ç›‘å¬å¤šä¸ªå®¢æˆ·ç«¯é€šé“</li></ul><table><thead><tr><th>NIO</th><th>BIO</th></tr></thead><tbody><tr><td>é¢å‘ç¼“å†²åŒºï¼ˆBufferï¼‰</td><td>é¢å‘æµï¼ˆStreamï¼‰</td></tr><tr><td>éé˜»å¡ï¼ˆNon Blocking IOï¼‰</td><td>é˜»å¡IO(Blocking IO)</td></tr><tr><td>é€‰æ‹©å™¨ï¼ˆSelectorsï¼‰</td><td></td></tr></tbody></table><h4 id="å®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#å®ç°åŸç†"><span>å®ç°åŸç†</span></a></h4><p>NIO ä¸‰å¤§æ ¸å¿ƒéƒ¨åˆ†ï¼šChannel (é€šé“)ã€Buffer (ç¼“å†²åŒº)ã€Selector (é€‰æ‹©å™¨)</p><ul><li>Buffer ç¼“å†²åŒº ç¼“å†²åŒºæœ¬è´¨æ˜¯ä¸€å—å¯ä»¥å†™å…¥æ•°æ®ã€è¯»å–æ•°æ®çš„å†…å­˜ï¼Œ<strong>åº•å±‚æ˜¯ä¸€ä¸ªæ•°ç»„</strong>ï¼Œè¿™å—å†…å­˜è¢«åŒ…è£…æˆ NIO Buffer å¯¹è±¡ï¼Œå¹¶ä¸”æä¾›äº†æ–¹æ³•ç”¨æ¥æ“ä½œè¿™å—å†…å­˜ï¼Œç›¸æ¯”è¾ƒç›´æ¥å¯¹æ•°ç»„çš„æ“ä½œï¼ŒBuffer çš„ API æ›´åŠ å®¹æ˜“æ“ä½œå’Œç®¡ç†</li><li>Channel é€šé“ Java NIO çš„é€šé“ç±»ä¼¼æµï¼Œä¸åŒçš„æ˜¯æ—¢å¯ä»¥ä»é€šé“ä¸­è¯»å–æ•°æ®ï¼Œåˆå¯ä»¥å†™æ•°æ®åˆ°é€šé“ï¼Œæµçš„è¯»å†™é€šå¸¸æ˜¯å•å‘çš„ï¼Œé€šé“å¯ä»¥éé˜»å¡è¯»å–å’Œå†™å…¥é€šé“ï¼Œæ”¯æŒè¯»å–æˆ–å†™å…¥ç¼“å†²åŒºï¼Œä¹Ÿæ”¯æŒå¼‚æ­¥åœ°è¯»å†™</li><li>Selector é€‰æ‹©å™¨ Selector æ˜¯ä¸€ä¸ª Java NIO ç»„ä»¶ï¼Œèƒ½å¤Ÿæ£€æŸ¥ä¸€ä¸ªæˆ–å¤šä¸ª NIO é€šé“ï¼Œå¹¶ç¡®å®šå“ªäº›é€šé“å·²ç»å‡†å¤‡å¥½è¿›è¡Œè¯»å–æˆ–å†™å…¥ï¼Œè¿™æ ·ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å¯ä»¥ç®¡ç†å¤šä¸ª channelï¼Œä»è€Œç®¡ç†å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œæé«˜æ•ˆç‡</li></ul><p>NIO çš„å®ç°æ¡†æ¶ï¼š</p><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314506-60b2c961-2bf7-40c0-893e-a1cde5eacca0.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>æ¯ä¸ª Channel å¯¹åº”ä¸€ä¸ª Buffer</li><li>ä¸€ä¸ªçº¿ç¨‹å¯¹åº” Selector ï¼Œ ä¸€ä¸ª Selector å¯¹åº”å¤šä¸ª Channelï¼ˆè¿æ¥ï¼‰</li><li>ç¨‹åºåˆ‡æ¢åˆ°å“ªä¸ª Channel æ˜¯ç”±äº‹ä»¶å†³å®šçš„ï¼ŒEvent æ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µ</li><li>Selector ä¼šæ ¹æ®ä¸åŒçš„äº‹ä»¶ï¼Œåœ¨å„ä¸ªé€šé“ä¸Šåˆ‡æ¢</li><li>Buffer æ˜¯ä¸€ä¸ªå†…å­˜å— ï¼Œ åº•å±‚æ˜¯ä¸€ä¸ªæ•°ç»„</li><li>æ•°æ®çš„è¯»å–å†™å…¥æ˜¯é€šè¿‡ Buffer å®Œæˆçš„ , BIO ä¸­è¦ä¹ˆæ˜¯è¾“å…¥æµï¼Œæˆ–è€…æ˜¯è¾“å‡ºæµï¼Œä¸èƒ½åŒå‘ï¼ŒNIO çš„ Buffer æ˜¯å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™ï¼Œ flip() åˆ‡æ¢ Buffer çš„å·¥ä½œæ¨¡å¼</li></ul><p>Java NIO ç³»ç»Ÿçš„æ ¸å¿ƒåœ¨äºï¼šé€šé“å’Œç¼“å†²åŒºï¼Œé€šé“è¡¨ç¤ºæ‰“å¼€çš„ IO è®¾å¤‡ï¼ˆä¾‹å¦‚ï¼šæ–‡ä»¶ã€ å¥—æ¥å­—ï¼‰çš„è¿æ¥ã€‚è‹¥è¦ä½¿ç”¨ NIO ç³»ç»Ÿï¼Œè·å–ç”¨äºè¿æ¥ IO è®¾å¤‡çš„é€šé“ä»¥åŠç”¨äºå®¹çº³æ•°æ®çš„ç¼“å†²åŒºï¼Œç„¶åæ“ä½œç¼“å†²åŒºï¼Œå¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒChannel è´Ÿè´£ä¼ è¾“ï¼Œ Buffer è´Ÿè´£å­˜å–æ•°æ®</p><h4 id="ç¼“å†²åŒº" tabindex="-1"><a class="header-anchor" href="#ç¼“å†²åŒº"><span>ç¼“å†²åŒº</span></a></h4><h5 id="åŸºæœ¬ä»‹ç»-3" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-3"><span>åŸºæœ¬ä»‹ç»</span></a></h5><p>ç¼“å†²åŒºï¼ˆBufferï¼‰ï¼šç¼“å†²åŒºæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<strong>å¯ä»¥è¯»å†™æ•°æ®çš„å†…å­˜å—</strong>ï¼Œç”¨äºç‰¹å®šåŸºæœ¬æ•°æ®ç±»å‹çš„å®¹å™¨ï¼Œç”¨äºä¸ NIO é€šé“è¿›è¡Œäº¤äº’ï¼Œæ•°æ®æ˜¯ä»é€šé“è¯»å…¥ç¼“å†²åŒºï¼Œä»ç¼“å†²åŒºå†™å…¥é€šé“ä¸­çš„</p><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314685-bc8824d8-cffb-4d3b-a126-3fe4f9c874a1.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>Buffer åº•å±‚æ˜¯ä¸€ä¸ªæ•°ç»„</strong>ï¼Œå¯ä»¥ä¿å­˜å¤šä¸ªç›¸åŒç±»å‹çš„æ•°æ®ï¼Œæ ¹æ®æ•°æ®ç±»å‹ä¸åŒ ï¼Œæœ‰ä»¥ä¸‹ Buffer å¸¸ç”¨å­ç±»ï¼šByteBufferã€CharBufferã€ShortBufferã€IntBufferã€LongBufferã€FloatBufferã€DoubleBuffer</p><h5 id="åŸºæœ¬å±æ€§" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬å±æ€§"><span>åŸºæœ¬å±æ€§</span></a></h5><ul><li>å®¹é‡ï¼ˆcapacityï¼‰ï¼šä½œä¸ºä¸€ä¸ªå†…å­˜å—ï¼ŒBuffer å…·æœ‰å›ºå®šå¤§å°ï¼Œç¼“å†²åŒºå®¹é‡ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”åˆ›å»ºåä¸èƒ½æ›´æ”¹</li><li>é™åˆ¶ ï¼ˆlimitï¼‰ï¼šè¡¨ç¤ºç¼“å†²åŒºä¸­å¯ä»¥æ“ä½œæ•°æ®çš„å¤§å°ï¼ˆlimit åæ•°æ®ä¸èƒ½è¿›è¡Œè¯»å†™ï¼‰ï¼Œç¼“å†²åŒºçš„é™åˆ¶ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”ä¸èƒ½å¤§äºå…¶å®¹é‡ã€‚å†™å…¥æ¨¡å¼ï¼Œlimit ç­‰äº buffer çš„å®¹é‡ï¼›è¯»å–æ¨¡å¼ä¸‹ï¼Œlimit ç­‰äºå†™å…¥çš„æ•°æ®é‡</li><li>ä½ç½®ï¼ˆpositionï¼‰ï¼š<strong>ä¸‹ä¸€ä¸ªè¦è¯»å–æˆ–å†™å…¥çš„æ•°æ®çš„ç´¢å¼•</strong>ï¼Œç¼“å†²åŒºçš„ä½ç½®ä¸èƒ½ä¸ºè´Ÿï¼Œå¹¶ä¸”ä¸èƒ½å¤§äºå…¶é™åˆ¶</li><li>æ ‡è®°ï¼ˆmarkï¼‰ä¸é‡ç½®ï¼ˆresetï¼‰ï¼šæ ‡è®°æ˜¯ä¸€ä¸ªç´¢å¼•ï¼Œé€šè¿‡ Buffer ä¸­çš„ mark() æ–¹æ³•æŒ‡å®š Buffer ä¸­ä¸€ä¸ªç‰¹å®šçš„ä½ç½®ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ reset() æ–¹æ³•æ¢å¤åˆ°è¿™ä¸ª position</li><li>ä½ç½®ã€é™åˆ¶ã€å®¹é‡éµå®ˆä»¥ä¸‹ä¸å˜å¼ï¼š <strong>0 &lt;= position &lt;= limit &lt;= capacity</strong> <img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314724-0a1b8fea-b7da-4b8b-a551-80868146edb0.png" alt="" loading="lazy"></li></ul><h5 id="å¸¸ç”¨api" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨api"><span>å¸¸ç”¨API</span></a></h5><p><code>static XxxBuffer allocate(int capacity)</code>ï¼šåˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º capacity çš„ XxxBuffer å¯¹è±¡</p><p>Buffer åŸºæœ¬æ“ä½œï¼š</p><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>public Buffer clear()</td><td>æ¸…ç©ºç¼“å†²åŒºï¼Œä¸æ¸…ç©ºå†…å®¹ï¼Œå°†ä½ç½®è®¾ç½®ä¸ºé›¶ï¼Œé™åˆ¶è®¾ç½®ä¸ºå®¹é‡</td></tr><tr><td>public Buffer flip()</td><td>ç¿»è½¬ç¼“å†²åŒºï¼Œå°†ç¼“å†²åŒºçš„ç•Œé™è®¾ç½®ä¸ºå½“å‰ä½ç½®ï¼Œposition ç½® 0</td></tr><tr><td>public int capacity()</td><td>è¿”å› Bufferçš„ capacity å¤§å°</td></tr><tr><td>public final int limit()</td><td>è¿”å› Buffer çš„ç•Œé™ limit çš„ä½ç½®</td></tr><tr><td>public Buffer limit(int n)</td><td>è®¾ç½®ç¼“å†²åŒºç•Œé™ä¸º n</td></tr><tr><td>public Buffer mark()</td><td>åœ¨æ­¤ä½ç½®å¯¹ç¼“å†²åŒºè®¾ç½®æ ‡è®°</td></tr><tr><td>public final int position()</td><td>è¿”å›ç¼“å†²åŒºçš„å½“å‰ä½ç½® position</td></tr><tr><td>public Buffer position(int n)</td><td>è®¾ç½®ç¼“å†²åŒºçš„å½“å‰ä½ç½®ä¸ºn</td></tr><tr><td>public Buffer reset()</td><td>å°†ä½ç½® position é‡ç½®ä¸ºå…ˆå‰ mark æ ‡è®°çš„ä½ç½®</td></tr><tr><td>public Buffer rewind()</td><td>å°†ä½ç½®è®¾ä¸ºä¸º 0ï¼Œå–æ¶ˆè®¾ç½®çš„ mark</td></tr><tr><td>public final int remaining()</td><td>è¿”å›å½“å‰ä½ç½® position å’Œ limit ä¹‹é—´çš„å…ƒç´ ä¸ªæ•°</td></tr><tr><td>public final boolean hasRemaining()</td><td>åˆ¤æ–­ç¼“å†²åŒºä¸­æ˜¯å¦è¿˜æœ‰å…ƒç´ </td></tr><tr><td>public static ByteBuffer wrap(byte[] array)</td><td>å°†ä¸€ä¸ªå­—èŠ‚æ•°ç»„åŒ…è£…åˆ°ç¼“å†²åŒºä¸­</td></tr><tr><td>abstract ByteBuffer asReadOnlyBuffer()</td><td>åˆ›å»ºä¸€ä¸ªæ–°çš„åªè¯»å­—èŠ‚ç¼“å†²åŒº</td></tr><tr><td>public abstract ByteBuffer compact()</td><td>ç¼“å†²åŒºå½“å‰ä½ç½®ä¸å…¶é™åˆ¶ï¼ˆå¦‚æœæœ‰ï¼‰ä¹‹é—´çš„å­—èŠ‚è¢«å¤åˆ¶åˆ°ç¼“å†²åŒºçš„å¼€å¤´</td></tr></tbody></table><p>Buffer æ•°æ®æ“ä½œï¼š</p><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>public abstract byte get()</td><td>è¯»å–è¯¥ç¼“å†²åŒºå½“å‰ä½ç½®çš„å•ä¸ªå­—èŠ‚ï¼Œç„¶åä½ç½® + 1</td></tr><tr><td>public ByteBuffer get(byte[] dst)</td><td>è¯»å–å¤šä¸ªå­—èŠ‚åˆ°å­—èŠ‚æ•°ç»„ dst ä¸­</td></tr><tr><td>public abstract byte get(int index)</td><td>è¯»å–æŒ‡å®šç´¢å¼•ä½ç½®çš„å­—èŠ‚ï¼Œä¸ç§»åŠ¨ position</td></tr><tr><td>public abstract ByteBuffer put(byte b)</td><td>å°†ç»™å®šå•ä¸ªå­—èŠ‚å†™å…¥ç¼“å†²åŒºçš„å½“å‰ä½ç½®ï¼Œposition+1</td></tr><tr><td>public final ByteBuffer put(byte[] src)</td><td>å°† src å­—èŠ‚æ•°ç»„å†™å…¥ç¼“å†²åŒºçš„å½“å‰ä½ç½®</td></tr><tr><td>public abstract ByteBuffer put(int index, byte b)</td><td>å°†æŒ‡å®šå­—èŠ‚å†™å…¥ç¼“å†²åŒºçš„ç´¢å¼•ä½ç½®ï¼Œä¸ç§»åŠ¨ position</td></tr></tbody></table><p>æç¤ºï¼š&quot;\n&quot;ï¼Œå ç”¨ä¸¤ä¸ªå­—èŠ‚</p><h5 id="è¯»å†™æ•°æ®" tabindex="-1"><a class="header-anchor" href="#è¯»å†™æ•°æ®"><span>è¯»å†™æ•°æ®</span></a></h5><p>ä½¿ç”¨ Buffer è¯»å†™æ•°æ®ä¸€èˆ¬éµå¾ªä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š</p><ul><li>å†™å…¥æ•°æ®åˆ° Buffer</li><li>è°ƒç”¨ flip()æ–¹æ³•ï¼Œè½¬æ¢ä¸ºè¯»å–æ¨¡å¼</li><li>ä» Buffer ä¸­è¯»å–æ•°æ®</li><li>è°ƒç”¨ buffer.clear() æ–¹æ³•æ¸…é™¤ç¼“å†²åŒºï¼ˆä¸æ˜¯æ¸…ç©ºäº†æ•°æ®ï¼Œåªæ˜¯é‡ç½®æŒ‡é’ˆï¼‰</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestBuffer</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;seazean&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">//1. åˆ†é…ä¸€ä¸ªæŒ‡å®šå¤§å°çš„ç¼“å†²åŒº</span>
		<span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----------------allocate()----------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bufferf<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1024</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1024</span>
        
        <span class="token comment">//2. åˆ©ç”¨ put() å­˜å…¥æ•°æ®åˆ°ç¼“å†²åŒºä¸­</span>
      	buffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----------------put()----------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bufferf<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//7</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1024</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1024</span>
        
        <span class="token comment">//3. åˆ‡æ¢è¯»å–æ•°æ®æ¨¡å¼</span>
        buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----------------flip()----------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//7</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1024</span>
        
        <span class="token comment">//4. åˆ©ç”¨ get() è¯»å–ç¼“å†²åŒºä¸­çš„æ•°æ®</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dst <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>dst<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dst<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dst<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//7</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//7</span>
       
        <span class="token comment">//5. clear() : æ¸…ç©ºç¼“å†²åŒº. ä½†æ˜¯ç¼“å†²åŒºä¸­çš„æ•°æ®ä¾ç„¶å­˜åœ¨ï¼Œä½†æ˜¯å¤„äºâ€œè¢«é—å¿˜â€çŠ¶æ€</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span>
        buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span>
      	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----------------clear()----------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0</span>
      	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1024</span>
      	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1024</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="ç²˜åŒ…æ‹†åŒ…" tabindex="-1"><a class="header-anchor" href="#ç²˜åŒ…æ‹†åŒ…"><span>ç²˜åŒ…æ‹†åŒ…</span></a></h5><p>ç½‘ç»œä¸Šæœ‰å¤šæ¡æ•°æ®å‘é€ç»™æœåŠ¡ç«¯ï¼Œæ•°æ®ä¹‹é—´ä½¿ç”¨ \n è¿›è¡Œåˆ†éš”ï¼Œä½†è¿™äº›æ•°æ®åœ¨æ¥æ”¶æ—¶ï¼Œè¢«è¿›è¡Œäº†é‡æ–°ç»„åˆ</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// Hello,world\n</span>
<span class="token comment">// I&#39;m zhangsan\n</span>
<span class="token comment">// How are you?\n</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">&gt;</span> é»åŒ…ï¼ŒåŠåŒ…
<span class="token comment">// Hello,world\nI&#39;m zhangsan\nHo</span>
<span class="token comment">// w are you?\n</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ByteBuffer</span> source <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//                     11            24</span>
    source<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;Hello,world\nI&#39;m zhangsan\nHo&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">split</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>

    source<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;w are you?\nhaha!\n&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">split</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    source<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> oldLimit <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> oldLimit<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">&#39;\n&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ ¹æ®æ•°æ®çš„é•¿åº¦è®¾ç½®ç¼“å†²åŒº</span>
            <span class="token class-name">ByteBuffer</span> target <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">-</span> source<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 0 ~ limit</span>
            source<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            target<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä»source è¯»ï¼Œå‘ target å†™</span>
            <span class="token comment">// debugAll(target); è®¿é—® buffer çš„æ–¹æ³•</span>
            source<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>oldLimit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è®¿é—®è¿‡çš„æ•°æ®å¤åˆ¶åˆ°å¼€å¤´</span>
    source<span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç›´æ¥å†…å­˜" tabindex="-1"><a class="header-anchor" href="#ç›´æ¥å†…å­˜"><span>ç›´æ¥å†…å­˜</span></a></h4><h5 id="åŸºæœ¬ä»‹ç»-4" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-4"><span>åŸºæœ¬ä»‹ç»</span></a></h5><p>Byte Buffer æœ‰ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯åŸºäºç›´æ¥å†…å­˜ï¼ˆä¹Ÿå°±æ˜¯éå †å†…å­˜ï¼‰ï¼Œå¦ä¸€ç§æ˜¯éç›´æ¥å†…å­˜ï¼ˆä¹Ÿå°±æ˜¯å †å†…å­˜ï¼‰</p><p>Direct Memory ä¼˜ç‚¹ï¼š</p><ul><li>Java çš„ NIO åº“å…è®¸ Java ç¨‹åºä½¿ç”¨ç›´æ¥å†…å­˜ï¼Œä½¿ç”¨ native å‡½æ•°ç›´æ¥åˆ†é…å †å¤–å†…å­˜</li><li><strong>è¯»å†™æ€§èƒ½é«˜</strong>ï¼Œè¯»å†™é¢‘ç¹çš„åœºåˆå¯èƒ½ä¼šè€ƒè™‘ä½¿ç”¨ç›´æ¥å†…å­˜</li><li>å¤§å¤§æé«˜ IO æ€§èƒ½ï¼Œé¿å…äº†åœ¨ Java å †å’Œ native å †æ¥å›å¤åˆ¶æ•°æ®</li></ul><p>ç›´æ¥å†…å­˜ç¼ºç‚¹ï¼š</p><ul><li>ä¸èƒ½ä½¿ç”¨å†…æ ¸ç¼“å†²åŒº Page Cache çš„ç¼“å­˜ä¼˜åŠ¿ï¼Œæ— æ³•ç¼“å­˜æœ€è¿‘è¢«è®¿é—®çš„æ•°æ®å’Œä½¿ç”¨é¢„è¯»åŠŸèƒ½</li><li>åˆ†é…å›æ”¶æˆæœ¬è¾ƒé«˜ï¼Œä¸å— JVM å†…å­˜å›æ”¶ç®¡ç†</li><li>å¯èƒ½å¯¼è‡´ OutOfMemoryError å¼‚å¸¸ï¼šOutOfMemoryError: Direct buffer memory</li><li>å›æ”¶ä¾èµ– System.gc() çš„è°ƒç”¨ï¼Œä½†è¿™ä¸ªè°ƒç”¨ JVM ä¸ä¿è¯æ‰§è¡Œã€ä¹Ÿä¸ä¿è¯ä½•æ—¶æ‰§è¡Œï¼Œè¡Œä¸ºæ˜¯ä¸å¯æ§çš„ã€‚ç¨‹åºä¸€èˆ¬éœ€è¦è‡ªè¡Œç®¡ç†ï¼Œæˆå¯¹å»è°ƒç”¨ mallocã€free</li></ul><p>åº”ç”¨åœºæ™¯ï¼š</p><ul><li>ä¼ è¾“å¾ˆå¤§çš„æ•°æ®æ–‡ä»¶ï¼Œæ•°æ®çš„ç”Ÿå‘½å‘¨æœŸå¾ˆé•¿ï¼Œå¯¼è‡´ Page Cache æ²¡æœ‰èµ·åˆ°ç¼“å­˜çš„ä½œç”¨ï¼Œä¸€èˆ¬é‡‡ç”¨ç›´æ¥ IO çš„æ–¹å¼</li><li>é€‚åˆé¢‘ç¹çš„ IO æ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œå¹¶å‘åœºæ™¯</li></ul><p>æ•°æ®æµçš„è§’åº¦ï¼š</p><ul><li>éç›´æ¥å†…å­˜çš„ä½œç”¨é“¾ï¼šæœ¬åœ° IO â†’ å†…æ ¸ç¼“å†²åŒºâ†’ ç”¨æˆ·ï¼ˆJVMï¼‰ç¼“å†²åŒº â†’å†…æ ¸ç¼“å†²åŒº â†’ æœ¬åœ° IO</li><li>ç›´æ¥å†…å­˜æ˜¯ï¼šæœ¬åœ° IO â†’ ç›´æ¥å†…å­˜ â†’ æœ¬åœ° IO</li></ul><p>JVM ç›´æ¥å†…å­˜å›¾è§£ï¼š</p><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314888-17f1a26b-51eb-4d16-ab3d-0003d5196136.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314904-1e0bcc1e-13a3-4ce7-ad3a-48f76e5e43cc.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h5 id="é€šä¿¡åŸç†" tabindex="-1"><a class="header-anchor" href="#é€šä¿¡åŸç†"><span>é€šä¿¡åŸç†</span></a></h5><p>å †å¤–å†…å­˜ä¸å— JVM GC æ§åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨å †å¤–å†…å­˜è¿›è¡Œé€šä¿¡ï¼Œé˜²æ­¢ GC åç¼“å†²åŒºä½ç½®å‘ç”Ÿå˜åŒ–çš„æƒ…å†µ</p><p>NIO ä½¿ç”¨çš„ SocketChannel ä¹Ÿæ˜¯ä½¿ç”¨çš„å †å¤–å†…å­˜ï¼Œæºç è§£æï¼š</p><ul><li>SocketChannel#write(java.nio.ByteBuffer) â†’ SocketChannelImpl#write(java.nio.ByteBuffer)</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> var1<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
     <span class="token keyword">do</span> <span class="token punctuation">{</span>
         var3 <span class="token operator">=</span> <span class="token class-name">IOUtil</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fd<span class="token punctuation">,</span> var1<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1L</span><span class="token punctuation">,</span> nd<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span>var3 <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">3</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>IOUtil#write(java.io.FileDescriptor, java.nio.ByteBuffer, long, sun.nio.ch.NativeDispatcher)</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">FileDescriptor</span> var0<span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span> var1<span class="token punctuation">,</span> <span class="token keyword">long</span> var2<span class="token punctuation">,</span> <span class="token class-name">NativeDispatcher</span> var4<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ã€åˆ¤æ–­æ˜¯å¦æ˜¯ç›´æ¥å†…å­˜ï¼Œæ˜¯åˆ™ç›´æ¥å†™å‡ºï¼Œä¸æ˜¯åˆ™å°è£…åˆ°ç›´æ¥å†…å­˜ã€‘</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>var1 <span class="token keyword">instanceof</span> <span class="token class-name">DirectBuffer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">writeFromNativeBuffer</span><span class="token punctuation">(</span>var0<span class="token punctuation">,</span> var1<span class="token punctuation">,</span> var2<span class="token punctuation">,</span> var4<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">//....</span>
        <span class="token comment">// ä»å †å†…bufferæ‹·è´åˆ°å †å¤–buffer</span>
        <span class="token class-name">ByteBuffer</span> var8 <span class="token operator">=</span> <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">getTemporaryDirectBuffer</span><span class="token punctuation">(</span>var7<span class="token punctuation">)</span><span class="token punctuation">;</span>
        var8<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//...</span>
        <span class="token comment">// ä»å †å¤–å†™åˆ°å†…æ ¸ç¼“å†²åŒº</span>
		<span class="token keyword">int</span> var9 <span class="token operator">=</span> <span class="token function">writeFromNativeBuffer</span><span class="token punctuation">(</span>var0<span class="token punctuation">,</span> var8<span class="token punctuation">,</span> var2<span class="token punctuation">,</span> var4<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¯»æ“ä½œç›¸åŒ</li></ul><h5 id="åˆ†é…å›æ”¶" tabindex="-1"><a class="header-anchor" href="#åˆ†é…å›æ”¶"><span>åˆ†é…å›æ”¶</span></a></h5><p>ç›´æ¥å†…å­˜åˆ›å»º Buffer å¯¹è±¡ï¼š<code>static XxxBuffer allocateDirect(int capacity)</code></p><p>DirectByteBuffer æºç åˆ†æï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">DirectByteBuffer</span><span class="token punctuation">(</span><span class="token keyword">int</span> cap<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">//....</span>
    <span class="token keyword">long</span> base <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ†é…ç›´æ¥å†…å­˜</span>
        base <span class="token operator">=</span> unsafe<span class="token punctuation">.</span><span class="token function">allocateMemory</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å†…å­˜èµ‹å€¼</span>
    unsafe<span class="token punctuation">.</span><span class="token function">setMemory</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pa <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>base <span class="token operator">%</span> ps <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        address <span class="token operator">=</span> base <span class="token operator">+</span> ps <span class="token operator">-</span> <span class="token punctuation">(</span>base <span class="token operator">&amp;</span> <span class="token punctuation">(</span>ps <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        address <span class="token operator">=</span> base<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// åˆ›å»ºå›æ”¶å‡½æ•°</span>
    cleaner <span class="token operator">=</span> <span class="token class-name">Cleaner</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Deallocator</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> size<span class="token punctuation">,</span> cap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Deallocator</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        unsafe<span class="token punctuation">.</span><span class="token function">freeMemory</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åˆ†é…å’Œå›æ”¶åŸç†</strong>ï¼š</p><ul><li>ä½¿ç”¨äº† Unsafe å¯¹è±¡çš„ allocateMemory æ–¹æ³•å®Œæˆç›´æ¥å†…å­˜çš„åˆ†é…ï¼ŒsetMemory æ–¹æ³•å®Œæˆèµ‹å€¼</li><li>ByteBuffer çš„å®ç°ç±»å†…éƒ¨ï¼Œä½¿ç”¨äº† Cleanerï¼ˆè™šå¼•ç”¨ï¼‰æ¥ç›‘æµ‹ ByteBuffer å¯¹è±¡ï¼Œä¸€æ—¦ ByteBuffer å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼Œé‚£ä¹ˆ ReferenceHandler çº¿ç¨‹é€šè¿‡ Cleaner çš„ clean æ–¹æ³•è°ƒç”¨ Deallocator çš„ runæ–¹æ³•ï¼Œæœ€åé€šè¿‡ freeMemory æ¥é‡Šæ”¾ç›´æ¥å†…å­˜</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * ç›´æ¥å†…å­˜åˆ†é…çš„åº•å±‚åŸç†ï¼šUnsafe
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo1_27</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> _1Gb <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Unsafe</span> unsafe <span class="token operator">=</span> <span class="token function">getUnsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ†é…å†…å­˜</span>
        <span class="token keyword">long</span> base <span class="token operator">=</span> unsafe<span class="token punctuation">.</span><span class="token function">allocateMemory</span><span class="token punctuation">(</span>_1Gb<span class="token punctuation">)</span><span class="token punctuation">;</span>
        unsafe<span class="token punctuation">.</span><span class="token function">setMemory</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> _1Gb<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é‡Šæ”¾å†…å­˜</span>
        unsafe<span class="token punctuation">.</span><span class="token function">freeMemory</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Unsafe</span> <span class="token function">getUnsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Field</span> f <span class="token operator">=</span> <span class="token class-name">Unsafe</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">&quot;theUnsafe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            f<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Unsafe</span> unsafe <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Unsafe</span><span class="token punctuation">)</span> f<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> unsafe<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchFieldException</span> <span class="token operator">|</span> <span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="å…±äº«å†…å­˜" tabindex="-1"><a class="header-anchor" href="#å…±äº«å†…å­˜"><span>å…±äº«å†…å­˜</span></a></h5><p>FileChannel æä¾› map æ–¹æ³•è¿”å› MappedByteBuffer å¯¹è±¡ï¼ŒæŠŠæ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ï¼Œé€šå¸¸æƒ…å†µå¯ä»¥æ˜ å°„æ•´ä¸ªæ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶æ¯”è¾ƒå¤§ï¼Œå¯ä»¥è¿›è¡Œåˆ†æ®µæ˜ å°„ï¼Œå®Œæˆæ˜ å°„åå¯¹ç‰©ç†å†…å­˜çš„æ“ä½œä¼šè¢«<strong>åŒæ­¥</strong>åˆ°ç¡¬ç›˜ä¸Š</p><p>FileChannel ä¸­çš„æˆå‘˜å±æ€§ï¼š</p><ul><li><p>MapMode.modeï¼šå†…å­˜æ˜ åƒæ–‡ä»¶è®¿é—®çš„æ–¹å¼ï¼Œå…±ä¸‰ç§ï¼š</p></li><li><p><code>MapMode.READ_ONLY</code>ï¼šåªè¯»ï¼Œä¿®æ”¹å¾—åˆ°çš„ç¼“å†²åŒºå°†å¯¼è‡´æŠ›å‡ºå¼‚å¸¸</p></li><li><p><code>MapMode.READ_WRITE</code>ï¼šè¯»/å†™ï¼Œå¯¹ç¼“å†²åŒºçš„æ›´æ”¹æœ€ç»ˆå°†å†™å…¥æ–‡ä»¶ï¼Œä½†æ­¤æ¬¡ä¿®æ”¹å¯¹æ˜ å°„åˆ°åŒä¸€æ–‡ä»¶çš„å…¶ä»–ç¨‹åºä¸ä¸€å®šæ˜¯å¯è§</p></li><li><p><code>MapMode.PRIVATE</code>ï¼šç§ç”¨ï¼Œå¯è¯»å¯å†™ï¼Œä½†æ˜¯ä¿®æ”¹çš„å†…å®¹ä¸ä¼šå†™å…¥æ–‡ä»¶ï¼Œåªæ˜¯ buffer è‡ªèº«çš„æ”¹å˜</p></li><li><p><code>public final FileLock lock()</code>ï¼šè·å–æ­¤æ–‡ä»¶é€šé“çš„æ’ä»–é”</p></li></ul><p>MappedByteBufferï¼Œå¯ä»¥è®©æ–‡ä»¶åœ¨ç›´æ¥å†…å­˜ï¼ˆå †å¤–å†…å­˜ï¼‰ä¸­è¿›è¡Œä¿®æ”¹ï¼Œè¿™ç§æ–¹å¼å«åš<strong>å†…å­˜æ˜ å°„</strong>ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ç³»ç»Ÿåº•å±‚çš„ç¼“å­˜ï¼Œæ²¡æœ‰ JVM å’Œ OS ä¹‹é—´çš„å¤åˆ¶æ“ä½œï¼Œæé«˜äº†ä¼ è¾“æ•ˆç‡ï¼Œä½œç”¨ï¼š</p><ul><li><strong>å¯ä»¥ç”¨äºè¿›ç¨‹é—´çš„é€šä¿¡ï¼Œèƒ½è¾¾åˆ°å…±äº«å†…å­˜é¡µçš„ä½œç”¨</strong>ï¼Œä½†åœ¨é«˜å¹¶å‘ä¸‹è¦å¯¹æ–‡ä»¶å†…å­˜è¿›è¡ŒåŠ é”ï¼Œé˜²æ­¢å‡ºç°è¯»å†™å†…å®¹æ··ä¹±å’Œä¸ä¸€è‡´æ€§ï¼ŒJava æä¾›äº†æ–‡ä»¶é” FileLockï¼Œä½†åœ¨çˆ¶/å­è¿›ç¨‹ä¸­é”å®šåå¦ä¸€è¿›ç¨‹ä¼šä¸€ç›´ç­‰å¾…ï¼Œæ•ˆç‡ä¸é«˜</li><li>è¯»å†™é‚£äº›å¤ªå¤§è€Œä¸èƒ½æ”¾è¿›å†…å­˜ä¸­çš„æ–‡ä»¶ï¼Œ<strong>åˆ†æ®µæ˜ å°„</strong></li></ul><p>MappedByteBuffer è¾ƒä¹‹ ByteBuffer æ–°å¢çš„ä¸‰ä¸ªæ–¹æ³•ï¼š</p><ul><li><code>final MappedByteBuffer force()</code>ï¼šç¼“å†²åŒºæ˜¯ READ_WRITE æ¨¡å¼ä¸‹ï¼Œå¯¹ç¼“å†²åŒºå†…å®¹çš„ä¿®æ”¹<strong>å¼ºåˆ¶å†™å…¥æ–‡ä»¶</strong></li><li><code>final MappedByteBuffer load()</code>ï¼šå°†ç¼“å†²åŒºçš„å†…å®¹è½½å…¥ç‰©ç†å†…å­˜ï¼Œå¹¶è¿”å›è¯¥ç¼“å†²åŒºçš„å¼•ç”¨</li><li><code>final boolean isLoaded()</code>ï¼šå¦‚æœç¼“å†²åŒºçš„å†…å®¹åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œåˆ™è¿”å›çœŸï¼Œå¦åˆ™è¿”å›å‡</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MappedByteBufferTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// è¯»å†™æ¨¡å¼</span>
        <span class="token class-name">RandomAccessFile</span> ra <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span><span class="token string">&quot;1.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rw&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–å¯¹åº”çš„é€šé“</span>
        <span class="token class-name">FileChannel</span> channel <span class="token operator">=</span> ra<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * å‚æ•°1	FileChannel.MapMode.READ_WRITE ä½¿ç”¨çš„è¯»å†™æ¨¡å¼
         * å‚æ•°2	0: æ–‡ä»¶æ˜ å°„æ—¶çš„èµ·å§‹ä½ç½®
         * å‚æ•°3	5: æ˜¯æ˜ å°„åˆ°å†…å­˜çš„å¤§å°ï¼ˆä¸æ˜¯ç´¢å¼•ä½ç½®ï¼‰ï¼Œå³å°† 1.txt çš„å¤šå°‘ä¸ªå­—èŠ‚æ˜ å°„åˆ°å†…å­˜
         * å¯ä»¥ç›´æ¥ä¿®æ”¹çš„èŒƒå›´å°±æ˜¯ 0-5
         * å®é™…ç±»å‹ DirectByteBuffer
         */</span>
        <span class="token class-name">MappedByteBuffer</span> buffer <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">FileChannel<span class="token punctuation">.</span>MapMode</span><span class="token punctuation">.</span><span class="token constant">READ_WRITE</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        buffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token char">&#39;H&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token char">&#39;9&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token char">&#39;Y&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//IndexOutOfBoundsException</span>

        ra<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä¿®æ”¹æˆåŠŸ~~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»ç¡¬ç›˜ä¸Šå°†æ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œè¦ç»è¿‡æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œæ•°æ®æ‹·è´ï¼Œæ‹·è´æ“ä½œæ˜¯ç”±æ–‡ä»¶ç³»ç»Ÿå’Œç¡¬ä»¶é©±åŠ¨å®ç°ã€‚é€šè¿‡å†…å­˜æ˜ å°„çš„æ–¹æ³•è®¿é—®ç¡¬ç›˜ä¸Šçš„æ–‡ä»¶ï¼Œæ‹·è´æ•°æ®çš„æ•ˆç‡è¦æ¯” read å’Œ write ç³»ç»Ÿè°ƒç”¨é«˜ï¼š</p><ul><li>read() æ˜¯ç³»ç»Ÿè°ƒç”¨ï¼Œé¦–å…ˆå°†æ–‡ä»¶ä»ç¡¬ç›˜æ‹·è´åˆ°å†…æ ¸ç©ºé—´çš„ä¸€ä¸ªç¼“å†²åŒºï¼Œå†å°†è¿™äº›æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå®é™…ä¸Šè¿›è¡Œäº†ä¸¤æ¬¡æ•°æ®æ‹·è´</li><li>mmap() ä¹Ÿæ˜¯ç³»ç»Ÿè°ƒç”¨ï¼Œä½†æ²¡æœ‰è¿›è¡Œæ•°æ®æ‹·è´ï¼Œå½“ç¼ºé¡µä¸­æ–­å‘ç”Ÿæ—¶ï¼Œç›´æ¥å°†æ–‡ä»¶ä»ç¡¬ç›˜æ‹·è´åˆ°å…±äº«å†…å­˜ï¼Œåªè¿›è¡Œäº†ä¸€æ¬¡æ•°æ®æ‹·è´</li></ul><p>æ³¨æ„ï¼šmmap çš„æ–‡ä»¶æ˜ å°„ï¼Œåœ¨ Full GC æ—¶æ‰ä¼šè¿›è¡Œé‡Šæ”¾ï¼Œå¦‚æœéœ€è¦æ‰‹åŠ¨æ¸…é™¤å†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œå¯ä»¥åå°„è°ƒç”¨ sun.misc.Cleaner æ–¹æ³•</p><p>å‚è€ƒæ–‡ç« ï¼šhttps://www.jianshu.com/p/f90866dcbffc</p><h4 id="é€šé“" tabindex="-1"><a class="header-anchor" href="#é€šé“"><span>é€šé“</span></a></h4><h5 id="åŸºæœ¬ä»‹ç»-5" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-5"><span>åŸºæœ¬ä»‹ç»</span></a></h5><p>é€šé“ï¼ˆChannelï¼‰ï¼šè¡¨ç¤º IO æºä¸ç›®æ ‡æ‰“å¼€çš„è¿æ¥ï¼ŒChannel ç±»ä¼¼äºä¼ ç»Ÿçš„æµï¼Œåªä¸è¿‡ Channel æœ¬èº«ä¸èƒ½ç›´æ¥è®¿é—®æ•°æ®ï¼ŒChannel åªèƒ½ä¸ Buffer <strong>è¿›è¡Œäº¤äº’</strong></p><ol><li>NIO çš„é€šé“ç±»ä¼¼äºæµï¼Œä½†æœ‰äº›åŒºåˆ«å¦‚ä¸‹ï¼š</li></ol><ul><li>é€šé“å¯ä»¥åŒæ—¶è¿›è¡Œè¯»å†™ï¼Œè€Œæµåªèƒ½è¯»æˆ–è€…åªèƒ½å†™</li><li>é€šé“å¯ä»¥å®ç°å¼‚æ­¥è¯»å†™æ•°æ®</li><li>é€šé“å¯ä»¥ä»ç¼“å†²è¯»æ•°æ®ï¼Œä¹Ÿå¯ä»¥å†™æ•°æ®åˆ°ç¼“å†²</li></ul><ol><li>BIO ä¸­çš„ Stream æ˜¯å•å‘çš„ï¼ŒNIO ä¸­çš„ Channel æ˜¯åŒå‘çš„ï¼Œå¯ä»¥è¯»æ“ä½œï¼Œä¹Ÿå¯ä»¥å†™æ“ä½œ</li><li>Channel åœ¨ NIO ä¸­æ˜¯ä¸€ä¸ªæ¥å£ï¼š<code>public interface Channel extends Closeable{}</code></li></ol><p>Channel å®ç°ç±»ï¼š</p><ul><li><p>FileChannelï¼šç”¨äºè¯»å–ã€å†™å…¥ã€æ˜ å°„å’Œæ“ä½œæ–‡ä»¶çš„é€šé“ï¼Œ<strong>åªèƒ½å·¥ä½œåœ¨é˜»å¡æ¨¡å¼ä¸‹</strong></p></li><li><p>é€šè¿‡ FileInputStream è·å–çš„ Channel åªèƒ½è¯»</p></li><li><p>é€šè¿‡ FileOutputStream è·å–çš„ Channel åªèƒ½å†™</p></li><li><p>é€šè¿‡ RandomAccessFile æ˜¯å¦èƒ½è¯»å†™æ ¹æ®æ„é€  RandomAccessFile æ—¶çš„è¯»å†™æ¨¡å¼å†³å®š</p></li><li><p>DatagramChannelï¼šé€šè¿‡ UDP è¯»å†™ç½‘ç»œä¸­çš„æ•°æ®é€šé“</p></li><li><p>SocketChannelï¼šé€šè¿‡ TCP è¯»å†™ç½‘ç»œä¸­çš„æ•°æ®</p></li><li><p>ServerSocketChannelï¼šå¯ä»¥<strong>ç›‘å¬</strong>æ–°è¿›æ¥çš„ TCP è¿æ¥ï¼Œå¯¹æ¯ä¸€ä¸ªæ–°è¿›æ¥çš„è¿æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ª SocketChannel æç¤ºï¼šServerSocketChanne ç±»ä¼¼ ServerSocketã€SocketChannel ç±»ä¼¼ Socket</p></li></ul><h5 id="å¸¸ç”¨api-1" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨api-1"><span>å¸¸ç”¨API</span></a></h5><p>è·å– Channel æ–¹å¼ï¼š</p><ul><li>å¯¹æ”¯æŒé€šé“çš„å¯¹è±¡è°ƒç”¨ <code>getChannel()</code> æ–¹æ³•</li><li>é€šè¿‡é€šé“çš„é™æ€æ–¹æ³• <code>open()</code> æ‰“å¼€å¹¶è¿”å›æŒ‡å®šé€šé“</li><li>ä½¿ç”¨ Files ç±»çš„é™æ€æ–¹æ³• <code>newByteChannel()</code> è·å–å­—èŠ‚é€šé“</li></ul><p>Channel åŸºæœ¬æ“ä½œï¼š<strong>è¯»å†™éƒ½æ˜¯ç›¸å¯¹äºå†…å­˜æ¥çœ‹ï¼Œä¹Ÿå°±æ˜¯ç¼“å†²åŒº</strong></p><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>public abstract int read(ByteBuffer dst)</td><td>ä» Channel ä¸­è¯»å–æ•°æ®åˆ° ByteBufferï¼Œä» position å¼€å§‹å‚¨å­˜</td></tr><tr><td>public final long read(ByteBuffer[] dsts)</td><td>å°† Channel ä¸­çš„æ•°æ®åˆ†æ•£åˆ° ByteBuffer[]</td></tr><tr><td>public abstract int write(ByteBuffer src)</td><td>å°† ByteBuffer ä¸­çš„æ•°æ®å†™å…¥ Channelï¼Œä» position å¼€å§‹å†™å‡º</td></tr><tr><td>public final long write(ByteBuffer[] srcs)</td><td>å°† ByteBuffer[] åˆ°ä¸­çš„æ•°æ®èšé›†åˆ° Channel</td></tr><tr><td>public abstract long position()</td><td>è¿”å›æ­¤é€šé“çš„æ–‡ä»¶ä½ç½®</td></tr><tr><td>FileChannel position(long newPosition)</td><td>è®¾ç½®æ­¤é€šé“çš„æ–‡ä»¶ä½ç½®</td></tr><tr><td>public abstract long size()</td><td>è¿”å›æ­¤é€šé“çš„æ–‡ä»¶çš„å½“å‰å¤§å°</td></tr></tbody></table><p><strong>SelectableChannel çš„æ“ä½œ API</strong>ï¼š</p><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>SocketChannel accept()</td><td>å¦‚æœé€šé“å¤„äºéé˜»å¡æ¨¡å¼ï¼Œæ²¡æœ‰è¯·æ±‚è¿æ¥æ—¶æ­¤æ–¹æ³•å°†ç«‹å³è¿”å› NULLï¼Œå¦åˆ™å°†é˜»å¡ç›´åˆ°æœ‰æ–°çš„è¿æ¥æˆ–å‘ç”Ÿ I/O é”™è¯¯ï¼Œ<strong>é€šè¿‡è¯¥æ–¹æ³•è¿”å›çš„å¥—æ¥å­—é€šé“å°†å¤„äºé˜»å¡æ¨¡å¼</strong></td></tr><tr><td>SelectionKey register(Selector sel, int ops)</td><td>å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šï¼Œå¹¶æŒ‡å®šç›‘å¬äº‹ä»¶</td></tr><tr><td>SelectionKey register(Selector sel, int ops, Object att)</td><td>å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šï¼Œå¹¶åœ¨å½“å‰é€šé“<strong>ç»‘å®šä¸€ä¸ªé™„ä»¶å¯¹è±¡</strong>ï¼ŒObject ä»£è¡¨å¯ä»¥æ˜¯ä»»ä½•ç±»å‹</td></tr></tbody></table><h5 id="æ–‡ä»¶è¯»å†™" tabindex="-1"><a class="header-anchor" href="#æ–‡ä»¶è¯»å†™"><span>æ–‡ä»¶è¯»å†™</span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
 		<span class="token comment">// 1ã€å­—èŠ‚è¾“å‡ºæµé€šå‘ç›®æ ‡æ–‡ä»¶</span>
        <span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;data01.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2ã€å¾—åˆ°å­—èŠ‚è¾“å‡ºæµå¯¹åº”çš„é€šé“  ã€FileChannelã€‘</span>
        <span class="token class-name">FileChannel</span> channel <span class="token operator">=</span> fos<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3ã€åˆ†é…ç¼“å†²åŒº</span>
        <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;hello,é»‘é©¬Javaç¨‹åºå‘˜ï¼&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4ã€æŠŠç¼“å†²åŒºåˆ‡æ¢æˆå†™å‡ºæ¨¡å¼</span>
        buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å†™æ•°æ®åˆ°æ–‡ä»¶ä¸­ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1ã€å®šä¹‰ä¸€ä¸ªæ–‡ä»¶å­—èŠ‚è¾“å…¥æµä¸æºæ–‡ä»¶æ¥é€š</span>
        <span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;data01.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2ã€éœ€è¦å¾—åˆ°æ–‡ä»¶å­—èŠ‚è¾“å…¥æµçš„æ–‡ä»¶é€šé“</span>
        <span class="token class-name">FileChannel</span> channel <span class="token operator">=</span> fis<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3ã€å®šä¹‰ä¸€ä¸ªç¼“å†²åŒº</span>
        <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4ã€è¯»å–æ•°æ®åˆ°ç¼“å†²åŒº</span>
        channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5ã€è¯»å–å‡ºç¼“å†²åŒºä¸­çš„æ•°æ®å¹¶è¾“å‡ºå³å¯</span>
        <span class="token class-name">String</span> rs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>buffer<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="æ–‡ä»¶å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#æ–‡ä»¶å¤åˆ¶"><span>æ–‡ä»¶å¤åˆ¶</span></a></h5><p>Channel çš„æ–¹æ³•ï¼š<strong>sendfile å®ç°é›¶æ‹·è´</strong></p><ul><li><p><code>abstract long transferFrom(ReadableByteChannel src, long position, long count)</code>ï¼šä»ç»™å®šçš„å¯è¯»å­—èŠ‚é€šé“å°†å­—èŠ‚ä¼ è¾“åˆ°è¯¥é€šé“çš„æ–‡ä»¶ä¸­</p></li><li><p>srcï¼šæºé€šé“</p></li><li><p>positionï¼šæ–‡ä»¶ä¸­è¦è¿›è¡Œä¼ è¾“çš„ä½ç½®ï¼Œå¿…é¡»æ˜¯éè´Ÿçš„</p></li><li><p>countï¼šè¦ä¼ è¾“çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œå¿…é¡»æ˜¯éè´Ÿçš„</p></li><li><p><code>abstract long transferTo(long position, long count, WritableByteChannel target)</code>ï¼šå°†è¯¥é€šé“æ–‡ä»¶çš„å­—èŠ‚ä¼ è¾“åˆ°ç»™å®šçš„å¯å†™å­—èŠ‚é€šé“ã€‚</p></li><li><p>positionï¼šä¼ è¾“å¼€å§‹çš„æ–‡ä»¶ä¸­çš„ä½ç½®; å¿…é¡»æ˜¯éè´Ÿçš„</p></li><li><p>countï¼šè¦ä¼ è¾“çš„æœ€å¤§å­—èŠ‚æ•°; å¿…é¡»æ˜¯éè´Ÿçš„</p></li><li><p>targetï¼šç›®æ ‡é€šé“</p></li></ul><p>æ–‡ä»¶å¤åˆ¶çš„ä¸¤ç§æ–¹å¼ï¼š</p><ol><li>Buffer</li><li>ä½¿ç”¨ä¸Šè¿°ä¸¤ç§æ–¹æ³•</li></ol><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877314980-2f4d204b-2aa3-4af1-b16c-be555b80eff7.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">copy1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">File</span> srcFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;C:\\å£çº¸.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">File</span> destFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;C:\\Users\\å£çº¸new.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¾—åˆ°ä¸€ä¸ªå­—èŠ‚å­—èŠ‚è¾“å…¥æµ</span>
        <span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>srcFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¾—åˆ°ä¸€ä¸ªå­—èŠ‚è¾“å‡ºæµ</span>
        <span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>destFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¾—åˆ°çš„æ˜¯æ–‡ä»¶é€šé“</span>
        <span class="token class-name">FileChannel</span> isChannel <span class="token operator">=</span> fis<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileChannel</span> osChannel <span class="token operator">=</span> fos<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ†é…ç¼“å†²åŒº</span>
        <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// å¿…é¡»å…ˆæ¸…ç©ºç¼“å†²ç„¶åå†å†™å…¥æ•°æ®åˆ°ç¼“å†²åŒº</span>
            buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å¼€å§‹è¯»å–ä¸€æ¬¡æ•°æ®</span>
            <span class="token keyword">int</span> flag <span class="token operator">=</span> isChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// å·²ç»è¯»å–äº†æ•°æ® ï¼ŒæŠŠç¼“å†²åŒºçš„æ¨¡å¼åˆ‡æ¢æˆå¯è¯»æ¨¡å¼</span>
            buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æŠŠæ•°æ®å†™å‡ºåˆ°</span>
            osChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        isChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        osChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¤åˆ¶å®Œæˆï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">copy02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    	<span class="token comment">// 1ã€å­—èŠ‚è¾“å…¥ç®¡é“</span>
   	 	<span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;data01.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   	 	<span class="token class-name">FileChannel</span> isChannel <span class="token operator">=</span> fis<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 2ã€å­—èŠ‚è¾“å‡ºæµç®¡é“</span>
    	<span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;data03.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token class-name">FileChannel</span> osChannel <span class="token operator">=</span> fos<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 3ã€å¤åˆ¶</span>
    	osChannel<span class="token punctuation">.</span><span class="token function">transferFrom</span><span class="token punctuation">(</span>isChannel<span class="token punctuation">,</span>isChannel<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>isChannel<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	isChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	osChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    
	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">copy03</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    	<span class="token comment">// 1ã€å­—èŠ‚è¾“å…¥ç®¡é“</span>
    	<span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;data01.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token class-name">FileChannel</span> isChannel <span class="token operator">=</span> fis<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 2ã€å­—èŠ‚è¾“å‡ºæµç®¡é“</span>
    	<span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;data04.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token class-name">FileChannel</span> osChannel <span class="token operator">=</span> fos<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 3ã€å¤åˆ¶</span>
    	isChannel<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span>isChannel<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> isChannel<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> osChannel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	isChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	osChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="åˆ†æ•£èšé›†" tabindex="-1"><a class="header-anchor" href="#åˆ†æ•£èšé›†"><span>åˆ†æ•£èšé›†</span></a></h5><p>åˆ†æ•£è¯»å–ï¼ˆScatter ï¼‰ï¼šæ˜¯æŒ‡æŠŠ Channel é€šé“çš„æ•°æ®è¯»å…¥åˆ°å¤šä¸ªç¼“å†²åŒºä¸­å»</p><p>èšé›†å†™å…¥ï¼ˆGathering ï¼‰ï¼šæ˜¯æŒ‡å°†å¤šä¸ª Buffer ä¸­çš„æ•°æ®èšé›†åˆ° Channel</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">{</span>
    	<span class="token comment">// 1ã€å­—èŠ‚è¾“å…¥ç®¡é“</span>
        <span class="token class-name">FileInputStream</span> is <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;data01.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileChannel</span> isChannel <span class="token operator">=</span> is<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2ã€å­—èŠ‚è¾“å‡ºæµç®¡é“</span>
        <span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;data02.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileChannel</span> osChannel <span class="token operator">=</span> fos<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3ã€å®šä¹‰å¤šä¸ªç¼“å†²åŒºåšæ•°æ®åˆ†æ•£</span>
        <span class="token class-name">ByteBuffer</span> buffer1 <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ByteBuffer</span> buffer2 <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ByteBuffer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffers <span class="token operator">=</span> <span class="token punctuation">{</span>buffer1 <span class="token punctuation">,</span> buffer2<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// 4ã€ä»é€šé“ä¸­è¯»å–æ•°æ®åˆ†æ•£åˆ°å„ä¸ªç¼“å†²åŒº</span>
        isChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffers<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5ã€ä»æ¯ä¸ªç¼“å†²åŒºä¸­æŸ¥è¯¢æ˜¯å¦æœ‰æ•°æ®è¯»å–åˆ°äº†</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> buffer <span class="token operator">:</span> buffers<span class="token punctuation">)</span><span class="token punctuation">{</span>
            buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ‡æ¢åˆ°è¯»æ•°æ®æ¨¡å¼</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">remaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 6ã€èšé›†å†™å…¥åˆ°é€šé“</span>
        osChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffers<span class="token punctuation">)</span><span class="token punctuation">;</span>
        isChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        osChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ–‡ä»¶å¤åˆ¶~~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é€‰æ‹©å™¨" tabindex="-1"><a class="header-anchor" href="#é€‰æ‹©å™¨"><span>é€‰æ‹©å™¨</span></a></h4><h5 id="åŸºæœ¬ä»‹ç»-6" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-6"><span>åŸºæœ¬ä»‹ç»</span></a></h5><p>é€‰æ‹©å™¨ï¼ˆSelectorï¼‰ æ˜¯ SelectableChannle å¯¹è±¡çš„<strong>å¤šè·¯å¤ç”¨å™¨</strong>ï¼ŒSelector å¯ä»¥åŒæ—¶ç›‘æ§å¤šä¸ªé€šé“çš„çŠ¶å†µï¼Œåˆ©ç”¨ Selector å¯ä½¿ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ç®¡ç†å¤šä¸ª Channelï¼Œ<strong>Selector æ˜¯éé˜»å¡ IO çš„æ ¸å¿ƒ</strong></p><figure><img src="https://raw.githubusercontent.com/du-mozzie/PicGo/master/images/1713877315508-abd3b7f0-dfdb-413f-b3d6-c6fff66a74ab.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>Selector èƒ½å¤Ÿæ£€æµ‹å¤šä¸ªæ³¨å†Œçš„é€šé“ä¸Šæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼ˆå¤šä¸ª Channel ä»¥äº‹ä»¶çš„æ–¹å¼å¯ä»¥æ³¨å†Œåˆ°åŒä¸€ä¸ª Selector)ï¼Œå¦‚æœæœ‰äº‹ä»¶å‘ç”Ÿï¼Œå°±è·å–äº‹ä»¶ç„¶åé’ˆå¯¹æ¯ä¸ªäº‹ä»¶è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œå°±å¯ä»¥åªç”¨ä¸€ä¸ªå•çº¿ç¨‹å»ç®¡ç†å¤šä¸ªé€šé“ï¼Œä¹Ÿå°±æ˜¯ç®¡ç†å¤šä¸ªè¿æ¥å’Œè¯·æ±‚</li><li>åªæœ‰åœ¨è¿æ¥/é€šé“çœŸæ­£æœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ‰ä¼šè¿›è¡Œè¯»å†™ï¼Œå°±å¤§å¤§åœ°å‡å°‘äº†ç³»ç»Ÿå¼€é”€ï¼Œå¹¶ä¸”ä¸å¿…ä¸ºæ¯ä¸ªè¿æ¥éƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¸ç”¨å»ç»´æŠ¤å¤šä¸ªçº¿ç¨‹</li><li>é¿å…äº†å¤šçº¿ç¨‹ä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´çš„å¼€é”€</li></ul><h5 id="å¸¸ç”¨api-2" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨api-2"><span>å¸¸ç”¨API</span></a></h5><p>åˆ›å»º Selectorï¼š<code>Selector selector = Selector.open();</code></p><p>å‘é€‰æ‹©å™¨æ³¨å†Œé€šé“ï¼š<code>SelectableChannel.register(Selector sel, int ops, Object att)</code></p><ul><li><p>å‚æ•°ä¸€ï¼šé€‰æ‹©å™¨ï¼ŒæŒ‡å®šå½“å‰ Channel æ³¨å†Œåˆ°çš„é€‰æ‹©å™¨</p></li><li><p>å‚æ•°äºŒï¼šé€‰æ‹©å™¨å¯¹é€šé“çš„ç›‘å¬äº‹ä»¶ï¼Œç›‘å¬çš„äº‹ä»¶ç±»å‹ç”¨å››ä¸ªå¸¸é‡è¡¨ç¤º</p></li><li><p>è¯» : SelectionKey.OP_READ ï¼ˆ1ï¼‰</p></li><li><p>å†™ : SelectionKey.OP_WRITE ï¼ˆ4ï¼‰</p></li><li><p>è¿æ¥ : SelectionKey.OP_CONNECT ï¼ˆ8ï¼‰</p></li><li><p>æ¥æ”¶ : SelectionKey.OP_ACCEPT ï¼ˆ16ï¼‰</p></li><li><p>è‹¥ä¸æ­¢ç›‘å¬ä¸€ä¸ªäº‹ä»¶ï¼Œä½¿ç”¨ä½æˆ–æ“ä½œç¬¦è¿æ¥ï¼š<code>int interest = SelectionKey.OP_READ | SelectionKey.OP_WRITE</code></p></li><li><p>å‚æ•°ä¸‰ï¼šå¯ä»¥å…³è”ä¸€ä¸ªé™„ä»¶ï¼Œå¯ä»¥æ˜¯ä»»ä½•å¯¹è±¡</p></li></ul><p><strong>Selector API</strong>ï¼š</p><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>public static Selector open()</td><td>æ‰“å¼€é€‰æ‹©å™¨</td></tr><tr><td>public abstract void close()</td><td>å…³é—­æ­¤é€‰æ‹©å™¨</td></tr><tr><td>public abstract int select()</td><td><strong>é˜»å¡</strong>é€‰æ‹©ä¸€ç»„é€šé“å‡†å¤‡å¥½è¿›è¡Œ I/O æ“ä½œçš„é”®</td></tr><tr><td>public abstract int select(long timeout)</td><td><strong>é˜»å¡</strong>ç­‰å¾… timeout æ¯«ç§’</td></tr><tr><td>public abstract int selectNow()</td><td>è·å–ä¸€ä¸‹ï¼Œ<strong>ä¸é˜»å¡</strong>ï¼Œç«‹åˆ»è¿”å›</td></tr><tr><td>public abstract Selector wakeup()</td><td>å”¤é†’æ­£åœ¨é˜»å¡çš„ selector</td></tr><tr><td>public abstract Set selectedKeys()</td><td>è¿”å›æ­¤é€‰æ‹©å™¨çš„é€‰æ‹©é”®é›†</td></tr></tbody></table><p>SelectionKey API:</p><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>public abstract void cancel()</td><td>å–æ¶ˆè¯¥é”®çš„é€šé“ä¸å…¶é€‰æ‹©å™¨çš„æ³¨å†Œ</td></tr><tr><td>public abstract SelectableChannel channel()</td><td>è¿”å›åˆ›å»ºæ­¤é”®çš„é€šé“ï¼Œè¯¥æ–¹æ³•åœ¨å–æ¶ˆé”®ä¹‹åä»å°†è¿”å›é€šé“</td></tr><tr><td>public final Object attachment()</td><td>è¿”å›å½“å‰ key å…³è”çš„é™„ä»¶</td></tr><tr><td>public final boolean isAcceptable()</td><td>æ£€æµ‹æ­¤å¯†é’¥çš„é€šé“æ˜¯å¦å·²å‡†å¤‡å¥½æ¥å—æ–°çš„å¥—æ¥å­—è¿æ¥</td></tr><tr><td>public final boolean isConnectable()</td><td>æ£€æµ‹æ­¤å¯†é’¥çš„é€šé“æ˜¯å¦å·²å®Œæˆæˆ–æœªå®Œæˆå…¶å¥—æ¥å­—è¿æ¥æ“ä½œ</td></tr><tr><td>public final boolean isReadable()</td><td>æ£€æµ‹æ­¤å¯†é’¥çš„é¢‘é“æ˜¯å¦å¯ä»¥é˜…è¯»</td></tr><tr><td>public final boolean isWritable()</td><td>æ£€æµ‹æ­¤å¯†é’¥çš„é€šé“æ˜¯å¦å‡†å¤‡å¥½è¿›è¡Œå†™å…¥</td></tr></tbody></table><p>åŸºæœ¬æ­¥éª¤ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">//1.è·å–é€šé“</span>
<span class="token class-name">ServerSocketChannel</span> ssChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//2.åˆ‡æ¢éé˜»å¡æ¨¡å¼</span>
ssChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//3.ç»‘å®šè¿æ¥</span>
ssChannel<span class="token punctuation">.</span><span class="token function">bin</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//4.è·å–é€‰æ‹©å™¨</span>
<span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//5.å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šï¼Œå¹¶ä¸”æŒ‡å®šâ€œç›‘å¬æ¥æ”¶äº‹ä»¶â€</span>
ssChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_ACCEPT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="nioå®ç°" tabindex="-1"><a class="header-anchor" href="#nioå®ç°"><span>NIOå®ç°</span></a></h4><h5 id="å¸¸ç”¨api-3" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨api-3"><span>å¸¸ç”¨API</span></a></h5><ul><li>SelectableChannel_API</li></ul><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>public final SelectableChannel configureBlocking(boolean block)</td><td>è®¾ç½®æ­¤é€šé“çš„é˜»å¡æ¨¡å¼</td></tr><tr><td>public final SelectionKey register(Selector sel, int ops)</td><td>å‘ç»™å®šçš„é€‰æ‹©å™¨æ³¨å†Œæ­¤é€šé“ï¼Œå¹¶é€‰æ‹©å…³æ³¨çš„çš„äº‹ä»¶</td></tr></tbody></table><ul><li>SocketChannel_APIï¼š</li></ul><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>public static SocketChannel open()</td><td>æ‰“å¼€å¥—æ¥å­—é€šé“</td></tr><tr><td>public static SocketChannel open(SocketAddress remote)</td><td>æ‰“å¼€å¥—æ¥å­—é€šé“å¹¶è¿æ¥åˆ°è¿œç¨‹åœ°å€</td></tr><tr><td>public abstract boolean connect(SocketAddress remote)</td><td>è¿æ¥æ­¤é€šé“çš„åˆ°è¿œç¨‹åœ°å€</td></tr><tr><td>public abstract SocketChannel bind(SocketAddress local)</td><td>å°†é€šé“çš„å¥—æ¥å­—ç»‘å®šåˆ°æœ¬åœ°åœ°å€</td></tr><tr><td>public abstract SocketAddress getLocalAddress()</td><td>è¿”å›å¥—æ¥å­—ç»‘å®šçš„æœ¬åœ°å¥—æ¥å­—åœ°å€</td></tr><tr><td>public abstract SocketAddress getRemoteAddress()</td><td>è¿”å›å¥—æ¥å­—è¿æ¥çš„è¿œç¨‹å¥—æ¥å­—åœ°å€</td></tr></tbody></table><ul><li>ServerSocketChannel_APIï¼š</li></ul><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>public static ServerSocketChannel open()</td><td>æ‰“å¼€æœåŠ¡å™¨å¥—æ¥å­—é€šé“</td></tr><tr><td>public final ServerSocketChannel bind(SocketAddress local)</td><td>å°†é€šé“çš„å¥—æ¥å­—ç»‘å®šåˆ°æœ¬åœ°åœ°å€ï¼Œå¹¶é…ç½®å¥—æ¥å­—ä»¥ç›‘å¬è¿æ¥</td></tr><tr><td>public abstract SocketChannel accept()</td><td>æ¥å—ä¸æ­¤é€šé“å¥—æ¥å­—çš„è¿æ¥ï¼Œé€šè¿‡æ­¤æ–¹æ³•è¿”å›çš„å¥—æ¥å­—é€šé“å°†å¤„äºé˜»å¡æ¨¡å¼</td></tr></tbody></table><ul><li>å¦‚æœ ServerSocketChannel å¤„äºéé˜»å¡æ¨¡å¼ï¼Œå¦‚æœæ²¡æœ‰æŒ‚èµ·è¿æ¥ï¼Œåˆ™æ­¤æ–¹æ³•å°†ç«‹å³è¿”å› null</li><li>å¦‚æœé€šé“å¤„äºé˜»å¡æ¨¡å¼ï¼Œå¦‚æœæ²¡æœ‰æŒ‚èµ·è¿æ¥å°†æ— é™æœŸåœ°é˜»å¡ï¼Œç›´åˆ°æœ‰æ–°çš„è¿æ¥æˆ–å‘ç”Ÿ I/O é”™è¯¯</li></ul><h5 id="ä»£ç å®ç°" tabindex="-1"><a class="header-anchor" href="#ä»£ç å®ç°"><span>ä»£ç å®ç°</span></a></h5><p>æœåŠ¡ç«¯ ï¼š</p><ol><li>è·å–é€šé“ï¼Œå½“å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šé€šè¿‡ <code>ServerSocketChannel.accept</code> å¾—åˆ° SocketChannel</li><li>åˆ‡æ¢éé˜»å¡æ¨¡å¼</li><li>ç»‘å®šè¿æ¥</li><li>è·å–é€‰æ‹©å™¨</li><li>å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šï¼Œå¹¶ä¸”æŒ‡å®šç›‘å¬æ¥æ”¶äº‹ä»¶</li><li><strong>è½®è¯¢å¼</strong>çš„è·å–é€‰æ‹©å™¨ä¸Šå·²ç»å‡†å¤‡å°±ç»ªçš„äº‹ä»¶</li></ol><p>å®¢æˆ·ç«¯ï¼š</p><ol><li>è·å–é€šé“ï¼š<code>SocketChannel sc = SocketChannel.open(new InetSocketAddress(HOST, PORT))</code></li><li>åˆ‡æ¢éé˜»å¡æ¨¡å¼</li><li>åˆ†é…æŒ‡å®šå¤§å°çš„ç¼“å†²åŒºï¼š<code>ByteBuffer buffer = ByteBuffer.allocate(1024)</code></li><li>å‘é€æ•°æ®ç»™æœåŠ¡ç«¯</li></ol><p>37 è¡Œä»£ç ï¼Œå¦‚æœåˆ¤æ–­æ¡ä»¶æ”¹ä¸º !=-1ï¼Œéœ€è¦å®¢æˆ·ç«¯ close ä¸€ä¸‹</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Server</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 1ã€è·å–é€šé“</span>
        <span class="token class-name">ServerSocketChannel</span> serverSocketChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2ã€åˆ‡æ¢ä¸ºéé˜»å¡æ¨¡å¼</span>
        serverSocketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3ã€ç»‘å®šè¿æ¥çš„ç«¯å£</span>
        serverSocketChannel<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4ã€è·å–é€‰æ‹©å™¨Selector</span>
        <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5ã€å°†é€šé“éƒ½æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šå»ï¼Œå¹¶ä¸”å¼€å§‹æŒ‡å®šç›‘å¬æ¥æ”¶äº‹ä»¶</span>
        serverSocketChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_ACCEPT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 6ã€ä½¿ç”¨Selectoré€‰æ‹©å™¨é˜»å¡ç­‰å¾…è½®å·²ç»å°±ç»ªå¥½çš„äº‹ä»¶</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----å¼€å§‹æ–°ä¸€è½®çš„æ—¶é—´å¤„ç†----&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 7ã€è·å–é€‰æ‹©å™¨ä¸­çš„æ‰€æœ‰æ³¨å†Œçš„é€šé“ä¸­å·²ç»å°±ç»ªå¥½çš„äº‹ä»¶</span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> selectionKeys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> it <span class="token operator">=</span> selectionKeys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 8ã€å¼€å§‹éå†è¿™äº›å‡†å¤‡å¥½çš„äº‹ä»¶</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æå–å½“å‰è¿™ä¸ªäº‹ä»¶</span>
                <span class="token comment">// 9ã€åˆ¤æ–­è¿™ä¸ªäº‹ä»¶å…·ä½“æ˜¯ä»€ä¹ˆ</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 10ã€ç›´æ¥è·å–å½“å‰æ¥å…¥çš„å®¢æˆ·ç«¯é€šé“</span>
                    <span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span> serverSocketChannel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 11 ã€åˆ‡æ¢æˆéé˜»å¡æ¨¡å¼</span>
                    socketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">/*
                     ByteBuffer buffer = ByteBuffer.allocate(16);
                	 // å°†ä¸€ä¸ª byteBuffer ä½œä¸ºé™„ä»¶ã€å…³è”ã€‘åˆ° selectionKey ä¸Š
                	 SelectionKey scKey = sc.register(selector, 0, buffer);
                    */</span>
                    <span class="token comment">// 12ã€å°†æœ¬å®¢æˆ·ç«¯é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨</span>
                    socketChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 13ã€è·å–å½“å‰é€‰æ‹©å™¨ä¸Šçš„è¯»å°±ç»ªäº‹ä»¶</span>
                    <span class="token class-name">SelectableChannel</span> channel <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> channel<span class="token punctuation">;</span>
                    <span class="token comment">// 14ã€è¯»å–æ•°æ®</span>
                    <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// è·å–å…³è”çš„é™„ä»¶</span>
                    <span class="token comment">// ByteBuffer buffer = (ByteBuffer) key.attachment();</span>
                    <span class="token keyword">int</span> len<span class="token punctuation">;</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> socketChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>socketChannel<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ¸…é™¤ä¹‹å‰çš„æ•°æ®</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// åˆ é™¤å½“å‰çš„ selectionKeyï¼Œé˜²æ­¢é‡å¤æ“ä½œ</span>
                it<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1ã€è·å–é€šé“</span>
        <span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span> <span class="token class-name">SocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2ã€åˆ‡æ¢æˆéé˜»å¡æ¨¡å¼</span>
        socketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3ã€åˆ†é…æŒ‡å®šç¼“å†²åŒºå¤§å°</span>
        <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4ã€å‘é€æ•°æ®ç»™æœåŠ¡ç«¯</span>
        <span class="token class-name">Scanner</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·è¯´ï¼š&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> msg <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            buffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;Clientï¼š&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            socketChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="aio" tabindex="-1"><a class="header-anchor" href="#aio"><span>AIO</span></a></h3><p>Java AIO(NIO.2) ï¼š AsynchronousI/Oï¼Œå¼‚æ­¥éé˜»å¡ï¼Œé‡‡ç”¨äº† Proactor æ¨¡å¼ã€‚æœåŠ¡å™¨å®ç°æ¨¡å¼ä¸ºä¸€ä¸ªæœ‰æ•ˆè¯·æ±‚ä¸€ä¸ªçº¿ç¨‹ï¼Œå®¢æˆ·ç«¯çš„ I/O è¯·æ±‚éƒ½æ˜¯ç”± OS å…ˆå®Œæˆäº†å†é€šçŸ¥æœåŠ¡å™¨åº”ç”¨å»å¯åŠ¨çº¿ç¨‹è¿›è¡Œå¤„ç†</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token constant">AIO</span>å¼‚æ­¥éé˜»å¡ï¼ŒåŸºäº<span class="token constant">NIO</span>çš„ï¼Œå¯ä»¥ç§°ä¹‹ä¸º<span class="token constant">NIO2</span><span class="token punctuation">.</span><span class="token number">0</span>
  <span class="token constant">BIO</span>                     <span class="token constant">NIO</span>                                <span class="token constant">AIO</span>        
<span class="token class-name">Socket</span>                <span class="token class-name">SocketChannel</span>                    <span class="token class-name">AsynchronousSocketChannel</span>
<span class="token class-name">ServerSocket</span>          <span class="token class-name">ServerSocketChannel</span>	       <span class="token class-name">AsynchronousServerSocketChannel</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œè°ƒç”¨ API çš„ read æˆ– write æ–¹æ³•ï¼Œè¿™ä¸¤ç§æ–¹æ³•å‡ä¸ºå¼‚æ­¥çš„ï¼Œå®Œæˆåä¼šä¸»åŠ¨è°ƒç”¨å›è°ƒå‡½æ•°ï¼š</p><ul><li>å¯¹äºè¯»æ“ä½œï¼Œå½“æœ‰æµå¯è¯»å–æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†å¯è¯»çš„æµä¼ å…¥ read æ–¹æ³•çš„ç¼“å†²åŒº</li><li>å¯¹äºå†™æ“ä½œï¼Œå½“æ“ä½œç³»ç»Ÿå°† write æ–¹æ³•ä¼ é€’çš„æµå†™å…¥å®Œæ¯•æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¸»åŠ¨é€šçŸ¥åº”ç”¨ç¨‹åº</li></ul><p>åœ¨ JDK1.7 ä¸­ï¼Œè¿™éƒ¨åˆ†å†…å®¹è¢«ç§°ä½œ NIO.2ï¼Œä¸»è¦åœ¨ Java.nio.channels åŒ…ä¸‹å¢åŠ äº†ä¸‹é¢å››ä¸ªå¼‚æ­¥é€šé“ï¼š AsynchronousSocketChannelã€AsynchronousServerSocketChannelã€AsynchronousFileChannelã€AsynchronousDatagramChannel</p></div><!--[--><!----><!--]--><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 25484255238@qq.com">du</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/code/java/genericity.html" aria-label="æ³›å‹"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->æ³›å‹</div></a><a class="route-link nav-link next" href="/code/java/reflect.html" aria-label="åå°„"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">åå°„<!----></div></a></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright Â© 2025 mozzie </div></footer></div><!--]--><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-C3mFCu-w.js" defer></script>
  </body>
</html>
