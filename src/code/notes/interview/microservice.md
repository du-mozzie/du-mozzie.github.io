---
order: 2
title: 微服务相关的面试
date: 2026-02-17
category: 
    - 面试
    - 微服务
tag: 
    - 面试
    - 微服务
timeline: true
article: true
prev: ./
---

微服务相关的面试技巧

## 服务注册与发现

````markmap
---
markmap:
  colorFreezeLevel: 3
---

# 服务注册与发现

## 基本模型：三角形

### 服务上线
#### 1. 服务端启动成功，注册自身信息
#### 2. 注册中心和服务端要保持心跳
   - 注册中心通过心跳判断服务端是否崩溃
#### 3. 客户端找注册中心查询可用服务节点列表，缓存到本地
   - 可引导到缓存一致性
#### 4. 客户端和注册中心要保持心跳和数据同步
#### 5. 客户端发送请求
#### 6. 服务端返回响应

### 服务下线(引导到微服务优雅退出)
#### 1. 服务端通知注册中心自己准备下线
 - 1、2、3 需要的时间就是服务端等待的最短时间
#### 2. 注册中心通知客户端服务端下线
#### 3. 客户端不再使用该服务端
#### 4. 服务端等待一段时间之后，下线

## 高可用

### 服务端崩溃检测(总结心跳的一般机制)
- 心跳不通，立刻通知客户端
- 继续保持心跳
- 心跳如果一直失败，那么认为节点崩溃
- 心跳如果恢复，就通知客户端该节点可以继续使用


### 客户端容错

#### 原因
- 服务端崩溃
- 客户端和服务端网络不通
- 客户端连不上注册中心：客户端一直拿着老的可用节点列表

#### 措施
- 客户端发送请求失败，将节点踢出可用列表

- 和服务端崩溃检测心跳机制类似
  - 客户端继续给该节点发送心跳
  - 如果心跳重试都失败了，节点彻底不可用
  - 如果心跳恢复，客户端将节点放回可用列表


### 注册中心选型

#### 常见因素
- 中间件成熟度
- 社区活跃度
- 性能

#### CAP
- 数据一致性（C）服务可用性（A）分区容错性（P）
- CP 和 AP 选 AP
````

## 负载均衡

````markmap
---
markmap:
  colorFreezeLevel: 3
---

# 微服务负载均衡

## 基本算法

### 轮询与加权轮询
- 设置权重
  - 处理器的处理能力
  - 节点的重要性 / 优先级
  - 节点所在位置
- 平滑的加权轮询算法
  - Nginx 采用该算法

### 随机与加权随机

### 哈希与一致性哈希
- 哈希值均匀性
- 一致性哈希
  - Redis Cluster

### 最少连接数
- 多路复用的问题, 话题可以引向 IO 模型

### 最少活跃数

### 最快响应时间
#### 响应时间选取
- 平均值
- 99 线
- 999 线
- 中位数

#### 响应时间衰减
- 所有采集到的指标都需要考虑衰减问题

### 所有算法的固有缺陷
- 没有考虑请求所需资源不同，导致偶发性负载不均衡
- 没有真正计算服务端的负载，动态算法算了但不够准确

## 亮点

### 调用结果对负载均衡的影响
#### 动态调整权重
- 设置上下限
- 错误调整引发线上事故

#### 客户端上采用的服务治理措施,可以利用调用结果来调整

### 一致性哈希算法与本地缓存
- 提供缓存命中率
- 减少内存使用
- 依旧有不一致的问题
  - 缓存与数据一致性话题
  - 服务扩容的例子
````