import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as p,o as c,c as o,e as a,h as t,b as n}from"./app-CL4RzEzk.js";const l={},i=t('<p>NIO基础知识介绍</p><h2 id="nio基础" tabindex="-1"><a class="header-anchor" href="#nio基础"><span>NIO基础</span></a></h2><h3 id="三大组件" tabindex="-1"><a class="header-anchor" href="#三大组件"><span>三大组件</span></a></h3><h4 id="channel" tabindex="-1"><a class="header-anchor" href="#channel"><span>Channel</span></a></h4><p>Channel 是NIO 的核心组件，定义了 NIO 的核心功能，如：打开、关闭、绑定、监听、连接、读、写、获取通道属性等。</p><ul><li><p>FileChannel：文件通道，用于文件读写</p></li><li><p>SocketChannel：socket 通道，用于 TCP 通信</p></li><li><p>ServerSocketChannel：服务器 socket 通道，用于 UDP 通信</p></li><li><p>DatagramChannel：数据报通道，用于 UDP 通信</p></li></ul><h4 id="bytebuffer" tabindex="-1"><a class="header-anchor" href="#bytebuffer"><span>ByteBuffer</span></a></h4><p>ByteBuffer 是 NIO 的核心组件，它是 NIO 的核心抽象，是所有 NIO 组件的基础。Buffer 是 NIO 的核心抽象，它定义了 NIO 的核心功能，如：读、写、获取数据、设置数据、获取数据长度、获取数据起始位置、获取数据结束位置、获取数据类型。</p><blockquote><p>主要属性</p></blockquote><ul><li>capacity：缓冲区容量，表示缓冲区可以存储的最大字节数</li><li>limit：缓冲区限制，表示缓冲区可以读取的最大字节数</li><li>position：缓冲区位置，表示缓冲区可以读取的字节数</li><li>mark：标记一个位置，后续使用reset()方法可恢复position</li></ul><blockquote><p>主要方法</p></blockquote><ul><li>allocate()：指定缓冲区大小，分配一个缓冲区，返回一个缓冲区</li><li>flip()：将缓冲区从写模式切换到读模式，limit设置为position，position设置为0</li><li>clear()：清空缓冲区，将position设置为0，limit设置为capacity</li><li>compact()：压缩缓冲区，将未使用的空间移动到缓冲区的起始位置，将position设置为limit，limit设置为capacity</li><li>向buffer写入数据 <ul><li>channel.read(buffer) 通道写入缓冲区</li><li>buffer.put(byte) 缓冲区写入一个字节</li></ul></li><li>向buffer读取数据 <ul><li>channel.write(buffer) 获取缓冲区数据</li><li>buffer.get() 获取缓冲区数据</li></ul></li><li>get(i)：从指定位置读取一个字节，返回一个字节，不改变position</li><li>mark()：设置缓冲区的标记位置，后续使用reset()方法可恢复position</li><li>reset()：恢复缓冲区的位置，将position设置为mark，mark设置为-1</li><li>rewind()：将position设置为0，limit设置为capacity</li></ul><p>空闲缓冲区</p>',13),u=n("p",null,"写入数据后position指针移动",-1),k=n("h4",{id:"selector",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#selector"},[n("span",null,"Selector")])],-1),r=n("p",null,"Selector 是 NIO 的核心组件，定义了 NIO 的核心功能，如：注册、取消注册、选择、获取已注册通道、获取已注册通道数量、获取已注册通道类型、获取已注册通道属性等。",-1),d=n("h5",{id:"多线程模式",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#多线程模式"},[n("span",null,"多线程模式")])],-1),m=n("p",null,"一个thread对应一个socket，流程图如下：",-1),v=n("p",null,"缺点：",-1),h=n("ul",null,[n("li",null,"内存占用高"),n("li",null,"线程上下文切换成本高"),n("li",null,"只适合连接数少的场景")],-1),b=n("h5",{id:"线程池模式",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#线程池模式"},[n("span",null,"线程池模式")])],-1),f=n("ul",null,[n("li",null,"阻塞模式下，线程仅能处理一个 socket 连接"),n("li",null,"仅适合短连接场景")],-1),y=n("h5",{id:"selector-版设计",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#selector-版设计"},[n("span",null,"Selector 版设计")])],-1),g=n("p",null,"selector 的作用就是配合一个线程来管理多个 channel，获取这些 channel 上发生的事件，这些 channel 工作在非阻塞模式下，不会让线程吊死在一个 channel 上。适合连接数特别多，但流量低的场景（low traffic）",-1),S=t(`<p>调用 selector 的 select() 会阻塞直到 channel 发生了读写就绪事件，这些事件发生，select 方法就会返回这些事件交给 thread 来处理</p><h3 id="网络编程" tabindex="-1"><a class="header-anchor" href="#网络编程"><span>网络编程</span></a></h3><h4 id="阻塞模式" tabindex="-1"><a class="header-anchor" href="#阻塞模式"><span>阻塞模式</span></a></h4><ul><li>阻塞模式下，相关方法都会导致线程暂停 <ul><li>ServerSocketChannel.accept 会在没有连接建立时让线程暂停</li><li>SocketChannel.read 会在没有数据可读时让线程暂停</li><li>阻塞的表现其实就是线程暂停了，暂停期间不会占用 cpu，但线程相当于闲置</li></ul></li><li>单线程下，阻塞方法之间相互影响，几乎不能正常工作，需要多线程支持</li><li>但多线程下，有新的问题，体现在以下方面 <ul><li>32 位 jvm 一个线程 320k，64 位 jvm 一个线程 1024k，如果连接数过多，必然导致 OOM，并且线程太多，反而会因为频繁上下文切换导致性能降低</li><li>可以采用线程池技术来减少线程数和线程上下文切换，但治标不治本，如果有很多连接建立，但长时间 inactive，会阻塞线程池中所有线程，因此不适合长连接，只适合短连接</li></ul></li></ul><blockquote><p>服务器端</p></blockquote><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用open()方法打开一个ServerSocketChannel</span>
        <span class="token class-name">ServerSocketChannel</span> serverSocketChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 绑定监听端口</span>
        serverSocketChannel<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建一个SocketChannel列表用于保存所有连接</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span> socketChannels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 接收连接，返回一个SocketChannel  阻塞方法</span>
            <span class="token comment">// 没有获取到连接会一直阻塞</span>
            <span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span> serverSocketChannel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>socketChannel <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                socketChannels<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>socketChannel<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 处理连接</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;New connection: &quot;</span> <span class="token operator">+</span> socketChannel<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel <span class="token operator">:</span> socketChannels<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 处理read事件  默认阻塞方法</span>
                <span class="token keyword">int</span> read <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 处理读取到的数据</span>
                    buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> buffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Received: &quot;</span> <span class="token operator">+</span> sb<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>客户端</p></blockquote><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> clientChannel <span class="token operator">=</span> <span class="token class-name">SocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>clientChannel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="非阻塞模式" tabindex="-1"><a class="header-anchor" href="#非阻塞模式"><span>非阻塞模式</span></a></h4><ul><li>非阻塞模式下，相关方法都会不会让线程暂停 <ul><li>在 ServerSocketChannel.accept 在没有连接建立时，会返回 null，继续运行</li><li>SocketChannel.read 在没有数据可读时，会返回 0，但线程不必阻塞，可以去执行其它 SocketChannel 的 read 或是去执行 ServerSocketChannel.accept</li><li>写数据时，线程只是等待数据写入 Channel 即可，无需等 Channel 通过网络把数据发送出去</li></ul></li><li>但非阻塞模式下，即使没有连接建立，和可读数据，线程仍然在不断运行，白白浪费了 cpu</li><li>数据复制过程中，线程实际还是阻塞的（AIO 改进的地方）</li></ul><blockquote><p>服务端</p></blockquote><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用open()方法打开一个ServerSocketChannel</span>
        <span class="token class-name">ServerSocketChannel</span> serverSocketChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 绑定监听端口</span>
        serverSocketChannel<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置为非阻塞模式</span>
        serverSocketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span> socketChannels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 接收连接，返回一个SocketChannel</span>
            <span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span> serverSocketChannel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>socketChannel <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                socketChannels<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>socketChannel<span class="token punctuation">)</span><span class="token punctuation">;</span>
                socketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 处理连接</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;New connection: &quot;</span> <span class="token operator">+</span> socketChannel<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> channel <span class="token operator">:</span> socketChannels<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 处理read事件</span>
                <span class="token keyword">int</span> read <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 处理读取到的数据</span>
                    buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> buffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Received: &quot;</span> <span class="token operator">+</span> sb<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>客户端</p></blockquote><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> clientChannel <span class="token operator">=</span> <span class="token class-name">SocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">7000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>clientChannel<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// do something</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="多路复用" tabindex="-1"><a class="header-anchor" href="#多路复用"><span>多路复用</span></a></h4><p>单线程可以配合 Selector 完成对多个 Channel 可读写事件的监控，这称之为多路复用</p><ul><li>多路复用仅针对网络 IO、普通文件 IO 没法利用多路复用</li><li>如果不用 Selector 的非阻塞模式，线程大部分时间都在做无用功，而 Selector 能够保证 <ul><li>有可连接事件时才去连接</li><li>有可读事件才去读取</li><li>有可写事件才去写入 <ul><li>限于网络传输能力，Channel 未必时时可写，一旦 Channel 可写，会触发 Selector 的可写事件</li></ul></li></ul></li></ul>`,17);function C(w,I){const s=p("Mermaid");return c(),o("div",null,[i,a(s,{id:"mermaid-154",code:"eJxtkb9OwzAQxneeIkqXItUoidMqMRILjB0Qa9TBcWzVwsFRYqnwAPzZYO0DsDIi8UAZ+hYYX7DaKLec/d19P93ZQukd29LWBOu7s8AGU7TrbrgIhFSKVy6RWZxXUUYXnWn1PSezqFyVqVgwrXT7d0tozC5P7bxuzNPgFi68G2M8nNFOVmZL4otl8/hPs9URStGSqwG1zFiWRx6ViJyt8HgQsMdFGIQbQghsAmIyJeIpMZ0QuWe69UDzyCPNE480DwRtGDJACNmxIGFIqUscahxqHGo8BWOju3lxqztppH7YnFsqvBJCVxbqWpSs50W4lrU0Qf+y758/D/uP/u07HLVbpBuFNrb9mjaUSftz/dfP4fV9ovcXvtCiog=="}),u,a(s,{id:"mermaid-158",code:"eJxtkT9OwzAUh3dOEblLkWrUxGmVGIkFxg6I1ergOLZq4eAosVQ4AH82WHsAVkYkDpSht8D4hQqSennJ997v03OijN2KDW9ctLo5ifwRhrftlVSR0sbIMhQ6ifNynvFZ6xp7K+lkXiyLVM2ENbb5eUt4LM7/x2VVu4c+rcI5pAkh/TPe6tJtaHy2qO9/bb47UBleSNOrFpnI8vlBlahcLMlwEYjHDHG0ppTCTQAmDBUjSBgSI5gyVA6h9M4owHA9YF45Yt44Yl74l/VLRhhjvxYUAiUNRUJPQk9CT6YQrG07Zde21U7bu/Wpt8JXwvjCB8OI0dWUoZWutIu6p133+L7fvXUvn2g4nsIqvPbjl7zmQvs/13187Z9fj8x+A/+/o64="}),k,r,d,m,a(s,{id:"mermaid-171",code:"eJxLy8kvT85ILCpR8AniUgACVVWFp70LnuztfdHV9Lxp5/s9Pc+nrHg2d+nTPbuedmx7tmLV0wkTn/VNetoxHazc2TApv0JBV1dXwdkIzjIGsrjA0sWlSelFiQUZEHXRCrFgURBIySxKTS7JzM9TCHGCC4YYRpdkFKUmpiDUBRtGF+cnZ6eWGCLEQgyB9tgBpcAiqXkp6JaBnELYMiNMy4yglhkhWWYEscwIl2Ug3xK2zBjTMmOoZcZIlhlDLDOGWwYAf5d4PA=="}),v,h,b,a(s,{id:"mermaid-195",code:"eJxLL0osyFAIceEqLk2CsJ/v2v98RfezjQued3ZwlZholGQUpSamaCro6topFJtoFOcnZ6eWGGpylZiiSplCpYyAUki69EByZlA5Y1RtYDlzqJyJJldqXgoXACuQMMM="}),f,y,g,a(s,{id:"mermaid-214",code:"eJxLL0osyFAIceEqLk2CsItTc1KTS/KLFJ53dnCVZBSlJqYo6OrawcW54ApAosmGGskZiXl5qTmaaBJGuCSMERKpeSlcAK2xK9Y="}),S])}const N=e(l,[["render",C],["__file","basic.html.vue"]]),q=JSON.parse('{"path":"/code/netty/basic.html","title":"NIO基础","lang":"zh-CN","frontmatter":{"order":1,"title":"NIO基础","date":"2026-01-20T00:00:00.000Z","category":"Netty","tag":"Netty","timeline":true,"article":true,"prev":"./","description":"NIO基础知识介绍 NIO基础 三大组件 Channel Channel 是NIO 的核心组件，定义了 NIO 的核心功能，如：打开、关闭、绑定、监听、连接、读、写、获取通道属性等。 FileChannel：文件通道，用于文件读写 SocketChannel：socket 通道，用于 TCP 通信 ServerSocketChannel：服务器 soc...","head":[["meta",{"property":"og:url","content":"https://du-mozzie.github.io/code/netty/basic.html"}],["meta",{"property":"og:title","content":"NIO基础"}],["meta",{"property":"og:description","content":"NIO基础知识介绍 NIO基础 三大组件 Channel Channel 是NIO 的核心组件，定义了 NIO 的核心功能，如：打开、关闭、绑定、监听、连接、读、写、获取通道属性等。 FileChannel：文件通道，用于文件读写 SocketChannel：socket 通道，用于 TCP 通信 ServerSocketChannel：服务器 soc..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2026-01-27T12:13:24.000Z"}],["meta",{"property":"article:author","content":"mozzie"}],["meta",{"property":"article:tag","content":"Netty"}],["meta",{"property":"article:published_time","content":"2026-01-20T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2026-01-27T12:13:24.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"NIO基础\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2026-01-20T00:00:00.000Z\\",\\"dateModified\\":\\"2026-01-27T12:13:24.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"mozzie\\",\\"url\\":\\"https://du-mozzie.github.io\\"}]}"]]},"headers":[{"level":2,"title":"NIO基础","slug":"nio基础","link":"#nio基础","children":[{"level":3,"title":"三大组件","slug":"三大组件","link":"#三大组件","children":[{"level":4,"title":"Channel","slug":"channel","link":"#channel","children":[]},{"level":4,"title":"ByteBuffer","slug":"bytebuffer","link":"#bytebuffer","children":[]},{"level":4,"title":"Selector","slug":"selector","link":"#selector","children":[{"level":5,"title":"多线程模式","slug":"多线程模式","link":"#多线程模式","children":[]},{"level":5,"title":"线程池模式","slug":"线程池模式","link":"#线程池模式","children":[]},{"level":5,"title":"Selector 版设计","slug":"selector-版设计","link":"#selector-版设计","children":[]}]}]},{"level":3,"title":"网络编程","slug":"网络编程","link":"#网络编程","children":[{"level":4,"title":"阻塞模式","slug":"阻塞模式","link":"#阻塞模式","children":[]},{"level":4,"title":"非阻塞模式","slug":"非阻塞模式","link":"#非阻塞模式","children":[]},{"level":4,"title":"多路复用","slug":"多路复用","link":"#多路复用","children":[]}]}]}],"git":{"createdTime":1768844678000,"updatedTime":1769516004000,"contributors":[{"name":"mozzie","email":"du.mozzie@outlook.com","commits":6},{"name":"mozzie","email":"mozzie.du@gmail.com","commits":2}]},"readingTime":{"minutes":6.45,"words":1936},"filePathRelative":"code/netty/basic.md","localizedDate":"2026年1月20日","excerpt":"<p>NIO基础知识介绍</p>","autoDesc":true}');export{N as comp,q as data};
